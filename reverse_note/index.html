<!doctype html><html lang=zh-CN><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>REVERSE - J-shiro's Blog</title><meta name=Description content="Hugo theme - LoveIt"><meta property="og:url" content="https://j-shiro.github.io/reverse_note/">
<meta property="og:site_name" content="J-shiro's Blog"><meta property="og:title" content="REVERSE"><meta property="og:description" content='基础知识 除了逆向外也可以尝试爆破
#include <stdio.h> int main(){ int cipher; for(int i=0;i<0xffffffff;i++){ cipher = i; //加密异或等操作 } if (cipher==20241212153){ printf("flag1:%x\n",i); } } Windows kernel32.dll：控制系统内存管理、数据输入输出、中断处理，当Windows启动时，其驻留在内存中特定的写保护区域，使别的程序无法占用该内存区域'><meta property="og:locale" content="zh_CN"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-10-09T00:00:00+00:00"><meta property="article:modified_time" content="2025-05-27T12:49:39+08:00"><meta property="article:tag" content="Reverse"><meta property="og:image" content="https://j-shiro.github.io/logo.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://j-shiro.github.io/logo.png"><meta name=twitter:title content="REVERSE"><meta name=twitter:description content='基础知识 除了逆向外也可以尝试爆破
#include <stdio.h> int main(){ int cipher; for(int i=0;i<0xffffffff;i++){ cipher = i; //加密异或等操作 } if (cipher==20241212153){ printf("flag1:%x\n",i); } } Windows kernel32.dll：控制系统内存管理、数据输入输出、中断处理，当Windows启动时，其驻留在内存中特定的写保护区域，使别的程序无法占用该内存区域'><meta name=application-name content="LoveIt"><meta name=apple-mobile-web-app-title content="LoveIt"><meta name=referrer content="no-referrer"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://j-shiro.github.io/reverse_note/><link rel=prev href=https://j-shiro.github.io/web_note/><link rel=next href=https://j-shiro.github.io/pwn_note/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.2/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.2/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"REVERSE","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/j-shiro.github.io\/reverse_note\/"},"image":["https:\/\/j-shiro.github.io\/images\/Apple-Devices-Preview.png"],"genre":"posts","keywords":"reverse","wordcount":16819,"url":"https:\/\/j-shiro.github.io\/reverse_note\/","datePublished":"2024-10-09T00:00:00+00:00","dateModified":"2025-05-27T12:49:39+08:00","license":"This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher":{"@type":"Organization","name":"xxxx","logo":{"@type":"ImageObject","url":"https:\/\/j-shiro.github.io\/images\/avatar.png","width":800,"height":800}},"author":{"@type":"Person","name":"jshiro"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="J-shiro's Blog"><img class="lazyload logo" src=/svg/loading.min.svg data-src=/logo.png data-srcset="/logo.png, /logo.png 1.5x, /logo.png 2x" data-sizes=auto alt=/logo.png title=/logo.png><span id=id-1 class=typeit></span></a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>所有文章 </a><a class=menu-item href=/tags/>标签 </a><a class=menu-item href=/categories/>分类 </a><a class=menu-item href=/about/>关于 </a><a class=menu-item href=https://github.com/J-shiro title=GitHub rel="noopener noreffer" target=_blank><i class='fab fa-github fa-fw' aria-hidden=true></i> </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder=搜索文章标题或内容... id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fas fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=清空><i class="fas fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i>
</span></span><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题><i class="fas fa-adjust fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="menu-item language" title=选择语言><i class="fa fa-globe fa-fw" aria-hidden=true></i>
<select class=language-select id=language-select-desktop onchange="location=this.value"><option value=/reverse_note/ selected>简体中文</option></select></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="J-shiro's Blog"><img class="lazyload logo" src=/svg/loading.min.svg data-src=/logo.png data-srcset="/logo.png, /logo.png 1.5x, /logo.png 2x" data-sizes=auto alt=/logo.png title=/logo.png><span id=id-2 class=typeit></span></a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜索文章标题或内容... id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fas fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=清空><i class="fas fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>取消</a></div><a class=menu-item href=/posts/ title>所有文章</a><a class=menu-item href=/tags/ title>标签</a><a class=menu-item href=/categories/ title>分类</a><a class=menu-item href=/about/ title>关于</a><a class=menu-item href=https://github.com/J-shiro title=GitHub rel="noopener noreffer" target=_blank><i class='fab fa-github fa-fw' aria-hidden=true></i></a><a href=javascript:void(0); class="menu-item theme-switch" title=切换主题>
<i class="fas fa-adjust fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class=menu-item title=选择语言><i class="fa fa-globe fa-fw" aria-hidden=true></i>
<select class=language-select onchange="location=this.value"><option value=/reverse_note/ selected>简体中文</option></select></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>目录</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">REVERSE</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>jshiro</a></span>&nbsp;<span class=post-category>收录于 <a href=/categories/notes/><i class="far fa-folder fa-fw" aria-hidden=true></i>Notes</a>&nbsp;<a href=/categories/ctf/><i class="far fa-folder fa-fw" aria-hidden=true></i>CTF</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2024-10-09>2024-10-09</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;约 16819 字&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;预计阅读 34 分钟&nbsp;<span id=/reverse_note/ class=leancloud_visitors data-flag-title=REVERSE>
<i class="far fa-eye fa-fw" aria-hidden=true></i>&nbsp;<span class=leancloud-visitors-count></span>&nbsp;次阅读
</span>&nbsp;</div></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#基础知识>基础知识</a><ul><li><a href=#windows>Windows</a><ul><li><a href=#反编译>反编译</a></li><li><a href=#约定>约定</a></li><li><a href=#eflags><strong>Eflags</strong></a></li><li><a href=#syscall>Syscall</a></li><li><a href=#seh机制>SEH机制</a></li></ul></li><li><a href=#linux>Linux</a></li><li><a href=#数学>数学</a></li><li><a href=#计算机组成>计算机组成</a></li><li><a href=#汇编>汇编</a></li><li><a href=#c>C</a></li><li><a href=#c-1>C++</a></li><li><a href=#可执行文件>可执行文件</a><ul><li><a href=#pe文件>PE文件</a><ul><li><a href=#iat>IAT</a></li><li><a href=#eat>EAT</a></li><li><a href=#peb>PEB</a></li><li><a href=#dll>DLL</a></li></ul></li><li><a href=#elf文件><strong>ELF</strong>文件</a></li></ul></li><li><a href=#大小端序>大小端序</a></li><li><a href=#python>Python</a></li><li><a href=#java>JAVA</a></li><li><a href=#寄存器>寄存器</a></li></ul></li><li><a href=#工具>工具</a><ul><li><a href=#gdb>GDB</a></li><li><a href=#ida>IDA</a></li><li><a href=#ghidra>Ghidra</a></li><li><a href=#frida>Frida</a></li><li><a href=#die>DIE</a></li><li><a href=#exeinfo-pe>Exeinfo PE</a></li><li><a href=#ollydbg>OllyDbg</a></li><li><a href=#x64dbg>x64dbg</a></li><li><a href=#gdbpwndbg>GDB/PWNDBG</a></li><li><a href=#upxshell>UPXshell</a></li><li><a href=#jadx>Jadx</a></li><li><a href=#jd-gui>jd-gui</a></li><li><a href=#ilspy>ILSpy</a></li><li><a href=#z3-solver>Z3-Solver</a></li><li><a href=#qemu>QEMU</a></li></ul></li><li><a href=#算法>算法</a><ul><li><a href=#tea系列>TEA系列</a><ul><li><a href=#tea>TEA</a></li><li><a href=#xtea>XTEA</a></li><li><a href=#xxtea>XXTEA</a></li></ul></li><li><a href=#md5>md5</a></li><li><a href=#sm4>SM4</a></li><li><a href=#rc4>RC4</a></li><li><a href=#des>DES</a></li><li><a href=#base算法>Base算法</a><ul><li><a href=#base64>base64</a></li></ul></li></ul></li><li><a href=#代码混淆>代码混淆</a><ul><li><a href=#脏字节>脏字节</a></li><li><a href=#花指令>花指令</a></li><li><a href=#smc技术>SMC技术</a></li><li><a href=#反调试>反调试</a></li><li><a href=#ollvm>OLLVM</a></li></ul></li><li><a href=#maze>maze</a><ul><li><a href=#dfs>DFS</a></li></ul></li><li><a href=#壳>壳</a><ul><li><a href=#压缩壳>压缩壳</a><ul><li><a href=#upx>UPX</a></li></ul></li><li><a href=#加密壳>加密壳</a><ul><li><a href=#vmp>VMP</a></li></ul></li></ul></li><li><a href=#脱壳>脱壳</a><ul><li><a href=#api定位>API定位</a></li><li><a href=#esp定律>ESP定律</a></li></ul></li><li><a href=#windows-api>Windows API</a></li><li><a href=#安卓>安卓</a></li><li><a href=#python-1>python</a></li><li><a href=#vm>VM</a></li><li><a href=#易语言>易语言</a></li></ul></nav></div></div><div class=content id=content><h2 id=基础知识>基础知识</h2><p>除了逆向外也可以尝试<strong>爆破</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-c"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>cipher</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=mh>0xffffffff</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>        <span class=n>cipher</span> <span class=o>=</span> <span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=c1>//加密异或等操作
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>cipher</span><span class=o>==</span><span class=mi>20241212153</span><span class=p>){</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;flag1:%x</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>i</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div><h3 id=windows>Windows</h3><p><code>kernel32.dll</code>：控制系统内存管理、数据输入输出、中断处理，当Windows启动时，其驻留在内存中特定的写保护区域，使别的程序无法占用该内存区域</p><p><code>user32.dll</code>：用户界面相关应用程序接口，包括Windows处理、基本用户界面</p><p><code>gdi32.dll</code>：Windows GDI图形用户界面相关程序，绘制图形、显示文字</p><p>句柄（handle）：唯一整数值，标志程序中不同对象和同类对象中的不同实例</p><h4 id=反编译>反编译</h4><ul><li><strong>线性扫描(Linear Sweep)</strong>：简单顺序扫描文件分析，均分析为代码，objdump, OllyDbg, x64dbg</li><li><strong>递归下降(Recursive Traversal)</strong>：控制流根据call指令调用关系分析，IDA pro</li></ul><h4 id=约定>约定</h4><p>变数名称<strong>前缀表示类型</strong></p><ul><li><strong><code>lp</code></strong>：Loing Pointer</li><li><strong><code>h</code></strong>：Handler</li><li><strong><code>dw</code></strong>：DWORD</li></ul><p>函数名称后可能有<strong>大写字母</strong></p><ul><li><strong><code>A</code></strong>：字符串参数使用ANSI</li><li><strong><code>W</code></strong>：字符串参数使用UNICODE（Wide character）</li><li><strong><code>EX</code></strong>：扩展（Extended）</li></ul><p><strong>调用约定</strong></p><ul><li>x86 32位<ul><li><code>__cdecl</code>：参数从右向左依次压入栈，调用完毕后，调用者caller负责清理参数，返回值位于EAX</li><li><code>__stdcall</code>：（Win32 API）参数从右向左压入栈，调用完毕后，被调用者负责清理参数，返回值位于EAX</li><li><code>__thiscall</code>：参数从右向左压入栈，类方法的<code>this</code>指针通过ECX传递给被调用者，若参数个数确定，则参数全部压入栈后<code>this</code>指针入堆栈；若参数个数不确定，调用者清理堆栈</li><li><code>__fastcall</code>：函数第一个和第二个DWORD参数通过ECX和EDX传递，其他参数从右向左压入栈，被调用函数清理堆栈</li></ul></li><li>清理栈帧指参数使用了栈则栈帧会发生变化，需要使用<code>add rsp, 0x??</code>来清理，push x次，32位下add x<em>0x4，64位下add x</em>0x8</li><li>x86-64<ul><li><strong>Microsoft x64</strong>：前四个参数放入RDI、RSI、RDX、RCX，（Windows下前四个参数让RCX、RDX、r8、r9）剩下参数从右到左压入栈，调用者caller负责清理堆栈</li><li><strong>SystemV x64(SysV)</strong>：Linux与MacOS上使用，比Microsoft多两个寄存器，使用RDI、RSI、RDX、RCX、R8、R9，剩下参数从右向左压入栈中，调用者caller负责清理堆栈</li></ul></li><li><strong>局部变量</strong>：放于栈上</li></ul><h4 id=eflags><strong>Eflags</strong></h4><ul><li>ZF（Zero Flag）：零标志</li><li>PF（Parity Flag）：奇偶标志</li><li>AF（Adjust Flag）：辅助标志</li><li>OF（Overflow Flag）：溢出标志</li><li>SF（Sign Flag）：符号标志</li><li>DF（Direction Flag）：方向标志</li><li>TF（Trap Flag）：追踪标志</li><li>IF（Interrupt enable Flag）：中断允许标志</li></ul><h4 id=syscall>Syscall</h4><p>Windows 的 syscall number 随版本更新会变更，一般呼叫<strong>API</strong></p><h4 id=seh机制>SEH机制</h4><p><strong>Structured Exception Handling</strong>，结构化异常处理</p><ul><li><p>VC++及Windows的异常处理机制，可利用<code>/0</code>等方式触发异常</p></li><li><p>以链的形式存在，第一个异常处理器中若未处理相关异常，异常会传递到下个异常处理器直到得到处理</p></li><li><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-C++"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-C++ data-lang=C++><span class=line><span class=cl><span class=k>typedef</span> <span class=k>struct</span> <span class=nc>_EXCEPTION_REGISTRATION_RECORD</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>PEXCEPTION_REGISTRATION_RECORD</span> <span class=n>Next</span><span class=p>;</span> <span class=c1>// Next值为FFFFFFFF表示最后一个节点
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>PEXCEPTION_DISPOSITION</span> <span class=n>Handler</span><span class=p>;</span> <span class=c1>// 当前异常处理回调函数的地址
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span> <span class=n>EXCEPTION_REGISTRATION_RECORD</span><span class=p>,</span> <span class=o>*</span><span class=n>PEXCEPTION_REGISTRATION_RECORD</span><span class=p>;</span></span></span></code></pre></div></div></li></ul><p><img src=/img/reverse_note.zh-cn.assets/image-20241022224820682.png alt=图片无法加载><strong>线程信息块TIB</strong>（Thread Information Block or TEB）</p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-C++"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-C++ data-lang=C++><span class=line><span class=cl><span class=k>typedef</span> <span class=k>struct</span> <span class=nc>_NT_TIB</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>     <span class=k>struct</span> <span class=nc>_EXCEPTION_REGISTRATION_RECORD</span> <span class=o>*</span><span class=n>ExceptionList</span><span class=p>;</span> <span class=c1>//异常的链表
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>     <span class=n>PVOID</span> <span class=n>StackBase</span><span class=p>;</span>
</span></span><span class=line><span class=cl>     <span class=n>PVOID</span> <span class=n>StackLimit</span><span class=p>;</span>
</span></span><span class=line><span class=cl>     <span class=n>PVOID</span> <span class=n>SubSystemTib</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>     <span class=k>union</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>         <span class=n>PVOID</span> <span class=n>FiberData</span><span class=p>;</span>
</span></span><span class=line><span class=cl>         <span class=n>DWORD</span> <span class=n>Version</span><span class=p>;</span>
</span></span><span class=line><span class=cl>     <span class=p>};</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>     <span class=n>PVOID</span> <span class=n>ArbitraryUserPointer</span><span class=p>;</span>
</span></span><span class=line><span class=cl>     <span class=k>struct</span> <span class=nc>_NT_TIB</span> <span class=o>*</span><span class=n>Self</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=n>NT_TIB</span><span class=p>;</span></span></span></code></pre></div></div><p><strong>调用</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-c++"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=c1>// Visual C++
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>__try</span><span class=p>{</span><span class=n>compound</span><span class=o>-</span><span class=n>statement</span><span class=p>}</span> <span class=kr>__except</span><span class=p>(</span><span class=n>filter</span><span class=o>-</span><span class=n>expression</span><span class=p>){</span><span class=n>compound</span><span class=o>-</span><span class=n>statement</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kr>__try</span><span class=p>{</span><span class=n>compound</span><span class=o>-</span><span class=n>statement</span><span class=p>}</span> <span class=kr>__finally</span><span class=p>{</span><span class=n>compound</span><span class=o>-</span><span class=n>statement</span><span class=p>}</span></span></span></code></pre></div></div><h3 id=linux>Linux</h3><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-Bash"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash><span class=line><span class=cl>file &lt;somefile&gt; <span class=c1># 查看文件类型</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>strings &lt;something&gt; <span class=c1># 打印文件中可见字符串</span>
</span></span><span class=line><span class=cl>strings -n &lt;min-len&gt; &lt;something&gt; <span class=c1># 打印最短长度为min-len的可见字符串</span>
</span></span><span class=line><span class=cl>strings &lt;something&gt; <span class=p>|</span> grep <span class=s2>&#34;xx&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>objdump -M intel -d &lt;binary&gt; <span class=c1># intel格式展示反汇编结果</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>strace <span class=c1># 查看 binary 执行时的 system call 和 signal</span>
</span></span><span class=line><span class=cl>ltrace <span class=c1># 查看 binary 执行时的 library call</span></span></span></code></pre></div></div><p><strong>可执行程序报错</strong>：linux版本可能不匹配，尝试高版本打开</p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-bash"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>./a.elf: /lib/x86_64-linux-gnu/libstdc++.so.6: version <span class=sb>`</span>GLIBCXX_3.4.32<span class=err>&#39;</span> not found <span class=o>(</span>required by ./a.elf<span class=o>)</span></span></span></code></pre></div></div><h3 id=数学>数学</h3><p><strong>乘法逆元</strong>： $a\cdot a^{-1}\equiv 1(mod\quad p)$</p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-Python"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=c1># 求 a 乘法逆元</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>gmpy2</span> <span class=kn>import</span> <span class=n>invert</span>
</span></span><span class=line><span class=cl><span class=n>inv</span> <span class=o>=</span> <span class=n>invert</span><span class=p>(</span><span class=n>a</span><span class=p>,</span><span class=n>p</span><span class=p>)</span></span></span></code></pre></div></div><p>逆向下面公式</p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-C"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-C data-lang=C><span class=line><span class=cl><span class=c1>// a1[k] 有限域 (0x00 ~ 0xff) 即 0 ~ 255 加密
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>j</span> <span class=o>&lt;</span> <span class=mi>12</span><span class=p>;</span> <span class=o>++</span><span class=n>j</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>a1</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=o>=</span> <span class=n>a1</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=o>*</span> <span class=mi>17</span> <span class=o>+</span> <span class=mi>113</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=c1>// 整除 17 会损失数据, 不可 /17
</span></span></span><span class=line><span class=cl><span class=c1>// 逆向解密 求 17 在 mod 256 的乘法逆元: 241
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>for</span><span class=p>(</span><span class=kt>int</span> <span class=n>j</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>j</span> <span class=o>&lt;</span> <span class=mi>12</span><span class=p>;</span> <span class=o>++</span><span class=n>j</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>a1</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=n>a1</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=o>-</span> <span class=mi>113</span><span class=p>)</span> <span class=o>*</span> <span class=mi>241</span></span></span></code></pre></div></div><h3 id=计算机组成>计算机组成</h3><p>VA：虚拟地址</p><p>RVA：（Relative Virtual Address）相对虚拟地址，相对于镜像基址的位置，即VA = ImageBase + RVA</p><ul><li>Entry Point RVA - .text section RVA = Entry Point file offset - .text section file offset</li></ul><ol><li>八个比特（bit）称为一个字节（byte）</li><li>两个字节称为一个字（word）——16bits</li><li>两个字称为一个双字（dword）——32bits</li><li>两个双字称为一个四字（qword）——64bits</li></ol><p><strong>位运算</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-C"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-C data-lang=C><span class=line><span class=cl><span class=c1>// 基础 优先级 not &gt; and &gt; or &gt; xor
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>or</span> <span class=o>|</span>  <span class=c1>// 00=0 01=1 10=1 11=1
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>xor</span> <span class=o>^</span> <span class=c1>// 00=0 01=1 10=1 11=0   a^a=0 0^a=a a^b^a=b
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>and</span> <span class=o>&amp;</span> <span class=c1>// 00=0 01=0 10=0 11=1 自己与自己相与得自己
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>nor</span>   <span class=c1>// 与or相反
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>nand</span>  <span class=c1>// 与and相反
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>not</span>   <span class=c1>// 0=1 1=0
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// 位与
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>x</span> <span class=o>&amp;</span> <span class=mi>1</span> <span class=c1>// 若为0:偶数, 若为1:奇数
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// 负数计算 (-25 &amp; 0xff) 转换
</span></span></span></code></pre></div></div><p><strong>移位</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-C"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-C data-lang=C><span class=line><span class=cl><span class=o>&lt;&lt;</span> <span class=n>n</span>  <span class=o>&lt;===&gt;</span>  <span class=err>乘</span><span class=mi>2</span><span class=o>^</span><span class=n>n</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>v1</span> <span class=o>=</span> <span class=n>v2</span> <span class=o>|</span> <span class=p>(</span><span class=n>v3</span> <span class=o>&lt;&lt;</span> <span class=mi>16</span><span class=p>)</span> <span class=c1>// v3左移16位成为高16位
</span></span></span><span class=line><span class=cl><span class=c1>// v1 = 0xaabbccdd 则 v3 = 0xaabb, v2 = 0xccdd
</span></span></span></code></pre></div></div><p><strong>数据类型大小</strong></p><ul><li>short：2字节</li><li>char：1字节</li><li>int：4字节</li><li>double：8字节</li><li>long：8字节</li></ul><p><strong>python中将负数表示为无符号32位或64位整数</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-Python"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=n>unsigned_value</span> <span class=o>=</span> <span class=p>(</span><span class=n>negative_value</span> <span class=o>+</span> <span class=p>(</span><span class=mi>1</span> <span class=o>&lt;&lt;</span> <span class=mi>64</span><span class=p>))</span> <span class=o>&amp;</span> <span class=mh>0xFFFFFFFFFFFFFFFF</span> <span class=c1># 转化为64位</span></span></span></code></pre></div></div><h3 id=汇编>汇编</h3><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-Assembly"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><pre tabindex=0><code class=language-Assembly data-lang=Assembly>jc    ;CF==1执行
jo    ;OF==1执行
jz    ;ZF==1执行</code></pre></div><p><code>nop</code>为0x90</p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-assembly"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><pre tabindex=0><code class=language-assembly data-lang=assembly>movzx ; 将源操作数值复制到目标寄存器后将高位清零得到32位

xor edx, eax; 结果存在edx中</code></pre></div><p>x86-64架构的SIMD寄存器，处理单指令多数据操作：<code>xmm0</code>-<code>xmm15</code>可以存储128位数据，IDA中显示不了<code>xmm</code>寄存器值</p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-assembly"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><pre tabindex=0><code class=language-assembly data-lang=assembly>movaps xmm0, ds:xmmword_XXXX ; 将该地址128位数据移到xmm0中, xmm0中存4个32位整数

# xmmword_XXXXX xmmword 3000000020000000100000000h
# xmm0: [0x1, 0x2, 0x3, 0x4]</code></pre></div><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-assembly"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><pre tabindex=0><code class=language-assembly data-lang=assembly>movd xmm0, ecx ; 将ecx 32位整数移到xmm0中, 其余96位填充为0
pshufd xmm1, xmm0, 0 ; 从xmm0取第0个元素复制到xmm1中，其余填充为0</code></pre></div><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-assembly"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><pre tabindex=0><code class=language-assembly data-lang=assembly># xmm1 = [0x00, 0x01, 0x02, 0x03]
# xmm0 = [0x15151515, 0x0, 0x0, 0x0, 0x0]

padd xmm1, xmm0 ; 相加 
; [0x00+0x15, 0x01+0x15, 0x02+0x15, 0x03+0x15]
andps xmm1, xmm0 ; 按位与
; [0x00&amp;0x15, 0x01&amp;0x15, 0x02&amp;0x15, 0x03&amp;0x15]
xorps xmm1, xmm2 ; 按位异或
; [0x00^0x15, 0x01^0x15, 0x02^0x15, 0x03^0x15]</code></pre></div><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-assembly"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><pre tabindex=0><code class=language-assembly data-lang=assembly>packuswd xmm1, xmm1 ; 16位无符号整数打包到一个8位无符号整数
# xmm1 = [0x0000ffff, 0x00010001, 0x00020002, 0x00030003]
# xmm1 = [0xffff, 0x0001, 0x0002, 0x0003]</code></pre></div><p><strong>Intel</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-Assembly"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><pre tabindex=0><code class=language-Assembly data-lang=Assembly>mov rax, 0x80
xor rbx, rcx
mov rax, QWORD PTR [rbx+rcx*4]</code></pre></div><p><strong>AT&amp;T</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-Assembly"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><pre tabindex=0><code class=language-Assembly data-lang=Assembly>mov $0x80, %rax
xor %rcx, %rbx
mov (%rbx, %rcx, 4), %rax</code></pre></div><p><strong>struct</strong></p><img src=/img/reverse_note.zh-cn.assets/172845173251511.png alt=图片无法加载><ol><li>分配 0x18 bytes 内存空间，内存空间起始位置存在 rbp-0x8</li><li>将 rbp-0x8 的值存于 rax，即 rax 是 ms 的基址</li><li>ms->a 的偏移为 0x0，ms->b的偏移为 0x8，ms->c 的偏移为 0x10</li><li>1+8+4 = 13 bytes 实际用了 24 bytes</li></ol><h3 id=c>C</h3><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-C"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-C data-lang=C><span class=line><span class=cl><span class=nf>strncmp</span><span class=p>(</span><span class=k>const</span> <span class=kt>char</span> <span class=o>*</span><span class=n>str1</span><span class=p>,</span> <span class=k>const</span> <span class=kt>char</span> <span class=o>*</span><span class=n>str2</span><span class=p>,</span> <span class=kt>size_t</span> <span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1>// 比对str1和str2开头n个字符
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=nf>strcpy</span><span class=p>(</span><span class=kt>char</span> <span class=o>*</span><span class=n>dest</span><span class=p>,</span> <span class=k>const</span> <span class=kt>char</span> <span class=o>*</span><span class=n>src</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1>// 将src复制到dest
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=nf>memcpy</span><span class=p>(</span><span class=n>dest_addr</span><span class=p>,</span> <span class=n>src_addr</span><span class=p>,</span> <span class=n>bytes_num</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1>// 从 src_addr 拷贝 bytes_num 个字节数据到 dest_addr
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=nf>memset</span><span class=p>(</span><span class=n>arr</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=k>sizeof</span><span class=p>(</span><span class=n>arr</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=c1>// 将 arr 指针指向的内存块的sizeof(arr)所有字节指定为0
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=nf>scanf</span><span class=p>(</span><span class=s>&#34;%s&#34;</span><span class=p>,</span> <span class=n>buf</span><span class=p>);</span> <span class=c1>// 存在溢出操作, 假设输入15个字节, 会自动将第16个字节设为\0
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nf>scanf</span><span class=p>(</span><span class=s>&#34;%15s&#34;</span><span class=p>,</span> <span class=n>buf</span><span class=p>);</span> <span class=c1>// 指定输入字节
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=nf>fgets</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=mi>32</span><span class=p>,</span> <span class=n>stdin</span><span class=p>);</span> <span class=c1>// IDA中可能将x数组分为多个变量，实际可能均为x, 但代码显示的x实际为x[0]
</span></span></span></code></pre></div></div><p><strong>文件操作</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-C"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-C data-lang=C><span class=line><span class=cl><span class=nf>fseek</span><span class=p>(</span><span class=n>FILE</span> <span class=o>*</span><span class=n>stream</span><span class=p>,</span> <span class=kt>long</span> <span class=kt>int</span> <span class=n>offset</span><span class=p>,</span> <span class=kt>int</span> <span class=n>whence</span><span class=p>)</span><span class=c1>// 设置流的文件位置为给定的偏移
</span></span></span><span class=line><span class=cl><span class=c1>// 文件流, 偏移, 添加偏移量的位置(0:开头, 1:指针位置, 2:结尾)
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=nf>fputc</span><span class=p>(</span><span class=kt>int</span> <span class=kt>char</span><span class=p>,</span> <span class=n>FILE</span> <span class=o>*</span><span class=n>stream</span><span class=p>)</span> <span class=c1>// 将char指定的字符写入指定的流指针处
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nf>fprintf</span><span class=p>(</span><span class=n>ILE</span> <span class=o>*</span><span class=n>stream</span><span class=p>,</span> <span class=k>const</span> <span class=kt>char</span> <span class=o>*</span><span class=n>format</span><span class=p>,</span> <span class=p>...)</span> <span class=c1>// 格式化字符串输出到流
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=n>a</span> <span class=o>=</span> <span class=nf>_acrt_iob_func</span><span class=p>(</span><span class=mi>1</span><span class=n>i64</span><span class=p>)</span> <span class=c1>// 将标准输出流stdout的文件指针给a，可通过a向标准输出流写数据
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=nf>fgets</span><span class=p>(</span><span class=kt>char</span> <span class=o>*</span><span class=n>str</span><span class=p>,</span> <span class=kt>int</span> <span class=n>n</span><span class=p>,</span> <span class=n>FILE</span> <span class=o>*</span><span class=n>stream</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=c1>// 从文件流读入 n-1 个字符到 str, 第 n 个为\0
</span></span></span></code></pre></div></div><p><strong>宏</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-C"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-C data-lang=C><span class=line><span class=cl><span class=nf>LODWORD</span><span class=p>(</span><span class=n>v4</span><span class=p>)</span> <span class=o>=</span> <span class=mi>0</span>    <span class=c1>//初始化低32位为0
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nf>HIDWORD</span><span class=p>(</span><span class=n>v4</span><span class=p>)</span> <span class=o>=</span> <span class=mi>0</span>    <span class=c1>//初始化高32位为0
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nf>SHIDWORD</span><span class=p>(</span><span class=n>v4</span><span class=p>)</span>       <span class=c1>//取高32位并作为有符号整数
</span></span></span></code></pre></div></div><p>数据类型：<code>LL</code>即<code>long long int</code></p><p><strong>其他</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-C"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-C data-lang=C><span class=line><span class=cl><span class=nf>setlocale</span><span class=p>(</span><span class=kt>int</span> <span class=n>category</span><span class=p>,</span> <span class=k>const</span> <span class=kt>char</span> <span class=o>*</span><span class=n>locale</span><span class=p>);</span> <span class=c1>//设置或读取位置相关信息
</span></span></span></code></pre></div></div><p><strong>格式化字符串</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-C"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-C data-lang=C><span class=line><span class=cl><span class=nf>printf</span><span class=p>(</span><span class=s>&#34;%x&#34;</span><span class=p>,</span> <span class=n>a</span><span class=p>);</span> <span class=c1>// 十六进制
</span></span></span></code></pre></div></div><p><strong>C逆向代码</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-C"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-C data-lang=C><span class=line><span class=cl><span class=kt>char</span> <span class=n>password_enc</span><span class=p>[]</span> <span class=o>=</span> <span class=p>{</span><span class=mh>0x49</span><span class=p>,</span> <span class=mh>0x4B</span><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=kt>char</span> <span class=n>password</span><span class=p>[</span><span class=mi>47</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=mi>46</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=n>password</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>password_enc</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>^</span> <span class=mh>0x24</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>password</span><span class=p>[</span><span class=mi>46</span><span class=p>]</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>         <span class=c1>// 使用0字符来截断掉%s的无尽输出
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nf>printf</span><span class=p>(</span><span class=s>&#34;%s</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>password</span><span class=p>);</span></span></span></code></pre></div></div><p><strong>格式转换相关</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-C"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-C data-lang=C><span class=line><span class=cl><span class=kt>char</span> <span class=n>Str</span><span class=p>[</span><span class=mi>48</span><span class=p>];</span> <span class=c1>// 假设已输入
</span></span></span><span class=line><span class=cl><span class=c1>//  strlen(const char *Str) [Str是指向数组第一个字符的指针]
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>if</span> <span class=p>(</span> <span class=nf>strlen</span><span class=p>(</span><span class=n>Str</span><span class=p>)</span> <span class=o>==</span> <span class=mi>12</span> <span class=p>){}</span> <span class=c1>// 12是指12字节, 即Str: &#39;abcdefghijkl&#39;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nf>process</span><span class=p>(</span><span class=n>Src</span><span class=p>);</span> <span class=c1>// void process(unsigned int *a1)
</span></span></span><span class=line><span class=cl><span class=c1>// 此时Str将被解析为无符号整数 &gt; 32位即4字节, 所以此时进入process后
</span></span></span><span class=line><span class=cl><span class=c1>// &#39;abcd&#39;-&gt;0x61,0x62,0x63,0x64-&gt;小端存储 -&gt;0x64636261
</span></span></span><span class=line><span class=cl><span class=c1>// a[] 3个整数: [0x64636261, 0x68676665, 0x6c6b6a69]
</span></span></span><span class=line><span class=cl><span class=c1>// 假设操作后 0x64636261 变为 0x68676665, 该值传回a[0]时, a[0]换为char时表示&#39;efgh&#39; 
</span></span></span></code></pre></div></div><h3 id=c-1>C++</h3><p><code>0xCC</code> 是一种填充字节，通常用于调试表示<strong>未初始化</strong>的内存区域</p><p>Name Mangling：附加修饰函数名，用于辨识参数不同的同名函数</p><p>命令行使用<code>c++filt &lt;name></code>来获取原始的函数名</p><p>或gdb上使用<code>set print asm-demangle on</code></p><p><strong>IDA相关</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-C++"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-C++ data-lang=C++><span class=line><span class=cl><span class=n>__do_global_ctors</span><span class=p>()</span> <span class=c1>// 编译器生成, 初始化全局和静态对象
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=n>a</span> <span class=o>=</span> <span class=mi>20</span><span class=n>i64</span> <span class=c1>// a = 20 且 i64 指定为带符号的64位整数
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=n>std</span><span class=o>::</span><span class=n>ostream</span><span class=o>::</span><span class=k>operator</span><span class=o>&lt;&lt;</span><span class=p>(</span><span class=n>v1</span><span class=p>);</span> <span class=c1>// 输出
</span></span></span></code></pre></div></div><p><strong>Windows API</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-C"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-C data-lang=C><span class=line><span class=cl><span class=n>DWORD</span> <span class=nf>GetCurrentThreadId</span><span class=p>(</span><span class=kt>void</span><span class=p>);</span> <span class=c1>// 获取当前线程的标识符
</span></span></span></code></pre></div></div><h3 id=可执行文件>可执行文件</h3><h4 id=pe文件>PE文件</h4><p>PE文件（Portable Executable）：32位【PE32】，64位【PE+或PE32+】</p><ul><li>可执行：<code>exe, scr</code></li><li>库：<code>dll, ocx, cpl, drv</code></li><li>驱动程序：<code>sys, vxd</code></li><li>对象文件：<code>obj</code></li></ul><img src=/img/reverse_note.zh-cn.assets/17284517325131.png alt=图片无法加载><p><strong>DOS头</strong></p><img src=/img/reverse_note.zh-cn.assets/17284517325142.png alt=图片无法加载><p><strong>DOS存根</strong></p><p>向下兼容，用DOSBox执行PE会输出红色框中字符串</p><img src=/img/reverse_note.zh-cn.assets/17284517325143.png alt=图片无法加载><p><strong>NT头</strong></p><img src=/img/reverse_note.zh-cn.assets/17284517325144.png alt=图片无法加载><p><strong>映射</strong></p><img src=/img/reverse_note.zh-cn.assets/17284517325145.png alt=图片无法加载><p><strong>节Sections</strong></p><ul><li><code>.text</code>：代码段</li><li><code>.idata</code>：放 import tables</li><li><code>.data</code>：初始化数据</li><li><code>.bss</code>：未初始化数据</li><li><code>.reloc</code>：relocation 信息</li><li><code>.rsrc</code>：资源数据</li><li><code>.rdata</code>：只读数据</li><li><code>.tls</code>：Thread Local Storage，线程局部存储数据</li></ul><h5 id=iat>IAT</h5><p>(Import Address Table)，存储在 <code>.idata section</code> 内的表</p><ul><li>程序载入前相当于<code>INT</code>，指向 <code>IMAGE_IMPORT_BY_NAME</code></li><li>程序载入后存储外部引入函数的位置</li></ul><img src=/img/reverse_note.zh-cn.assets/17284517325146.png alt=图片无法加载><h5 id=eat>EAT</h5><p>(Export Address Table)</p><img src=/img/reverse_note.zh-cn.assets/17284517325147.png alt=图片无法加载><p><strong>应用EAT来做GetProcAddress</strong></p><ol><li>从 module image base 取得指定 API address</li><li>从optional header 的 DataDirectory[0] 取得EAT</li><li>遍历AddressOfNames，寻找指定API名称</li><li>透过AddressOfNameOrdinals得到ordinal</li><li>从AddressOfFunctions得到API RVA，避免直接呼叫GetProcAddress</li></ol><h5 id=peb>PEB</h5><p>（Process Environment Block）</p><img src=/img/reverse_note.zh-cn.assets/17284517325148.png alt=图片无法加载><p><strong>PEB断链：将特定的module隐藏（x86-64）</strong></p><ol><li>从 gs:[0x60] 取得 PEB</li><li>从 PEB 取得 Ldr</li><li>通过 Ldr 内的 InLoadOrderModuleList 遍历所有 LDR_DATA_TABLE_ENTRY 结构</li><li>找到指定的 LDR_DATA_TABLE_ENTRY 后，将其从三个 linked list 中删除</li></ol><p><strong>应用PEB来做GetModuleHandle</strong></p><ol><li>取得特定的 module image base(x86-64)</li><li>从 gs:[0x60] 取得 PEB</li><li>从 PEB 取得 Ldr</li><li>通过 Ldr 内的 InLoadOrderModuleList 遍历所有 LDR_DATA_TABLE_ENTRY 结构</li><li>比对 BaseDllName 得到 DllBase，避免直接呼叫 GetModuleHandle</li></ol><h5 id=dll>DLL</h5><ul><li>（Dynamic Link Library）导出函数给程序使用</li><li>DLL的main为<strong>DllMain</strong>，载入、卸载时会执行</li></ul><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-C++"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-C++ data-lang=C++><span class=line><span class=cl><span class=n>BOOL</span> <span class=n>WINAPI</span> <span class=nf>DllMain</span><span class=p>(</span>
</span></span><span class=line><span class=cl><span class=c1>//BOOL: 返回类型        WINAPI: 调用约定
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>HINSTANCE</span> <span class=n>hinstDLL</span><span class=p>,</span>  <span class=c1>// 指向加载 DLL 的实例的句柄的类型
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>DWORD</span> <span class=n>fdwReason</span><span class=p>,</span>     <span class=c1>// 调用函数原因
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>LPVOID</span> <span class=n>lpvReserved</span> <span class=p>)</span>  <span class=c1>// 保留
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>switch</span><span class=p>(</span> <span class=n>fdwReason</span> <span class=p>)</span> 
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=nl>DLL_PROCESS_ATTACH</span><span class=p>:</span> 
</span></span><span class=line><span class=cl>            <span class=k>break</span><span class=p>;</span><span class=c1>// 进程附加事件,当进程加载这个DLL时执行一次性初始化操作
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=nl>DLL_THREAD_ATTACH</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span><span class=p>;</span><span class=c1>// 线程附加事件,线程从操作系统创建并且该DLL已加载时执行初始化操作
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=nl>DLL_THREAD_DETACH</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span><span class=p>;</span><span class=c1>// 线程分离事件
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>        <span class=k>case</span> <span class=nl>DLL_PROCESS_DETACH</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>lpvReserved</span> <span class=o>!=</span> <span class=k>nullptr</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>break</span><span class=p>;</span><span class=c1>// 进程未终止，不执行清理
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span><span class=p>;</span><span class=c1>// 清理工作
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>TRUE</span><span class=p>;</span>  <span class=c1>// DLL_PROCESS_ATTACH成功
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span></span></span></code></pre></div></div><p>EXE文件在终端运行，不要直接双击</p><h4 id=elf文件><strong>ELF</strong>文件</h4><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-Bash"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash><span class=line><span class=cl>readelf -S program <span class=c1># 查看elf文件的section</span>
</span></span><span class=line><span class=cl>readelf -a xxx     <span class=c1># 全部显示</span></span></span></code></pre></div></div><p><strong>节</strong>：</p><ul><li>.text节：程序代码指令</li><li>.rodata节：保存只读数据，只能在text段找到.rodata节</li><li>.plt节：过程链接表(Procedure Linkage Table)，包含动态连接器调用从共享库导入的函数所需的代码</li><li>.data节：存在于data段中，保存了初始化的全局变量数据</li><li>.bss节：存于data段中，保存未进行初始化的全局数据，初始化为0，程序执行可进行赋值</li><li>.got.plt节：全局偏移表-过程链接表，.got节保存全局偏移表，.got和.plt节一起提供了对导入的共享库函数的访问入口，由动态连接器在运行时进行修改</li><li>.dynstr节：动态链接字符串表，存放了一系列字符串，空字符作为终止符</li></ul><p><strong>断点</strong></p><ul><li>软件断点：<code>int 3</code>|<code>0xcc</code> 执行触发程序异常：<code>breakpoint_</code>，或产生其他异常如<code>0xce</code></li><li>硬件断点：调试寄存器DR0~DR3设定地址，用DR7设定状态，最多4个<ul><li>读/写/执行某精准地址产生异常</li></ul></li><li>内存断点：设置地址不可访问/写属性，读/写/执行该内存时产生异常，调试器判断并接管异常<ul><li>改变某分页属性，与<code>VirtualProtect</code>函数有关</li><li>以一整个分页为单位的断点</li></ul></li><li>条件断点：满足特定条件，暂停执行</li></ul><h3 id=大小端序>大小端序</h3><p>字符存储为小端序，所以编写脚本计算时需要将其<strong>倒序</strong></p><p>栈上是小端序存储的</p><h3 id=python>Python</h3><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-Python"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>itertools</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>choices</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;1&#34;</span><span class=p>,</span> <span class=s2>&#34;2&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>combinations</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=n>itertools</span><span class=o>.</span><span class=n>product</span><span class=p>(</span><span class=n>choices</span><span class=p>,</span> <span class=n>repeat</span><span class=o>=</span><span class=mi>7</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=c1># 7位, 每一位可以为 choices 中的任何一个, 生成所有可能值</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>num</span><span class=si>:</span><span class=s2>02x</span><span class=si>}</span><span class=s2>&#34;</span> <span class=k>for</span> <span class=n>num</span> <span class=ow>in</span> <span class=n>int_array</span><span class=p>]</span> <span class=c1># 整型数组以十六进制输出, 不足用0补足</span></span></span></code></pre></div></div><ul><li><code>ord()</code>: <strong>字符</strong> 转换为对应的 <strong>ASCII 码值</strong></li><li><code>chr()</code>: <strong>ASCII 码值</strong> 转换为对应的 <strong>字符</strong></li></ul><p><strong>转换</strong></p><p>可以尝试用CyberChef转换，output中的<strong>魔法棒</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-Python"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=n>binary_data</span> <span class=o>=</span> <span class=nb>bytes</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=n>content</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># 字节字符串 &#34;0x89&#34; &#34;0x50&#34; 转换为真字节 b&#39;\x89&#39; b&#39;P&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>hex_data</span> <span class=o>=</span> <span class=n>binary_data</span><span class=o>.</span><span class=n>hex</span><span class=p>()</span> 
</span></span><span class=line><span class=cl><span class=c1># 真字节b&#39;\x89&#39; 转换为字符串&#34;89&#34;, 有时需要binary[::-1]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>hex_type</span> <span class=o>=</span> <span class=nb>hex</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>binary_data</span><span class=o>.</span><span class=n>hex</span><span class=p>(),</span> <span class=mi>16</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=c1># 真字节b&#39;\x89&#39; 转换为十六进制字符串&#39;0x89&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>val</span> <span class=o>=</span> <span class=n>val</span><span class=o>.</span><span class=n>rstrip</span><span class=p>(</span><span class=s1>&#39;h&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>hex_value</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>val</span><span class=p>,</span> <span class=mi>16</span><span class=p>)</span> <span class=c1># 十六进制字符 &#34;0xabc&#34; 直接转整型 2748</span>
</span></span><span class=line><span class=cl><span class=n>binary_value</span> <span class=o>=</span> <span class=nb>format</span><span class=p>(</span><span class=n>hex_value</span><span class=p>,</span> <span class=s1>&#39;08b&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># 十六进制字符串 &#34;FFh&#34; &#34;D8h&#34; 转换为对应的8位二进制数 &#39;11111111&#39; &#39;11011000&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>byte_val</span> <span class=o>=</span> <span class=n>char_val</span><span class=o>.</span><span class=n>encode</span><span class=p>()</span> <span class=c1># 字符串&#39;2024&#39; 转换为字节 b&#39;2024&#39;</span></span></span></code></pre></div></div><p><strong>数据处理</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-Python"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=n>data</span> <span class=o>=</span> <span class=s1>&#39;&#39;&#39;xjowefg, feiwow
</span></span></span><span class=line><span class=cl><span class=s1>    ewioa,  efils , fefe # 杂乱的数据&#39;&#39;&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 清理逗号等</span>
</span></span><span class=line><span class=cl><span class=n>hex_values</span> <span class=o>=</span> <span class=p>[</span><span class=n>val</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span> <span class=k>for</span> <span class=n>val</span> <span class=ow>in</span> <span class=n>data</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s1>&#39;</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>,</span> <span class=s1>&#39;,&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;,&#39;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 每行输出10个</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>hex_values</span><span class=p>),</span> <span class=mi>10</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;, &#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>hex_values</span><span class=p>[</span><span class=n>i</span><span class=p>:</span><span class=n>i</span><span class=o>+</span><span class=mi>10</span><span class=p>]))</span></span></span></code></pre></div></div><p><strong>类</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-python"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>A</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__str__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># __xx__魔术内置方法，一般python解释器自动调用</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nb>str</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1># 静态方法: 用于创建类的实例，分配内存创建对象</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__new__</span><span class=p>(</span><span class=bp>cls</span><span class=p>,</span> <span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nb>super</span><span class=p>(</span><span class=n>A</span><span class=p>,</span> <span class=bp>cls</span><span class=p>)</span><span class=o>.</span><span class=fm>__new__</span><span class=p>(</span><span class=bp>cls</span><span class=p>,</span> <span class=o>*</span><span class=n>args</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nd>@property</span> <span class=c1># 方法转换为同名的只读属性 instance.aaa来访问</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>aaa</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>aaa</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>A1</span> <span class=o>=</span> <span class=n>package</span><span class=o>.</span><span class=n>A</span><span class=p>()</span></span></span></code></pre></div></div><p><strong>map</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-python"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nb>map</span><span class=p>(</span><span class=n>function</span><span class=p>,</span> <span class=n>iterable</span><span class=p>)</span> <span class=c1># 对iterable中的每个元素应用function</span></span></span></code></pre></div></div><p><strong>pip</strong></p><p>安装指定版本的包会将原先的包给卸载，代替为指定版本</p><p><strong>进程subprocess</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-python"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>ctypes</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>start_suspended_process</span><span class=p>(</span><span class=n>proc_name</span><span class=p>):</span> <span class=c1># 启动并挂起进程</span>
</span></span><span class=line><span class=cl>    <span class=n>creation_flags</span> <span class=o>=</span> <span class=mh>0x14</span>
</span></span><span class=line><span class=cl>    <span class=c1># CREATE_SUSPENDED=0x4: 子进程创建立即挂起</span>
</span></span><span class=line><span class=cl>    <span class=c1># CREATE_NEW_CONSOLE=0x10: 创建新的控制台窗口</span>
</span></span><span class=line><span class=cl>    <span class=n>process</span> <span class=o>=</span> <span class=n>subprocess</span><span class=o>.</span><span class=n>Popen</span><span class=p>(</span><span class=n>proc_name</span><span class=p>,</span> <span class=n>creationflags</span><span class=o>=</span><span class=n>creation_flags</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;子进程已启动并挂起&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>process</span><span class=o>.</span><span class=n>pid</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>resume_process</span><span class=p>(</span><span class=n>pid</span><span class=p>):</span> <span class=c1># 恢复进程</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>kernel32</span> <span class=o>=</span> <span class=n>ctypes</span><span class=o>.</span><span class=n>WinDLL</span><span class=p>(</span><span class=s1>&#39;kernel32&#39;</span><span class=p>,</span> <span class=n>use_last_error</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>kernel32</span><span class=o>.</span><span class=n>DebugActiveProcess</span><span class=p>(</span><span class=n>pid</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;进程 </span><span class=si>{</span><span class=n>pid</span><span class=si>}</span><span class=s2> 已恢复.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>OSError</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;恢复进程时发生错误: </span><span class=si>{</span><span class=nb>str</span><span class=p>(</span><span class=n>e</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span></span></span></code></pre></div></div><h3 id=java>JAVA</h3><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-Bash"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash><span class=line><span class=cl>java -jar xx.jar <span class=c1># 运行java文件</span></span></span></code></pre></div></div><p><strong>类型</strong></p><p><code>Byte</code>: java.lang中一个类，封装byte</p><p><code>byte</code>: 基本数据类型，整型数据1字节</p><p><strong>格式</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-Java"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>Main</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>args</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>xx</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span></span></span></code></pre></div></div><p><strong>输入输出</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-Java"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=c1>// 输出</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>System</span><span class=p>.</span><span class=na>out</span><span class=p>.</span><span class=na>println</span><span class=p>(</span><span class=s>&#34;hello&#34;</span><span class=p>);</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// 输入</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Scanner</span><span class=w> </span><span class=n>scanner</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>Scanner</span><span class=p>(</span><span class=n>System</span><span class=p>.</span><span class=na>in</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>String</span><span class=w> </span><span class=n>flag</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>scanner</span><span class=p>.</span><span class=na>next</span><span class=p>();</span><span class=w> </span><span class=o>//</span><span class=w> </span><span class=n>输入一行</span></span></span></code></pre></div></div><p><strong>数据转换</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-Java"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=c1>// 字符串 转换为 UTF-8字节</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>String</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;hello&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kt>byte</span><span class=o>[]</span><span class=w> </span><span class=n>by</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>s</span><span class=p>.</span><span class=na>getBytes</span><span class=p>(</span><span class=n>StandardCharsets</span><span class=p>.</span><span class=na>UTF_8</span><span class=p>);</span><span class=w> </span><span class=c1>// by[i]输出为第i+1个字符的ASCII码值</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// byte 转换为 Byte</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Byte</span><span class=w> </span><span class=n>byte_</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Byte</span><span class=p>.</span><span class=na>valueOf</span><span class=p>(</span><span class=n>by</span><span class=o>[</span><span class=n>0</span><span class=o>]</span><span class=p>);</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>byte_</span><span class=p>.</span><span class=na>byteValue</span><span class=p>()</span><span class=w> </span><span class=o>//</span><span class=w> </span><span class=n>取值</span></span></span></code></pre></div></div><p><strong>异常</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-Java"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=n>Exception</span><span class=o>[]</span><span class=w> </span><span class=n>exceptions</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>{</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>(</span><span class=n>Exception</span><span class=p>)</span><span class=k>new</span><span class=w> </span><span class=n>BuDaoLePaoException</span><span class=p>(),</span><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>(</span><span class=n>Exception</span><span class=p>)</span><span class=k>new</span><span class=w> </span><span class=n>DxIsNanTongException</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>try</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>xxx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>BuDaoLePaoException</span><span class=w> </span><span class=n>ex0</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>xxx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>DxIsNanTongException</span><span class=w> </span><span class=n>ex1</span><span class=p>){</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>xxx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w> </span><span class=k>catch</span><span class=w> </span><span class=p>(</span><span class=n>Exception</span><span class=w> </span><span class=n>e</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>RuntimeException</span><span class=p>(</span><span class=n>e</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w> </span></span></span></code></pre></div></div><h3 id=寄存器>寄存器</h3><p>x86中寄存器：EBP、ESP、EIP、EAX、EBX、ECX、EDX、EDI、ESI</p><p>x86-64中寄存器：RBP、RSP、RIP、RAX、RBX、RCX、RDX、RDI、RSI、R8~R15</p><h2 id=工具>工具</h2><h3 id=gdb>GDB</h3><p><strong>查看格式</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><pre tabindex=0><code>x/nfu &lt;addr&gt;
x: examine
n: 个数
f:显示方式
    x:十六进制 d:十进制 u:十进制无符号 o:八进制 t:二进制
    a:十六进制 i:地址格式 c:字符格式 f:浮点数
u:地址单元长度
    b:单字节 h:双字节 w:四字节 g:八字节</code></pre></div><p>针对汇编<code>cmp eax, DWORD PTR [rbp-0x94]</code>查看地址中内容</p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-Bash"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash><span class=line><span class=cl>b *xxx <span class=c1># 通过objdump确定设置断点的地址</span>
</span></span><span class=line><span class=cl>x/wx <span class=nv>$rbp</span>-0x94 <span class=c1># gdb中查看内容</span>
</span></span><span class=line><span class=cl>x/sw <span class=nv>$eax</span> <span class=c1># eax中内容以字符串形式显示</span></span></span></code></pre></div></div><p>命令</p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-Bash"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash><span class=line><span class=cl>disassemble func <span class=c1># 查看函数反汇编</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>info registers <span class=c1># 查看寄存器地址</span></span></span></code></pre></div></div><h3 id=ida>IDA</h3><p><strong>取IDA数据时，小端序取，4个4个倒过来取</strong></p><p>函数窗口：<code>ctrl+F</code>搜索函数</p><p>导入函数窗口：<code>Imports</code>窗口，导入的一些函数</p><p>添加反汇编注释：<code>option > general > Display disassembly line parts > Auto comments</code></p><p>反汇编窗口字体调整：<code>option > font</code></p><p>十六进制窗口编辑：<code>F2</code>，<code>F2</code>保存</p><p>函数窗口中<code>shift+F5</code>打开应用库模块列表，继续按<code>insert</code>键打开可用库模块列表，进行导入</p><p>使用<code>d</code>可以将数据改变大小从byte转换为2bytes-word，4bytes-dword，8bytes-qword</p><p>或者右键设置<code>Array</code>，改变数组显示</p><p><code>undefine</code>可以将识别错误的代码取消，然后右键将字节转换为相应类型</p><p>清除指针类型用于重新定义结构体：右键 > <code>Reset pointer type</code></p><p><code>db, dw, dd, dq </code>分别代表 <strong>1, 2, 4, 8</strong> 字节</p><p>一般直接 <code>shift + F12</code> 找字符串窗口，对应字符位置<code>ctrl + x</code> 找到函数</p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><pre tabindex=0><code>db 2 dup(14h)`表示 define byte定义字节，2个`14h</code></pre></div><p>查看机器码：<code>Options </code>> <code>General </code>> <code>opcode</code></p><p><strong>应用</strong>：</p><p><strong>变量为64位，8字节，则在栈中需要8字节空间</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-C"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-C data-lang=C><span class=line><span class=cl><span class=kt>int</span> <span class=n>v1</span><span class=p>[]</span> <span class=o>=</span> <span class=p>{</span><span class=mi>2</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>4</span><span class=p>};</span>
</span></span><span class=line><span class=cl><span class=nf>func</span><span class=p>((</span><span class=kr>__int64</span><span class=p>)</span><span class=n>v1</span><span class=p>);</span> <span class=c1>// 表示将v1的地址转为64位整数
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=o>*</span><span class=p>(</span><span class=n>_DWORD</span> <span class=o>*</span><span class=p>)(</span><span class=n>v1</span> <span class=o>+</span> <span class=n>v2</span><span class=p>)</span> <span class=o>+</span> <span class=n>v3</span><span class=p>;</span> <span class=c1>// v1数组偏移v2的地址处取一个32位整数(dword)值 与v3相加
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=o>*</span><span class=p>(</span><span class=n>_QWORD</span> <span class=o>*</span><span class=p>)</span><span class=n>List</span> <span class=c1>// 读取 List 的前 64 位数据
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>(</span><span class=n>_DWORD</span><span class=p>)</span><span class=n>v4</span> <span class=c1>// 取低32位
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=p>(</span><span class=n>result</span> <span class=o>&gt;&gt;</span> <span class=mi>32</span><span class=p>)</span> <span class=o>&amp;</span> <span class=mh>0xFFFFFFFF</span>  <span class=c1>// 取高32位
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>(</span><span class=n>result</span><span class=p>)</span>       <span class=o>&amp;</span> <span class=mh>0xFFFFFFFF</span>  <span class=c1>// 取低32位
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>unsigned</span> <span class=kt>int</span> <span class=n>v4</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kr>__int64</span> <span class=n>a1</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=o>*</span><span class=p>(</span><span class=n>_DWORD</span> <span class=o>*</span><span class=p>)(</span><span class=n>a1</span> <span class=o>+</span> <span class=mi>4</span><span class=n>i64</span> <span class=o>*</span> <span class=p>(</span><span class=n>v4</span> <span class=o>&amp;</span> <span class=mi>3</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=c1>// v4 &amp; 3(11) 即取低两位, 确保为 0,1,2,3, a1表示某内存区域首地址
</span></span></span><span class=line><span class=cl><span class=c1>// 4i64为一个4字节, 作为a1偏移的单位, 即a1偏移0|1|2|3个4字节的位置取一个DWORD32位
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=nf>__halt</span><span class=p>();</span> <span class=c1>// 暂停处理器
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>unsigned</span> <span class=n>_int8</span> <span class=c1>// 无符号8位整型
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>int</span> <span class=c1>// 32位整型
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>.</span><span class=nl>data</span><span class=p>:</span><span class=mo>0000000140022000</span> <span class=n>array</span>  <span class=n>db</span> <span class=mi>0</span><span class=n>A3h</span><span class=p>,</span> <span class=mi>69</span><span class=n>h</span><span class=p>,</span> <span class=mi>96</span><span class=n>h</span><span class=p>,</span> <span class=mi>26</span><span class=n>h</span><span class=p>,</span> <span class=mi>0</span><span class=n>BDh</span><span class=p>,</span> <span class=mi>78</span><span class=n>h</span><span class=p>,</span> <span class=mi>0</span><span class=n>Bh</span><span class=p>,</span> <span class=mi>3</span><span class=n>Dh</span><span class=p>,</span> <span class=mi>9</span><span class=n>Dh</span><span class=p>,</span> <span class=mi>0</span><span class=n>A5h</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>data</span><span class=p>:</span><span class=mo>0000000140022000</span>                                  <span class=p>;</span> <span class=n>DATA</span> <span class=nl>XREF</span><span class=p>:</span> <span class=n>main_0</span><span class=o>+</span><span class=mi>202</span><span class=err>↑</span><span class=n>o</span>
</span></span><span class=line><span class=cl><span class=p>.</span><span class=nl>data</span><span class=p>:</span><span class=mo>000000014002200</span><span class=n>A</span>        <span class=n>db</span> <span class=mi>28</span><span class=n>h</span><span class=p>,</span> <span class=mi>62</span><span class=n>h</span><span class=p>,</span> <span class=mi>34</span><span class=n>h</span> <span class=nf>dup</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 此处存储一般为 0x269669a3, 0x3d0b780b, 0x6228a59d
</span></span></span></code></pre></div></div><p><strong>插件</strong>：</p><p><code>Ctrl + 3</code>：呼出插件</p><ul><li><p><strong>Findcrypt</strong>：IDA9中成功，IDA7.5, 7.7, 8.3中都不显示</p><ul><li><code>edit</code> > <code>Plugins</code> > <code>Findcrypt</code>：可以找到<code>MD5, DES, CRC</code>等</li></ul></li><li><p><strong>E-Decompiler</strong>：IDA7.5，对易语言进行分析插件</p><ul><li><p><code>ida.cfg</code>文件解除<code>Block_CJK_Unified_Ideographs</code>前的注释</p></li><li><p><code>ida.dll</code>文件用IDA64打开，搜索<code>[](),</code>，将有下划线一行nop掉</p></li><li><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-c"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span> <span class=o>!</span><span class=n>v8</span> <span class=o>||</span> <span class=o>!</span><span class=nf>strchr</span><span class=p>(</span><span class=s>&#34; [](),*&amp;&#34;</span><span class=p>,</span> <span class=n>v11</span><span class=p>)</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span> <span class=n>v10</span> <span class=o>-</span> <span class=n>v9</span> <span class=o>&lt;</span> <span class=mi>8</span> <span class=o>||</span> <span class=nf>strncmp</span><span class=p>(</span><span class=n>v10</span> <span class=o>-</span> <span class=mi>8</span><span class=p>,</span> <span class=s>&#34;operator&#34;</span><span class=p>,</span> <span class=mi>8u</span><span class=n>i64</span><span class=p>)</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=nl>LABEL_23</span><span class=p>:</span>
</span></span><span class=line><span class=cl>          <span class=o>*</span><span class=n>v10</span> <span class=o>=</span> <span class=sc>&#39;_&#39;</span><span class=p>;</span> <span class=c1>// nop!
</span></span></span></code></pre></div></div></li><li><p>装入插件可显示中文函数及易语言反编译</p></li></ul></li><li><p><strong>Scyllahide</strong>：反反调试工具，IDA7.5，注意要明确调试代码是<strong>32</strong>位还是<strong>64</strong>位！！</p><ul><li>反调试报错：<code>XXXXXXXX:unknown exception code 0 (exc.code 0, tid XXXXX)</code></li><li>64位调试32位程序使用Scyllahide后会报错</li><li>设置扩展参数</li></ul><img src=/img/reverse_note.zh-cn.assets/image-20241022105920446.png alt=图片无法加载><ul><li>运行<code>ScyllaHideIDAServerx86.exe</code>，并开始动态调试，可绕过debug检测</li></ul></li></ul><p><strong>快捷键</strong>：</p><p><code>A</code>：转换为字符串（ASCII）</p><p><code>R</code>：转换为char型</p><p><code>C</code>：转换为代码（code）</p><p><code>ctrl+shift+w</code>：IDA不提供撤消，使用快照功能【<code>file > take database snapshot</code>】</p><p><code>ctrl+E</code>：函数窗口对函数进行编辑</p><p><code>X</code>：查看函数的交叉引用，如何被引用</p><p><code>Y</code>：修改局部变量类型</p><p><code>;</code>：汇编界面添加注释</p><p><code>/</code>：伪代码界面添加注释</p><p><code>Ctrl + P</code>：函数跳转</p><p><code>Alt + T</code>：搜索文本字符串</p><p><code>Shift + F2</code>：脚本执行窗口</p><p><code>F6</code>：回到最近操作的窗口</p><p><code>Ctrl + x</code>：对变量输入，可以获取哪个函数使用了这个变量</p><p><strong>动态调试</strong></p><p>选择Load WIndows debugger调试器，设置断点在某一代码行，需要在<code>Debugger</code>中打开<code>Use source-level debugging</code></p><img src=/img/reverse_note.zh-cn.assets/17284517325159.png alt=图片无法加载><p><code>F7</code>: 单步步入</p><p><code>F8</code>: 单步步出</p><p><code>F9</code>: 直接跳到下一个断点</p><p><code>Ctrl + F7</code>: 直到返回跳出函数</p><p>可以点击寄存器区的寄存器箭头前往hex程序区</p><p>想查看某变量变化：<code>右键</code> > <code>Add Watch</code></p><p><strong>断点</strong></p><ul><li>可下多个断点，F9直接跳转；</li><li>内存断点，对数据段进行断点，每次读写该区域将会提示并停止：<code>点击数据所在地址</code> > <code>F2</code> > <code>设置是否读写 + 设置Size(可观察数组)</code></li></ul><p><strong>远程调试(如windows调试linux下文件)</strong></p><ol><li>IDA pro安装目录下的<code>dbgsrv</code>文件夹下选择调试的程序linux_server</li><li>在相应远程linux主机设置权限并执行linux_server</li><li>IDA选择Remote Linux debugger，<code>Debugger > Process options</code>，设置远程Linux IP地址</li></ol><p><code>__debugbreak()</code>：在代码中引入断点，系统会提示用户运行调试器</p><h3 id=ghidra>Ghidra</h3><p><code>Symbol Tree</code>中包含<code>Functions</code>, <code>Classes</code>等，在<code>m</code>中有main函数</p><p><strong>查看函数调用关系</strong>：<code>Window</code> > <code>Function Call Graph</code></p><p><strong>变量重命名</strong>：<code>右键</code> > <code>Rename Variable</code>，快捷键<code>l</code></p><p><strong>点亮所有变量</strong>：鼠标中键</p><p><strong>注释</strong>：<code>右键</code> > <code>Comments</code></p><p><strong>改函数签名</strong>：<code>右键</code> > <code>Edit Function Signature</code></p><p><strong>改数字的进制</strong>：右键</p><h3 id=frida>Frida</h3><p>可用于调试hook Windows的exe可执行文件进程</p><p>pip安装出现：<code>拒绝访问。</code>，以管理员身份运行</p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-bash"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>pip install <span class=nv>frida</span><span class=o>==</span>16.4.10 <span class=c1># 16.5.1 win10报错不支持, win11可以</span>
</span></span><span class=line><span class=cl>pip install frida-tools</span></span></code></pre></div></div><h3 id=die>DIE</h3><p>（Detect It Easy）查壳工具</p><h3 id=exeinfo-pe>Exeinfo PE</h3><p>查壳工具</p><h3 id=ollydbg>OllyDbg</h3><p>只适用32位，不再更新</p><p><code>F2</code>：下断点</p><p><code>F4</code>：运行到光标位置</p><p><code>F7</code>：单步步入</p><p><code>F8</code>：单步步过</p><p><code>F9</code>：运行，到断点处</p><p><code>F12</code>：暂停运行程序</p><p>重新开始：<code>x</code>图标 + <code>&lt;&lt;</code>图标</p><p>插件 > 中文搜索引擎 > 搜索 ASCII：找字符串</p><p>查看函数调用：右键 > 查看调用树</p><p>双击代码和注释都可直接进行修改</p><p><strong>查找数据并修改</strong>：数据窗口 > <code>Alt + M</code>打开Memory map > <code>Ctrl + B</code>进行搜索 > 右键可以修改，需要进行保存【右键复制到可执行文件】 > 保存文件</p><p><strong>跳出循环</strong>：右键 > 断点 > 运行到选定位置</p><p><strong>工具栏窗口</strong>：</p><p>1.日志窗口(L) 2.模块窗口(E):查看每个模块的内存基址</p><p>3.内存窗口(M):查看每一个模块的段,所占用的内存区域</p><p>4.线程窗口(T):线程信息</p><p>5.窗口(W):查看程序的窗口句柄,窗口名,风格样式,回调函数等信息</p><p>6.句柄(H)</p><p>7.反汇编窗口( C)</p><p>8.补丁窗口(/)</p><p>9:<strong>堆栈窗口(K)</strong>:可查看调用堆栈,调试时堆栈回溯：<code>右键</code> > <code>显示调用</code></p><p>10.断点窗口(B):显示所有的F2断点</p><p>11.参考( R)</p><p>12.run跟踪窗口(…)</p><h3 id=x64dbg>x64dbg</h3><p>适用于32位和64位调试</p><table><thead><tr><th>反汇编显示区</th><th>寄存器显示区</th></tr></thead><tbody><tr><td>内存数据显示区</td><td>栈显示区</td></tr></tbody></table><ul><li><strong>运行到用户代码 点击</strong></li><li><code>Az</code>图标：查看字符串</li></ul><p>循环箭头按键：为重新运行</p><p>右箭头按键：直接运行</p><p>快捷键：</p><p><code>ctrl+G</code>：跳转到目标地址/表达式</p><p><code>F2</code>：下断点</p><p><code>F4</code>：运行到光标位置</p><p><code>F7</code>：单步步入</p><p><code>F8</code>：单步步过</p><p><code>F9</code>：运行</p><p><strong>空格修改汇编代码</strong></p><p>可以右键修改十六进制代码：修复错误时将字节改为<strong>90</strong>(<strong>nop</strong>)</p><p>可以对代码转到对应的内存空间位置：右键 > 在内存布局中转到</p><p>搜索命令：右键 > 所有用户模块 > 命令，如寻找<code>pushad</code></p><h3 id=gdbpwndbg>GDB/PWNDBG</h3><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-Bash"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash><span class=line><span class=cl><span class=nb>set</span> var $<span class=nv>寄存器</span> <span class=o>=</span> expr <span class=c1>#修改寄存器的值</span>
</span></span><span class=line><span class=cl><span class=nb>set</span> <span class=o>{</span>type<span class=o>}</span><span class=nv>address</span> <span class=o>=</span> expr <span class=c1>#给存储在address地址的变量类型为type的变量赋值</span>
</span></span><span class=line><span class=cl>Fin：运行当前函数直到结束</span></span></code></pre></div></div><h3 id=upxshell>UPXshell</h3><p>在Windows下进行UPX脱壳</p><h3 id=jadx>Jadx</h3><p>APK分析工具</p><p>获取反编译后的JAVA原码且可视化，能打开文件格式：<code>.apk, .dex, .jar, .class, .smali, .zip, .aar, .ars</code></p><h3 id=jd-gui>jd-gui</h3><p>反编译jar包，获取JAVA源码</p><h3 id=ilspy>ILSpy</h3><p>用于<code>dll</code>文件的逆向，可以查看<code>Program</code>程序代码</p><h3 id=z3-solver>Z3-Solver</h3><ul><li><code>pip install -i ``https://pypi.tuna.tsinghua.edu.cn/simple`` z3-solver</code>指定镜像源安装</li><li>一般输入的是字符串，但最终将字符串转换为了数值进行计算，最终获取数值还需要转换回字符串，注意参与计算的数值之间的顺序（小端序，如何输入）</li><li>Linux下运行</li></ul><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-python"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>z3</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>libnum</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 定义变量</span>
</span></span><span class=line><span class=cl><span class=n>v1</span> <span class=o>=</span> <span class=n>BitVec</span><span class=p>(</span><span class=s1>&#39;v1&#39;</span><span class=p>,</span> <span class=mi>64</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>v2</span> <span class=o>=</span> <span class=n>BitVec</span><span class=p>(</span><span class=s1>&#39;v2&#39;</span><span class=p>,</span> <span class=mi>64</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>solver</span> <span class=o>=</span> <span class=n>Solver</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=c1># 加入表达式</span>
</span></span><span class=line><span class=cl><span class=n>solver</span><span class=o>.</span><span class=n>add</span><span class=p>((</span><span class=n>v1</span> <span class=o>&amp;</span> <span class=n>v2</span> <span class=o>^</span> <span class=p>(</span><span class=n>v1</span> <span class=o>|</span> <span class=o>~</span><span class=p>(</span><span class=n>v1</span> <span class=o>+</span> <span class=n>v2</span><span class=p>))</span> <span class=o>&amp;</span> <span class=n>v2</span> <span class=o>&amp;</span> <span class=n>v1</span><span class=p>)</span> <span class=o>!=</span> <span class=mh>0xdeadbeef</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=n>solver</span><span class=o>.</span><span class=n>check</span><span class=p>()</span> <span class=o>==</span> <span class=n>sat</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=o>=</span> <span class=n>solver</span><span class=o>.</span><span class=n>model</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>result</span><span class=p>)</span> <span class=c1># 获取所有结果</span>
</span></span><span class=line><span class=cl>    <span class=n>v1_val</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>result</span><span class=p>[</span><span class=n>v1</span><span class=p>]</span><span class=o>.</span><span class=n>as_long</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>v1_val</span><span class=p>)</span> <span class=c1># 获取单个结果</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>n2s</span><span class=p>(</span><span class=n>v1_val</span><span class=p>)[::</span><span class=o>-</span><span class=mi>1</span><span class=p>])</span> <span class=c1># 逆序转换为字符串</span></span></span></code></pre></div></div><h3 id=qemu>QEMU</h3><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-Bash"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash><span class=line><span class=cl><span class=c1># 创建虚拟磁盘</span>
</span></span><span class=line><span class=cl>qemu-img create -f raw hello.img 10G</span></span></code></pre></div></div><p>运行riscv程序</p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-bash"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo apt install qemu-user
</span></span><span class=line><span class=cl>chmod +x ./elf
</span></span><span class=line><span class=cl>qemu-riscv64 ./elf</span></span></code></pre></div></div><h2 id=算法>算法</h2><h3 id=tea系列>TEA系列</h3><p>均会使用特征值$\delta$：<strong>0x9e3779b9</strong>，在IDA中可能使用补码表示：<strong>0x61c88647</strong>，可使用python：</p><p><strong><code>hex(0xffffffff - 0x61c88647 + 1)</code></strong> <strong>得到 0x9e3779b9</strong></p><h4 id=tea>TEA</h4><p>Tiny Encryption Algorithm，使用Feistel分组加密框架，64轮迭代，原文以8字节(64位)为一组，密钥16字节(128位)，具体实现过程：</p><img src=/img/reverse_note.zh-cn.assets/172845173251510.png alt=图片无法加载><p><strong>汇编判断</strong>：花指令</p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-assembly"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><pre tabindex=0><code class=language-assembly data-lang=assembly>mov ecx, xxx
shl ecx, 4
add ecx, xxx
mov edx, xxx
add edx, xxx
xor ecx, edx
mov eax, xxx
shr eax, 5</code></pre></div><p><strong>加解密实现</strong></p><div class="code-block code-line-numbers" style="counter-reset:code-block 0"><div class="code-header language-C"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-C data-lang=C><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdint.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=c1>// 无论是64位还是32位都可以使用uint32_t
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>//加密函数
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>void</span> <span class=nf>encrypt</span> <span class=p>(</span><span class=kt>uint32_t</span><span class=o>*</span> <span class=n>v</span><span class=p>,</span> <span class=kt>uint32_t</span><span class=o>*</span> <span class=n>k</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>uint32_t</span> <span class=n>v0</span><span class=o>=</span><span class=n>v</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>v1</span><span class=o>=</span><span class=n>v</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=n>sum</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span> <span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>uint32_t</span> <span class=n>delta</span><span class=o>=</span><span class=mh>0x9e3779b9</span><span class=p>;</span> <span class=c1>// 固定值
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>uint32_t</span> <span class=n>k0</span><span class=o>=</span><span class=n>k</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>k1</span><span class=o>=</span><span class=n>k</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=n>k2</span><span class=o>=</span><span class=n>k</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span> <span class=n>k3</span><span class=o>=</span><span class=n>k</span><span class=p>[</span><span class=mi>3</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=mi>32</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span> <span class=c1>// 实际64轮, 此处一次循环两轮
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>sum</span> <span class=o>+=</span> <span class=n>delta</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>v0</span> <span class=o>+=</span> <span class=p>((</span><span class=n>v1</span><span class=o>&lt;&lt;</span><span class=mi>4</span><span class=p>)</span> <span class=o>+</span> <span class=n>k0</span><span class=p>)</span> <span class=o>^</span> <span class=p>(</span><span class=n>v1</span> <span class=o>+</span> <span class=n>sum</span><span class=p>)</span> <span class=o>^</span> <span class=p>((</span><span class=n>v1</span><span class=o>&gt;&gt;</span><span class=mi>5</span><span class=p>)</span> <span class=o>+</span> <span class=n>k1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>v1</span> <span class=o>+=</span> <span class=p>((</span><span class=n>v0</span><span class=o>&lt;&lt;</span><span class=mi>4</span><span class=p>)</span> <span class=o>+</span> <span class=n>k2</span><span class=p>)</span> <span class=o>^</span> <span class=p>(</span><span class=n>v0</span> <span class=o>+</span> <span class=n>sum</span><span class=p>)</span> <span class=o>^</span> <span class=p>((</span><span class=n>v0</span><span class=o>&gt;&gt;</span><span class=mi>5</span><span class=p>)</span> <span class=o>+</span> <span class=n>k3</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>v</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>=</span><span class=n>v0</span><span class=p>;</span> <span class=n>v</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>=</span><span class=n>v1</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>//解密函数 循环内颠倒顺序
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>void</span> <span class=nf>decrypt</span> <span class=p>(</span><span class=kt>uint32_t</span><span class=o>*</span> <span class=n>v</span><span class=p>,</span> <span class=kt>uint32_t</span><span class=o>*</span> <span class=n>k</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>uint32_t</span> <span class=n>v0</span><span class=o>=</span><span class=n>v</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>v1</span><span class=o>=</span><span class=n>v</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=n>sum</span><span class=o>=</span><span class=mh>0xC6EF3720</span><span class=p>,</span> <span class=n>i</span><span class=p>;</span> <span class=c1>// sum是32次循环的delta之和
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>uint32_t</span> <span class=n>delta</span><span class=o>=</span><span class=mh>0x9e3779b9</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>uint32_t</span> <span class=n>k0</span><span class=o>=</span><span class=n>k</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>k1</span><span class=o>=</span><span class=n>k</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=n>k2</span><span class=o>=</span><span class=n>k</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span> <span class=n>k3</span><span class=o>=</span><span class=n>k</span><span class=p>[</span><span class=mi>3</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span> <span class=n>i</span><span class=o>&lt;</span><span class=mi>32</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>v1</span> <span class=o>-=</span> <span class=p>((</span><span class=n>v0</span><span class=o>&lt;&lt;</span><span class=mi>4</span><span class=p>)</span> <span class=o>+</span> <span class=n>k2</span><span class=p>)</span> <span class=o>^</span> <span class=p>(</span><span class=n>v0</span> <span class=o>+</span> <span class=n>sum</span><span class=p>)</span> <span class=o>^</span> <span class=p>((</span><span class=n>v0</span><span class=o>&gt;&gt;</span><span class=mi>5</span><span class=p>)</span> <span class=o>+</span> <span class=n>k3</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>v0</span> <span class=o>-=</span> <span class=p>((</span><span class=n>v1</span><span class=o>&lt;&lt;</span><span class=mi>4</span><span class=p>)</span> <span class=o>+</span> <span class=n>k0</span><span class=p>)</span> <span class=o>^</span> <span class=p>(</span><span class=n>v1</span> <span class=o>+</span> <span class=n>sum</span><span class=p>)</span> <span class=o>^</span> <span class=p>((</span><span class=n>v1</span><span class=o>&gt;&gt;</span><span class=mi>5</span><span class=p>)</span> <span class=o>+</span> <span class=n>k1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>sum</span> <span class=o>-=</span> <span class=n>delta</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>v</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>=</span><span class=n>v0</span><span class=p>;</span> <span class=n>v</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>=</span><span class=n>v1</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 短数据加解密
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>uint32_t</span> <span class=n>v</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span><span class=o>=</span><span class=p>{</span><span class=mi>1</span><span class=p>,</span><span class=mi>2</span><span class=p>},</span><span class=n>k</span><span class=p>[</span><span class=mi>4</span><span class=p>]</span><span class=o>=</span><span class=p>{</span><span class=mi>2</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span><span class=mi>3</span><span class=p>,</span><span class=mi>4</span><span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=c1>// v为要加密的数据是两个32位无符号整数
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// k为加密解密密钥，为4个32位无符号整数，即密钥长度为128位
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;加密前原始数据：%u %u</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>v</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span><span class=n>v</span><span class=p>[</span><span class=mi>1</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>    <span class=nf>encrypt</span><span class=p>(</span><span class=n>v</span><span class=p>,</span> <span class=n>k</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;加密后的数据：%u %u</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>v</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span><span class=n>v</span><span class=p>[</span><span class=mi>1</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>    <span class=nf>decrypt</span><span class=p>(</span><span class=n>v</span><span class=p>,</span> <span class=n>k</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;解密后的数据：%u %u</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>v</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span><span class=n>v</span><span class=p>[</span><span class=mi>1</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 长数据加解密
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>char</span> <span class=n>data</span><span class=p>[]</span> <span class=o>=</span> <span class=s>&#34;password123456789&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>uint32_t</span> <span class=n>key</span><span class=p>[]</span> <span class=o>=</span> <span class=p>{</span><span class=mh>0x11111111</span><span class=p>,</span><span class=mh>0x22222222</span><span class=p>,</span><span class=mh>0x33333333</span><span class=p>,</span><span class=mh>0x44444444</span><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kt>size_t</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=nf>strlen</span><span class=p>(</span><span class=n>data</span><span class=p>)</span><span class=o>/</span><span class=mi>8</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=nf>encrypt</span><span class=p>((</span><span class=kt>uint32_t</span><span class=o>*</span><span class=p>)</span><span class=o>&amp;</span><span class=n>data</span><span class=p>[</span><span class=n>i</span><span class=o>*</span><span class=mi>8</span><span class=p>],</span> <span class=n>key</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;加密后：%s</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>data</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kt>size_t</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=nf>strlen</span><span class=p>(</span><span class=n>data</span><span class=p>)</span><span class=o>/</span><span class=mi>8</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=nf>decrypt</span><span class=p>((</span><span class=kt>uint32_t</span><span class=o>*</span><span class=p>)</span><span class=o>&amp;</span><span class=n>data</span><span class=p>[</span><span class=n>i</span><span class=o>*</span><span class=mi>8</span><span class=p>],</span> <span class=n>key</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;解密后：%s</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>data</span><span class=p>);</span> 
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div><h4 id=xtea>XTEA</h4><p>Delta值可以更改，<strong>tea</strong>取 key 的时候是固定下标取的，现在通过<strong>计算</strong>取</p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-C"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-C data-lang=C><span class=line><span class=cl><span class=cp>#include</span><span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span><span class=cpf>&lt;stdint.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span> 
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>encipher</span><span class=p>(</span><span class=kt>unsigned</span> <span class=kt>int</span> <span class=n>num_rounds</span><span class=p>,</span> <span class=kt>uint32_t</span> <span class=n>v</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span> <span class=kt>uint32_t</span> <span class=k>const</span> <span class=n>key</span><span class=p>[</span><span class=mi>4</span><span class=p>]){</span>
</span></span><span class=line><span class=cl>        <span class=kt>unsigned</span> <span class=kt>int</span> <span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kt>uint32_t</span> <span class=n>v0</span><span class=o>=</span><span class=n>v</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span><span class=n>v1</span><span class=o>=</span><span class=n>v</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span><span class=n>sum</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span><span class=n>delta</span><span class=o>=</span><span class=mh>0x9E3779B9</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span><span class=p>(</span><span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>num_rounds</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>                <span class=n>v0</span><span class=o>+=</span><span class=p>(((</span><span class=n>v1</span><span class=o>&lt;&lt;</span><span class=mi>4</span><span class=p>)</span><span class=o>^</span><span class=p>(</span><span class=n>v1</span><span class=o>&gt;&gt;</span><span class=mi>5</span><span class=p>))</span><span class=o>+</span><span class=n>v1</span><span class=p>)</span><span class=o>^</span><span class=p>(</span><span class=n>sum</span><span class=o>+</span><span class=n>key</span><span class=p>[</span><span class=n>sum</span><span class=o>&amp;</span><span class=mi>3</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>                <span class=n>sum</span><span class=o>+=</span><span class=n>delta</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=n>v1</span><span class=o>+=</span><span class=p>(((</span><span class=n>v0</span><span class=o>&lt;&lt;</span><span class=mi>4</span><span class=p>)</span><span class=o>^</span><span class=p>(</span><span class=n>v0</span><span class=o>&gt;&gt;</span><span class=mi>5</span><span class=p>))</span><span class=o>+</span><span class=n>v0</span><span class=p>)</span><span class=o>^</span><span class=p>(</span><span class=n>sum</span><span class=o>+</span><span class=n>key</span><span class=p>[(</span><span class=n>sum</span><span class=o>&gt;&gt;</span><span class=mi>11</span><span class=p>)</span><span class=o>&amp;</span><span class=mi>3</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=n>v</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>=</span><span class=n>v0</span><span class=p>;</span><span class=n>v</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>=</span><span class=n>v1</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>decipher</span><span class=p>(</span><span class=kt>unsigned</span> <span class=kt>int</span> <span class=n>num_rounds</span><span class=p>,</span><span class=kt>uint32_t</span> <span class=n>v</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span><span class=kt>uint32_t</span> <span class=k>const</span> <span class=n>key</span><span class=p>[</span><span class=mi>4</span><span class=p>]){</span>
</span></span><span class=line><span class=cl>        <span class=kt>unsigned</span> <span class=kt>int</span> <span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kt>uint32_t</span> <span class=n>v0</span><span class=o>=</span><span class=n>v</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span><span class=n>v1</span><span class=o>=</span><span class=n>v</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span><span class=n>delta</span><span class=o>=</span><span class=mh>0x9E3779B9</span><span class=p>,</span><span class=n>sum</span><span class=o>=</span><span class=n>delta</span><span class=o>*</span><span class=n>num_rounds</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span><span class=p>(</span><span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>i</span><span class=o>&lt;</span><span class=n>num_rounds</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>        <span class=n>v1</span><span class=o>-=</span><span class=p>(((</span><span class=n>v0</span><span class=o>&lt;&lt;</span><span class=mi>4</span><span class=p>)</span><span class=o>^</span><span class=p>(</span><span class=n>v0</span><span class=o>&gt;&gt;</span><span class=mi>5</span><span class=p>))</span><span class=o>+</span><span class=n>v0</span><span class=p>)</span><span class=o>^</span><span class=p>(</span><span class=n>sum</span><span class=o>+</span><span class=n>key</span><span class=p>[(</span><span class=n>sum</span><span class=o>&gt;&gt;</span><span class=mi>11</span><span class=p>)</span><span class=o>&amp;</span><span class=mi>3</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>        <span class=n>sum</span><span class=o>-=</span><span class=n>delta</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>v0</span><span class=o>-=</span><span class=p>(((</span><span class=n>v1</span><span class=o>&lt;&lt;</span><span class=mi>4</span><span class=p>)</span><span class=o>^</span><span class=p>(</span><span class=n>v1</span><span class=o>&gt;&gt;</span><span class=mi>5</span><span class=p>))</span><span class=o>+</span><span class=n>v1</span><span class=p>)</span><span class=o>^</span><span class=p>(</span><span class=n>sum</span><span class=o>+</span><span class=n>key</span><span class=p>[</span><span class=n>sum</span><span class=o>&amp;</span><span class=mi>3</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> 
</span></span><span class=line><span class=cl>        <span class=n>v</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>=</span><span class=n>v0</span><span class=p>;</span><span class=n>v</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>=</span><span class=n>v1</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl><span class=c1>// 输入十六进制, 可能需要倒序2个2个输入如: 0x12345678 , 用 0x78563412 输入
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kt>uint32_t</span> <span class=n>v</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span><span class=o>=</span><span class=p>{</span><span class=mi>1</span><span class=p>,</span><span class=mi>2</span><span class=p>};</span> 
</span></span><span class=line><span class=cl>        <span class=kt>uint32_t</span> <span class=k>const</span> <span class=n>k</span><span class=p>[</span><span class=mi>4</span><span class=p>]</span><span class=o>=</span><span class=p>{</span><span class=mi>2</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span><span class=mi>3</span><span class=p>,</span><span class=mi>4</span><span class=p>};</span>
</span></span><span class=line><span class=cl>        <span class=kt>unsigned</span> <span class=kt>int</span> <span class=n>r</span><span class=o>=</span><span class=mi>32</span><span class=p>;</span>                                <span class=c1>//这里是加密轮数，自己设置 
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;加密前原始数据：%u %u</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>v</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span><span class=n>v</span><span class=p>[</span><span class=mi>1</span><span class=p>]);</span> <span class=c1>// 更改为%x显示十六进制
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=nf>encipher</span><span class=p>(</span><span class=n>r</span><span class=p>,</span><span class=n>v</span><span class=p>,</span><span class=n>k</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;加密后原始数据：%u %u</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>v</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span><span class=n>v</span><span class=p>[</span><span class=mi>1</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>        <span class=nf>decipher</span><span class=p>(</span><span class=n>r</span><span class=p>,</span><span class=n>v</span><span class=p>,</span><span class=n>k</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;解密后原始数据：%u %u</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span><span class=n>v</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span><span class=n>v</span><span class=p>[</span><span class=mi>1</span><span class=p>]);</span> <span class=c1>// 字符ASCII范围 &lt; 0x7f | 127
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div><h4 id=xxtea>XXTEA</h4><img src=/img/reverse_note.zh-cn.assets/172845181249123.png alt=图片无法加载><p>原字符串长度可以不是<strong>4</strong>的倍数，明文分成若干固定长度块，每个块加密后，拼接</p><div class="code-block code-line-numbers" style="counter-reset:code-block 0"><div class="code-header language-C"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-C data-lang=C><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdint.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#define DELTA 0x9e3779b9
</span></span></span><span class=line><span class=cl><span class=cp>#define MX (((z &gt;&gt; 5 ^ y &lt;&lt; 2) + (y &gt;&gt; 3 ^ z &lt;&lt; 4)) ^ ((sum ^ y) + (key[(p &amp; 3) ^ e] ^ z)))
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=c1>// 混淆操作, 密码学扩散原理, xxtea特征
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>xxtea</span><span class=p>(</span><span class=kt>uint32_t</span> <span class=o>*</span><span class=n>v</span><span class=p>,</span> <span class=kt>int</span> <span class=n>n</span><span class=p>,</span> <span class=kt>uint32_t</span> <span class=k>const</span> <span class=n>key</span><span class=p>[</span><span class=mi>4</span><span class=p>]){</span>
</span></span><span class=line><span class=cl>    <span class=kt>uint32_t</span> <span class=n>y</span><span class=p>,</span> <span class=n>z</span><span class=p>,</span> <span class=n>sum</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>unsigned</span> <span class=n>p</span><span class=p>,</span> <span class=n>rounds</span><span class=p>,</span> <span class=n>e</span><span class=p>;</span> 
</span></span><span class=line><span class=cl>    <span class=c1>// 加密
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>if</span> <span class=p>(</span><span class=n>n</span> <span class=o>&gt;</span> <span class=mi>1</span><span class=p>){</span>
</span></span><span class=line><span class=cl>        <span class=n>rounds</span> <span class=o>=</span> <span class=mi>6</span> <span class=o>+</span> <span class=mi>52</span> <span class=o>/</span> <span class=n>n</span><span class=p>;</span> <span class=c1>// 循环轮数
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>sum</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>z</span> <span class=o>=</span> <span class=n>v</span><span class=p>[</span><span class=n>n</span> <span class=o>-</span> <span class=mi>1</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=k>do</span><span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>sum</span> <span class=o>+=</span> <span class=n>DELTA</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>e</span> <span class=o>=</span> <span class=p>(</span><span class=n>sum</span> <span class=o>&gt;&gt;</span> <span class=mi>2</span><span class=p>)</span> <span class=o>&amp;</span> <span class=mi>3</span><span class=p>;</span><span class=c1>// e: sum&gt;&gt;2
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=k>for</span> <span class=p>(</span><span class=n>p</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>p</span> <span class=o>&lt;</span> <span class=n>n</span> <span class=o>-</span> <span class=mi>1</span><span class=p>;</span> <span class=n>p</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>                <span class=n>y</span> <span class=o>=</span> <span class=n>v</span><span class=p>[</span><span class=n>p</span> <span class=o>+</span> <span class=mi>1</span><span class=p>];</span>
</span></span><span class=line><span class=cl>                <span class=n>z</span> <span class=o>=</span> <span class=n>v</span><span class=p>[</span><span class=n>p</span><span class=p>]</span> <span class=o>+=</span> <span class=n>MX</span><span class=p>;</span> <span class=c1>// 本质上还是双整形加密,用v[p]和v[p+1]对v[p]加密
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=c1>// v[p] += MX;
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=c1>// z = v[p];
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=n>y</span> <span class=o>=</span> <span class=n>v</span><span class=p>[</span><span class=mi>0</span><span class=p>];</span>
</span></span><span class=line><span class=cl>            <span class=n>z</span> <span class=o>=</span> <span class=n>v</span><span class=p>[</span><span class=n>n</span> <span class=o>-</span> <span class=mi>1</span><span class=p>]</span> <span class=o>+=</span> <span class=n>MX</span><span class=p>;</span> <span class=c1>// 一轮加密的最后用v[n-1]和v[0]对v[n-1]加密
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=p>}</span> <span class=k>while</span> <span class=p>(</span><span class=o>--</span><span class=n>rounds</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 解密
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>n</span> <span class=o>&lt;</span> <span class=o>-</span><span class=mi>1</span><span class=p>){</span>
</span></span><span class=line><span class=cl>        <span class=n>n</span> <span class=o>=</span> <span class=o>-</span><span class=n>n</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>rounds</span> <span class=o>=</span> <span class=mi>6</span> <span class=o>+</span> <span class=mi>52</span> <span class=o>/</span> <span class=n>n</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>sum</span> <span class=o>=</span> <span class=n>rounds</span> <span class=o>*</span> <span class=n>DELTA</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>y</span> <span class=o>=</span> <span class=n>v</span><span class=p>[</span><span class=mi>0</span><span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=k>do</span><span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>e</span> <span class=o>=</span> <span class=p>(</span><span class=n>sum</span> <span class=o>&gt;&gt;</span> <span class=mi>2</span><span class=p>)</span> <span class=o>&amp;</span> <span class=mi>3</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=p>(</span><span class=n>p</span> <span class=o>=</span> <span class=n>n</span> <span class=o>-</span> <span class=mi>1</span><span class=p>;</span> <span class=n>p</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>;</span> <span class=n>p</span><span class=o>--</span><span class=p>){</span>
</span></span><span class=line><span class=cl>                <span class=n>z</span> <span class=o>=</span> <span class=n>v</span><span class=p>[</span><span class=n>p</span> <span class=o>-</span> <span class=mi>1</span><span class=p>];</span>
</span></span><span class=line><span class=cl>                <span class=n>y</span> <span class=o>=</span> <span class=n>v</span><span class=p>[</span><span class=n>p</span><span class=p>]</span> <span class=o>-=</span> <span class=n>MX</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=n>z</span> <span class=o>=</span> <span class=n>v</span><span class=p>[</span><span class=n>n</span> <span class=o>-</span> <span class=mi>1</span><span class=p>];</span>
</span></span><span class=line><span class=cl>            <span class=n>y</span> <span class=o>=</span> <span class=n>v</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>-=</span> <span class=n>MX</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>sum</span> <span class=o>-=</span> <span class=n>DELTA</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>while</span> <span class=p>(</span><span class=o>--</span><span class=n>rounds</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>    <span class=kt>uint32_t</span> <span class=n>v</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=kt>uint32_t</span> <span class=k>const</span> <span class=n>k</span><span class=p>[</span><span class=mi>4</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span><span class=mi>2</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>4</span><span class=p>};</span> <span class=c1>// 128位
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>int</span> <span class=n>n</span> <span class=o>=</span> <span class=mi>2</span><span class=p>;</span><span class=c1>// n的绝对值为v长度，取正表示加密，取负表示解密
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;%#10x %#10x</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>v</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>v</span><span class=p>[</span><span class=mi>1</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>    <span class=nf>xxtea</span><span class=p>(</span><span class=n>v</span><span class=p>,</span> <span class=n>n</span><span class=p>,</span> <span class=n>k</span><span class=p>);</span> <span class=c1>// n&gt;0为加密
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;%#10x %#10x</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>v</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>v</span><span class=p>[</span><span class=mi>1</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>    <span class=nf>xxtea</span><span class=p>(</span><span class=n>v</span><span class=p>,</span> <span class=o>-</span><span class=n>n</span><span class=p>,</span> <span class=n>k</span><span class=p>);</span> <span class=c1>// n&lt;0为解密
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;%#10x %#10x</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>v</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>v</span><span class=p>[</span><span class=mi>1</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div><h3 id=md5>md5</h3><p>有4个固定的32bit值</p><h3 id=sm4>SM4</h3><ul><li>分组密码，4组，分组长度128位，密钥长度128位，加解密算法相同，轮密钥使用次序相反，32轮非线性迭代</li><li>轮密钥 rK 有32个，32位为单位，每一次迭代为一轮F函数</li><li>$X_{i+4}=F(X_i,X_{i+1},X_{i+2},X_{i+3},rK_i)=X_i ⊕ T( X_{i+1}⊕X_{i+2}⊕X_{i+3}⊕rK_i)$</li></ul><img src=/img/reverse_note.zh-cn.assets/172845181249224.png alt=图片无法加载><p><strong>F函数中的T函数</strong></p><p>T：合成置换，可逆变换，由非线性变换$\tau$和线性变换$L$复合而成：$T()=L(\tau())$</p><ol><li>非线性变换 A 到 B，A 和 B 均为32位，$\tau$由4个并行S盒构成【固定的256字节的数组】</li></ol><p>$B =（b_0,b_1,b_2,b_3）= τ(A)=(Sbox(a_0),Sbox(a_0),Sbox(a_0),Sbox(a_0))$</p><p>查表规则：有 F 行 F 列，输入的32位可表示为2个十六进制数，一个做行一个做列找值替换</p><img src=/img/reverse_note.zh-cn.assets/172845181249225.png alt=图片无法加载><ol><li>线性变换 B 到 C，均为32位，此处为<strong>循环左移</strong></li></ol><p>$C = L(B) = B ⊕(B&#171;&lt;2)⊕(B&#171;&lt;10) ⊕(B&#171;&lt;18) ⊕(B&#171;&lt;24)$</p><p><strong>轮密钥扩展</strong></p><p>密钥128位，$MK=(MK_0,MK_1,MK_2,MK_3)$，轮密钥由密钥生成</p><p>系统参数：$FK=(FK_0,FK_1,FK_2,FK_3)$，固定参数：$CK=(CK_0,CK_1,\cdots ,CK_{31})$</p><img src=/img/reverse_note.zh-cn.assets/172845181249326.png alt=图片无法加载>
<img src=/img/reverse_note.zh-cn.assets/172845181249327.png alt=图片无法加载><ul><li>$(K_0,K_1,K_2,K_3)= (MK_0⊕FK_0, MK_1⊕, FK_1, MK_2⊕FK_2, MK_3⊕FK_3)$<ul><li>$rK_i=K_{i+4}=K_i⊕T’(K_{i+1}⊕K_{i+2}⊕K_{i+3}⊕CK_i)\quad\quad [i=0,\cdots,31]$</li></ul></li></ul><p>$T&rsquo;$即将 $T$ 中的 $L$ 替换为 $L&rsquo;$：$L&rsquo;(B)=B\oplus (B\lt\lt\lt 13)\oplus(B\lt\lt\lt 23)$</p><p><strong>解密</strong></p><p>由于$X_{i+4}=F(X_i,X_{i+1},X_{i+2},X_{i+3~}rK_i)=X_i ⊕ T( X_{i+1}⊕X_{i+2}⊕X_{i+3}⊕rK_i)$</p><p>所以$X_i=F(X_{i+4},X_{i+1},X_{i+2},X_{i+3},rK_i)=X_{i+4} ⊕ T(X_{i+1}⊕X_{i+2}⊕X_{i+3}⊕rK_i)$</p><p>将密文逆序，轮密钥也逆序，解密流程即加密流程的逆序</p><p>源代码链接借鉴：<code>https://cloud.tencent.com/developer/article/2158867</code></p><div class="code-block code-line-numbers" style="counter-reset:code-block 0"><div class="code-header language-C"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-C data-lang=C><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdlib.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;string.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#define u8 unsigned char
</span></span></span><span class=line><span class=cl><span class=cp>#define u32 unsigned long
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=cm>/******************************定义系统参数FK的取值****************************************/</span>
</span></span><span class=line><span class=cl><span class=k>const</span> <span class=n>u32</span> <span class=n>TBL_SYS_PARAMS</span><span class=p>[</span><span class=mi>4</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span><span class=mh>0xa3b1bac6</span><span class=p>,</span> <span class=mh>0x56aa3350</span><span class=p>,</span> <span class=mh>0x677d9197</span><span class=p>,</span> <span class=mh>0xb27022dc</span><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/******************************定义固定参数CK的取值****************************************/</span>
</span></span><span class=line><span class=cl><span class=k>const</span> <span class=n>u32</span> <span class=n>TBL_FIX_PARAMS</span><span class=p>[</span><span class=mi>32</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x00070e15</span><span class=p>,</span> <span class=mh>0x1c232a31</span><span class=p>,</span> <span class=mh>0x383f464d</span><span class=p>,</span> <span class=mh>0x545b6269</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x70777e85</span><span class=p>,</span> <span class=mh>0x8c939aa1</span><span class=p>,</span> <span class=mh>0xa8afb6bd</span><span class=p>,</span> <span class=mh>0xc4cbd2d9</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xe0e7eef5</span><span class=p>,</span> <span class=mh>0xfc030a11</span><span class=p>,</span> <span class=mh>0x181f262d</span><span class=p>,</span> <span class=mh>0x343b4249</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x50575e65</span><span class=p>,</span> <span class=mh>0x6c737a81</span><span class=p>,</span> <span class=mh>0x888f969d</span><span class=p>,</span> <span class=mh>0xa4abb2b9</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xc0c7ced5</span><span class=p>,</span> <span class=mh>0xdce3eaf1</span><span class=p>,</span> <span class=mh>0xf8ff060d</span><span class=p>,</span> <span class=mh>0x141b2229</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x30373e45</span><span class=p>,</span> <span class=mh>0x4c535a61</span><span class=p>,</span> <span class=mh>0x686f767d</span><span class=p>,</span> <span class=mh>0x848b9299</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xa0a7aeb5</span><span class=p>,</span> <span class=mh>0xbcc3cad1</span><span class=p>,</span> <span class=mh>0xd8dfe6ed</span><span class=p>,</span> <span class=mh>0xf4fb0209</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x10171e25</span><span class=p>,</span> <span class=mh>0x2c333a41</span><span class=p>,</span> <span class=mh>0x484f565d</span><span class=p>,</span> <span class=mh>0x646b7279</span><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cm>/******************************SBox参数列表****************************************/</span>
</span></span><span class=line><span class=cl><span class=k>const</span> <span class=n>u8</span> <span class=n>TBL_SBOX</span><span class=p>[</span><span class=mi>256</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xd6</span><span class=p>,</span> <span class=mh>0x90</span><span class=p>,</span> <span class=mh>0xe9</span><span class=p>,</span> <span class=mh>0xfe</span><span class=p>,</span> <span class=mh>0xcc</span><span class=p>,</span> <span class=mh>0xe1</span><span class=p>,</span> <span class=mh>0x3d</span><span class=p>,</span> <span class=mh>0xb7</span><span class=p>,</span> <span class=mh>0x16</span><span class=p>,</span> <span class=mh>0xb6</span><span class=p>,</span> <span class=mh>0x14</span><span class=p>,</span> <span class=mh>0xc2</span><span class=p>,</span> <span class=mh>0x28</span><span class=p>,</span> <span class=mh>0xfb</span><span class=p>,</span> <span class=mh>0x2c</span><span class=p>,</span> <span class=mh>0x05</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x2b</span><span class=p>,</span> <span class=mh>0x67</span><span class=p>,</span> <span class=mh>0x9a</span><span class=p>,</span> <span class=mh>0x76</span><span class=p>,</span> <span class=mh>0x2a</span><span class=p>,</span> <span class=mh>0xbe</span><span class=p>,</span> <span class=mh>0x04</span><span class=p>,</span> <span class=mh>0xc3</span><span class=p>,</span> <span class=mh>0xaa</span><span class=p>,</span> <span class=mh>0x44</span><span class=p>,</span> <span class=mh>0x13</span><span class=p>,</span> <span class=mh>0x26</span><span class=p>,</span> <span class=mh>0x49</span><span class=p>,</span> <span class=mh>0x86</span><span class=p>,</span> <span class=mh>0x06</span><span class=p>,</span> <span class=mh>0x99</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x9c</span><span class=p>,</span> <span class=mh>0x42</span><span class=p>,</span> <span class=mh>0x50</span><span class=p>,</span> <span class=mh>0xf4</span><span class=p>,</span> <span class=mh>0x91</span><span class=p>,</span> <span class=mh>0xef</span><span class=p>,</span> <span class=mh>0x98</span><span class=p>,</span> <span class=mh>0x7a</span><span class=p>,</span> <span class=mh>0x33</span><span class=p>,</span> <span class=mh>0x54</span><span class=p>,</span> <span class=mh>0x0b</span><span class=p>,</span> <span class=mh>0x43</span><span class=p>,</span> <span class=mh>0xed</span><span class=p>,</span> <span class=mh>0xcf</span><span class=p>,</span> <span class=mh>0xac</span><span class=p>,</span> <span class=mh>0x62</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xe4</span><span class=p>,</span> <span class=mh>0xb3</span><span class=p>,</span> <span class=mh>0x1c</span><span class=p>,</span> <span class=mh>0xa9</span><span class=p>,</span> <span class=mh>0xc9</span><span class=p>,</span> <span class=mh>0x08</span><span class=p>,</span> <span class=mh>0xe8</span><span class=p>,</span> <span class=mh>0x95</span><span class=p>,</span> <span class=mh>0x80</span><span class=p>,</span> <span class=mh>0xdf</span><span class=p>,</span> <span class=mh>0x94</span><span class=p>,</span> <span class=mh>0xfa</span><span class=p>,</span> <span class=mh>0x75</span><span class=p>,</span> <span class=mh>0x8f</span><span class=p>,</span> <span class=mh>0x3f</span><span class=p>,</span> <span class=mh>0xa6</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x47</span><span class=p>,</span> <span class=mh>0x07</span><span class=p>,</span> <span class=mh>0xa7</span><span class=p>,</span> <span class=mh>0xfc</span><span class=p>,</span> <span class=mh>0xf3</span><span class=p>,</span> <span class=mh>0x73</span><span class=p>,</span> <span class=mh>0x17</span><span class=p>,</span> <span class=mh>0xba</span><span class=p>,</span> <span class=mh>0x83</span><span class=p>,</span> <span class=mh>0x59</span><span class=p>,</span> <span class=mh>0x3c</span><span class=p>,</span> <span class=mh>0x19</span><span class=p>,</span> <span class=mh>0xe6</span><span class=p>,</span> <span class=mh>0x85</span><span class=p>,</span> <span class=mh>0x4f</span><span class=p>,</span> <span class=mh>0xa8</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x68</span><span class=p>,</span> <span class=mh>0x6b</span><span class=p>,</span> <span class=mh>0x81</span><span class=p>,</span> <span class=mh>0xb2</span><span class=p>,</span> <span class=mh>0x71</span><span class=p>,</span> <span class=mh>0x64</span><span class=p>,</span> <span class=mh>0xda</span><span class=p>,</span> <span class=mh>0x8b</span><span class=p>,</span> <span class=mh>0xf8</span><span class=p>,</span> <span class=mh>0xeb</span><span class=p>,</span> <span class=mh>0x0f</span><span class=p>,</span> <span class=mh>0x4b</span><span class=p>,</span> <span class=mh>0x70</span><span class=p>,</span> <span class=mh>0x56</span><span class=p>,</span> <span class=mh>0x9d</span><span class=p>,</span> <span class=mh>0x35</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x1e</span><span class=p>,</span> <span class=mh>0x24</span><span class=p>,</span> <span class=mh>0x0e</span><span class=p>,</span> <span class=mh>0x5e</span><span class=p>,</span> <span class=mh>0x63</span><span class=p>,</span> <span class=mh>0x58</span><span class=p>,</span> <span class=mh>0xd1</span><span class=p>,</span> <span class=mh>0xa2</span><span class=p>,</span> <span class=mh>0x25</span><span class=p>,</span> <span class=mh>0x22</span><span class=p>,</span> <span class=mh>0x7c</span><span class=p>,</span> <span class=mh>0x3b</span><span class=p>,</span> <span class=mh>0x01</span><span class=p>,</span> <span class=mh>0x21</span><span class=p>,</span> <span class=mh>0x78</span><span class=p>,</span> <span class=mh>0x87</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xd4</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x46</span><span class=p>,</span> <span class=mh>0x57</span><span class=p>,</span> <span class=mh>0x9f</span><span class=p>,</span> <span class=mh>0xd3</span><span class=p>,</span> <span class=mh>0x27</span><span class=p>,</span> <span class=mh>0x52</span><span class=p>,</span> <span class=mh>0x4c</span><span class=p>,</span> <span class=mh>0x36</span><span class=p>,</span> <span class=mh>0x02</span><span class=p>,</span> <span class=mh>0xe7</span><span class=p>,</span> <span class=mh>0xa0</span><span class=p>,</span> <span class=mh>0xc4</span><span class=p>,</span> <span class=mh>0xc8</span><span class=p>,</span> <span class=mh>0x9e</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xea</span><span class=p>,</span> <span class=mh>0xbf</span><span class=p>,</span> <span class=mh>0x8a</span><span class=p>,</span> <span class=mh>0xd2</span><span class=p>,</span> <span class=mh>0x40</span><span class=p>,</span> <span class=mh>0xc7</span><span class=p>,</span> <span class=mh>0x38</span><span class=p>,</span> <span class=mh>0xb5</span><span class=p>,</span> <span class=mh>0xa3</span><span class=p>,</span> <span class=mh>0xf7</span><span class=p>,</span> <span class=mh>0xf2</span><span class=p>,</span> <span class=mh>0xce</span><span class=p>,</span> <span class=mh>0xf9</span><span class=p>,</span> <span class=mh>0x61</span><span class=p>,</span> <span class=mh>0x15</span><span class=p>,</span> <span class=mh>0xa1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xe0</span><span class=p>,</span> <span class=mh>0xae</span><span class=p>,</span> <span class=mh>0x5d</span><span class=p>,</span> <span class=mh>0xa4</span><span class=p>,</span> <span class=mh>0x9b</span><span class=p>,</span> <span class=mh>0x34</span><span class=p>,</span> <span class=mh>0x1a</span><span class=p>,</span> <span class=mh>0x55</span><span class=p>,</span> <span class=mh>0xad</span><span class=p>,</span> <span class=mh>0x93</span><span class=p>,</span> <span class=mh>0x32</span><span class=p>,</span> <span class=mh>0x30</span><span class=p>,</span> <span class=mh>0xf5</span><span class=p>,</span> <span class=mh>0x8c</span><span class=p>,</span> <span class=mh>0xb1</span><span class=p>,</span> <span class=mh>0xe3</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x1d</span><span class=p>,</span> <span class=mh>0xf6</span><span class=p>,</span> <span class=mh>0xe2</span><span class=p>,</span> <span class=mh>0x2e</span><span class=p>,</span> <span class=mh>0x82</span><span class=p>,</span> <span class=mh>0x66</span><span class=p>,</span> <span class=mh>0xca</span><span class=p>,</span> <span class=mh>0x60</span><span class=p>,</span> <span class=mh>0xc0</span><span class=p>,</span> <span class=mh>0x29</span><span class=p>,</span> <span class=mh>0x23</span><span class=p>,</span> <span class=mh>0xab</span><span class=p>,</span> <span class=mh>0x0d</span><span class=p>,</span> <span class=mh>0x53</span><span class=p>,</span> <span class=mh>0x4e</span><span class=p>,</span> <span class=mh>0x6f</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0xd5</span><span class=p>,</span> <span class=mh>0xdb</span><span class=p>,</span> <span class=mh>0x37</span><span class=p>,</span> <span class=mh>0x45</span><span class=p>,</span> <span class=mh>0xde</span><span class=p>,</span> <span class=mh>0xfd</span><span class=p>,</span> <span class=mh>0x8e</span><span class=p>,</span> <span class=mh>0x2f</span><span class=p>,</span> <span class=mh>0x03</span><span class=p>,</span> <span class=mh>0xff</span><span class=p>,</span> <span class=mh>0x6a</span><span class=p>,</span> <span class=mh>0x72</span><span class=p>,</span> <span class=mh>0x6d</span><span class=p>,</span> <span class=mh>0x6c</span><span class=p>,</span> <span class=mh>0x5b</span><span class=p>,</span> <span class=mh>0x51</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x8d</span><span class=p>,</span> <span class=mh>0x1b</span><span class=p>,</span> <span class=mh>0xaf</span><span class=p>,</span> <span class=mh>0x92</span><span class=p>,</span> <span class=mh>0xbb</span><span class=p>,</span> <span class=mh>0xdd</span><span class=p>,</span> <span class=mh>0xbc</span><span class=p>,</span> <span class=mh>0x7f</span><span class=p>,</span> <span class=mh>0x11</span><span class=p>,</span> <span class=mh>0xd9</span><span class=p>,</span> <span class=mh>0x5c</span><span class=p>,</span> <span class=mh>0x41</span><span class=p>,</span> <span class=mh>0x1f</span><span class=p>,</span> <span class=mh>0x10</span><span class=p>,</span> <span class=mh>0x5a</span><span class=p>,</span> <span class=mh>0xd8</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x0a</span><span class=p>,</span> <span class=mh>0xc1</span><span class=p>,</span> <span class=mh>0x31</span><span class=p>,</span> <span class=mh>0x88</span><span class=p>,</span> <span class=mh>0xa5</span><span class=p>,</span> <span class=mh>0xcd</span><span class=p>,</span> <span class=mh>0x7b</span><span class=p>,</span> <span class=mh>0xbd</span><span class=p>,</span> <span class=mh>0x2d</span><span class=p>,</span> <span class=mh>0x74</span><span class=p>,</span> <span class=mh>0xd0</span><span class=p>,</span> <span class=mh>0x12</span><span class=p>,</span> <span class=mh>0xb8</span><span class=p>,</span> <span class=mh>0xe5</span><span class=p>,</span> <span class=mh>0xb4</span><span class=p>,</span> <span class=mh>0xb0</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x89</span><span class=p>,</span> <span class=mh>0x69</span><span class=p>,</span> <span class=mh>0x97</span><span class=p>,</span> <span class=mh>0x4a</span><span class=p>,</span> <span class=mh>0x0c</span><span class=p>,</span> <span class=mh>0x96</span><span class=p>,</span> <span class=mh>0x77</span><span class=p>,</span> <span class=mh>0x7e</span><span class=p>,</span> <span class=mh>0x65</span><span class=p>,</span> <span class=mh>0xb9</span><span class=p>,</span> <span class=mh>0xf1</span><span class=p>,</span> <span class=mh>0x09</span><span class=p>,</span> <span class=mh>0xc5</span><span class=p>,</span> <span class=mh>0x6e</span><span class=p>,</span> <span class=mh>0xc6</span><span class=p>,</span> <span class=mh>0x84</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=mh>0x18</span><span class=p>,</span> <span class=mh>0xf0</span><span class=p>,</span> <span class=mh>0x7d</span><span class=p>,</span> <span class=mh>0xec</span><span class=p>,</span> <span class=mh>0x3a</span><span class=p>,</span> <span class=mh>0xdc</span><span class=p>,</span> <span class=mh>0x4d</span><span class=p>,</span> <span class=mh>0x20</span><span class=p>,</span> <span class=mh>0x79</span><span class=p>,</span> <span class=mh>0xee</span><span class=p>,</span> <span class=mh>0x5f</span><span class=p>,</span> <span class=mh>0x3e</span><span class=p>,</span> <span class=mh>0xd7</span><span class=p>,</span> <span class=mh>0xcb</span><span class=p>,</span> <span class=mh>0x39</span><span class=p>,</span> <span class=mh>0x48</span><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 4字节无符号数组转无符号long型
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>void</span> <span class=nf>four_uCh2uLong</span><span class=p>(</span><span class=n>u8</span> <span class=o>*</span><span class=n>in</span><span class=p>,</span> <span class=n>u32</span> <span class=o>*</span><span class=n>out</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=o>*</span><span class=n>out</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=mi>4</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=o>*</span><span class=n>out</span> <span class=o>=</span> <span class=p>((</span><span class=n>u32</span><span class=p>)</span><span class=n>in</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>&lt;&lt;</span> <span class=p>(</span><span class=mi>24</span> <span class=o>-</span> <span class=n>i</span> <span class=o>*</span> <span class=mi>8</span><span class=p>))</span> <span class=o>^</span> <span class=o>*</span><span class=n>out</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 无符号long型转4字节无符号数组
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>void</span> <span class=nf>uLong2four_uCh</span><span class=p>(</span><span class=n>u32</span> <span class=n>in</span><span class=p>,</span> <span class=n>u8</span> <span class=o>*</span><span class=n>out</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 从32位unsigned long的高位开始取
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>for</span> <span class=p>(</span><span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=mi>4</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=o>*</span><span class=p>(</span><span class=n>out</span> <span class=o>+</span> <span class=n>i</span><span class=p>)</span> <span class=o>=</span> <span class=p>(</span><span class=n>u32</span><span class=p>)(</span><span class=n>in</span> <span class=o>&gt;&gt;</span> <span class=p>(</span><span class=mi>24</span> <span class=o>-</span> <span class=n>i</span> <span class=o>*</span> <span class=mi>8</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 左移，保留丢弃位放置尾部
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>u32</span> <span class=nf>lmove</span><span class=p>(</span><span class=n>u32</span> <span class=n>data</span><span class=p>,</span> <span class=kt>int</span> <span class=n>length</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=n>u32</span> <span class=n>result</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=o>=</span> <span class=p>(</span><span class=n>data</span> <span class=o>&lt;&lt;</span> <span class=n>length</span><span class=p>)</span> <span class=o>^</span> <span class=p>(</span><span class=n>data</span> <span class=o>&gt;&gt;</span> <span class=p>(</span><span class=mi>32</span> <span class=o>-</span> <span class=n>length</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>result</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 秘钥处理函数,先使用Sbox进行非线性变化，再将线性变换L置换为L&#39;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>u32</span> <span class=nf>func_key</span><span class=p>(</span><span class=n>u32</span> <span class=n>input</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>u32</span> <span class=n>ulTmp</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>u8</span> <span class=n>ucIndexList</span><span class=p>[</span><span class=mi>4</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span><span class=mi>0</span><span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=n>u8</span> <span class=n>ucSboxValueList</span><span class=p>[</span><span class=mi>4</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span><span class=mi>0</span><span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=nf>uLong2four_uCh</span><span class=p>(</span><span class=n>input</span><span class=p>,</span> <span class=n>ucIndexList</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=mi>4</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>        <span class=n>ucSboxValueList</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>TBL_SBOX</span><span class=p>[</span><span class=n>ucIndexList</span><span class=p>[</span><span class=n>i</span><span class=p>]];</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nf>four_uCh2uLong</span><span class=p>(</span><span class=n>ucSboxValueList</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>ulTmp</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>ulTmp</span> <span class=o>=</span> <span class=n>ulTmp</span> <span class=o>^</span> <span class=nf>lmove</span><span class=p>(</span><span class=n>ulTmp</span><span class=p>,</span> <span class=mi>13</span><span class=p>)</span> <span class=o>^</span> <span class=nf>lmove</span><span class=p>(</span><span class=n>ulTmp</span><span class=p>,</span> <span class=mi>23</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>ulTmp</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=c1>// 加解密数据处理函数,先使用Sbox进行非线性变化，再进行线性变换L
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>u32</span> <span class=nf>func_data</span><span class=p>(</span><span class=n>u32</span> <span class=n>input</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>u32</span> <span class=n>ulTmp</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>u8</span> <span class=n>ucIndexList</span><span class=p>[</span><span class=mi>4</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span><span class=mi>0</span><span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=n>u8</span> <span class=n>ucSboxValueList</span><span class=p>[</span><span class=mi>4</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span><span class=mi>0</span><span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=nf>uLong2four_uCh</span><span class=p>(</span><span class=n>input</span><span class=p>,</span> <span class=n>ucIndexList</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=mi>4</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>        <span class=n>ucSboxValueList</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>TBL_SBOX</span><span class=p>[</span><span class=n>ucIndexList</span><span class=p>[</span><span class=n>i</span><span class=p>]];</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nf>four_uCh2uLong</span><span class=p>(</span><span class=n>ucSboxValueList</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>ulTmp</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>ulTmp</span> <span class=o>=</span> <span class=n>ulTmp</span> <span class=o>^</span> <span class=nf>lmove</span><span class=p>(</span><span class=n>ulTmp</span><span class=p>,</span> <span class=mi>2</span><span class=p>)</span> <span class=o>^</span> <span class=nf>lmove</span><span class=p>(</span><span class=n>ulTmp</span><span class=p>,</span> <span class=mi>10</span><span class=p>)</span> <span class=o>^</span> <span class=nf>lmove</span><span class=p>(</span><span class=n>ulTmp</span><span class=p>,</span> <span class=mi>18</span><span class=p>)</span> <span class=o>^</span> <span class=nf>lmove</span><span class=p>(</span><span class=n>ulTmp</span><span class=p>,</span> <span class=mi>24</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>ulTmp</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 加密函数, 加密任意长度数据，一次循环16字节，不足部分补0凑齐16字节整数倍
</span></span></span><span class=line><span class=cl><span class=c1>// len:数据长度(任意长度) key:密钥(16字节) input:明文 output:密文
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>void</span> <span class=nf>encode_fun</span><span class=p>(</span><span class=n>u8</span> <span class=n>len</span><span class=p>,</span> <span class=n>u8</span> <span class=o>*</span><span class=n>key</span><span class=p>,</span> <span class=n>u8</span> <span class=o>*</span><span class=n>input</span><span class=p>,</span> <span class=n>u8</span> <span class=o>*</span><span class=n>output</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>,</span> <span class=n>j</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>u8</span> <span class=o>*</span><span class=n>p</span> <span class=o>=</span> <span class=p>(</span><span class=n>u8</span> <span class=o>*</span><span class=p>)</span><span class=nf>malloc</span><span class=p>(</span><span class=mi>50</span><span class=p>);</span>  <span class=c1>// 50字节缓存区
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>u32</span> <span class=n>ulKeyTmpList</span><span class=p>[</span><span class=mi>4</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span><span class=mi>0</span><span class=p>};</span> <span class=c1>// 存储密钥的u32数据
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>u32</span> <span class=n>ulKeyList</span><span class=p>[</span><span class=mi>36</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span><span class=mi>0</span><span class=p>};</span>   <span class=c1>// 用于密钥扩展算法与系统参数FK运算后的结果存储
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>u32</span> <span class=n>ulDataList</span><span class=p>[</span><span class=mi>36</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span><span class=mi>0</span><span class=p>};</span>  <span class=c1>// 用于存放加密数据
</span></span></span><span class=line><span class=cl><span class=c1></span>    
</span></span><span class=line><span class=cl>    <span class=cm>/***************************开始生成子秘钥********************************************/</span>
</span></span><span class=line><span class=cl>    <span class=nf>four_uCh2uLong</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=o>&amp;</span><span class=p>(</span><span class=n>ulKeyTmpList</span><span class=p>[</span><span class=mi>0</span><span class=p>]));</span>
</span></span><span class=line><span class=cl>    <span class=nf>four_uCh2uLong</span><span class=p>(</span><span class=n>key</span> <span class=o>+</span> <span class=mi>4</span><span class=p>,</span> <span class=o>&amp;</span><span class=p>(</span><span class=n>ulKeyTmpList</span><span class=p>[</span><span class=mi>1</span><span class=p>]));</span>
</span></span><span class=line><span class=cl>    <span class=nf>four_uCh2uLong</span><span class=p>(</span><span class=n>key</span> <span class=o>+</span> <span class=mi>8</span><span class=p>,</span> <span class=o>&amp;</span><span class=p>(</span><span class=n>ulKeyTmpList</span><span class=p>[</span><span class=mi>2</span><span class=p>]));</span>
</span></span><span class=line><span class=cl>    <span class=nf>four_uCh2uLong</span><span class=p>(</span><span class=n>key</span> <span class=o>+</span> <span class=mi>12</span><span class=p>,</span> <span class=o>&amp;</span><span class=p>(</span><span class=n>ulKeyTmpList</span><span class=p>[</span><span class=mi>3</span><span class=p>]));</span>
</span></span><span class=line><span class=cl>    <span class=n>ulKeyList</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=n>ulKeyTmpList</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>^</span> <span class=n>TBL_SYS_PARAMS</span><span class=p>[</span><span class=mi>0</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=n>ulKeyList</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=n>ulKeyTmpList</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>^</span> <span class=n>TBL_SYS_PARAMS</span><span class=p>[</span><span class=mi>1</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=n>ulKeyList</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>=</span> <span class=n>ulKeyTmpList</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>^</span> <span class=n>TBL_SYS_PARAMS</span><span class=p>[</span><span class=mi>2</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=n>ulKeyList</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span> <span class=o>=</span> <span class=n>ulKeyTmpList</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span> <span class=o>^</span> <span class=n>TBL_SYS_PARAMS</span><span class=p>[</span><span class=mi>3</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=mi>32</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span><span class=c1>// 32次循环迭代运算, 5-36为32个子秘钥
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>ulKeyList</span><span class=p>[</span><span class=n>i</span> <span class=o>+</span> <span class=mi>4</span><span class=p>]</span> <span class=o>=</span> <span class=n>ulKeyList</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>^</span> <span class=nf>func_key</span><span class=p>(</span><span class=n>ulKeyList</span><span class=p>[</span><span class=n>i</span> <span class=o>+</span> <span class=mi>1</span><span class=p>]</span> <span class=o>^</span> <span class=n>ulKeyList</span><span class=p>[</span><span class=n>i</span> <span class=o>+</span> <span class=mi>2</span><span class=p>]</span> <span class=o>^</span> <span class=n>ulKeyList</span><span class=p>[</span><span class=n>i</span> <span class=o>+</span> <span class=mi>3</span><span class=p>]</span> <span class=o>^</span> <span class=n>TBL_FIX_PARAMS</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=cm>/***************************生成32轮32位长子秘钥结束**********************************/</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>len</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=c1>// 将输入数据存放在p缓存区
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=o>*</span><span class=p>(</span><span class=n>p</span> <span class=o>+</span> <span class=n>i</span><span class=p>)</span> <span class=o>=</span> <span class=o>*</span><span class=p>(</span><span class=n>input</span> <span class=o>+</span> <span class=n>i</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=mi>16</span> <span class=o>-</span> <span class=n>len</span> <span class=o>%</span> <span class=mi>16</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=c1>// 将不足16位补0凑齐16整数倍
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=o>*</span><span class=p>(</span><span class=n>p</span> <span class=o>+</span> <span class=n>len</span> <span class=o>+</span> <span class=n>i</span><span class=p>)</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>j</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>j</span> <span class=o>&lt;</span> <span class=n>len</span> <span class=o>/</span> <span class=mi>16</span> <span class=o>+</span> <span class=p>((</span><span class=n>len</span> <span class=o>%</span> <span class=mi>16</span><span class=p>)</span> <span class=o>?</span> <span class=mi>1</span> <span class=o>:</span> <span class=mi>0</span><span class=p>);</span> <span class=n>j</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 循环加密,将加密后数据保存, 若16字节则进行一次, 17字节补0至32字节后进行加密两次
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=cm>/*开始处理加密数据*/</span>
</span></span><span class=line><span class=cl>        <span class=nf>four_uCh2uLong</span><span class=p>(</span><span class=n>p</span> <span class=o>+</span> <span class=mi>16</span> <span class=o>*</span> <span class=n>j</span><span class=p>,</span> <span class=o>&amp;</span><span class=p>(</span><span class=n>ulDataList</span><span class=p>[</span><span class=mi>0</span><span class=p>]));</span>
</span></span><span class=line><span class=cl>        <span class=nf>four_uCh2uLong</span><span class=p>(</span><span class=n>p</span> <span class=o>+</span> <span class=mi>16</span> <span class=o>*</span> <span class=n>j</span> <span class=o>+</span> <span class=mi>4</span><span class=p>,</span> <span class=o>&amp;</span><span class=p>(</span><span class=n>ulDataList</span><span class=p>[</span><span class=mi>1</span><span class=p>]));</span>
</span></span><span class=line><span class=cl>        <span class=nf>four_uCh2uLong</span><span class=p>(</span><span class=n>p</span> <span class=o>+</span> <span class=mi>16</span> <span class=o>*</span> <span class=n>j</span> <span class=o>+</span> <span class=mi>8</span><span class=p>,</span> <span class=o>&amp;</span><span class=p>(</span><span class=n>ulDataList</span><span class=p>[</span><span class=mi>2</span><span class=p>]));</span>
</span></span><span class=line><span class=cl>        <span class=nf>four_uCh2uLong</span><span class=p>(</span><span class=n>p</span> <span class=o>+</span> <span class=mi>16</span> <span class=o>*</span> <span class=n>j</span> <span class=o>+</span> <span class=mi>12</span><span class=p>,</span> <span class=o>&amp;</span><span class=p>(</span><span class=n>ulDataList</span><span class=p>[</span><span class=mi>3</span><span class=p>]));</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 加密
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>for</span> <span class=p>(</span><span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=mi>32</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>            <span class=n>ulDataList</span><span class=p>[</span><span class=n>i</span> <span class=o>+</span> <span class=mi>4</span><span class=p>]</span> <span class=o>=</span> <span class=n>ulDataList</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>^</span> <span class=nf>func_data</span><span class=p>(</span><span class=n>ulDataList</span><span class=p>[</span><span class=n>i</span> <span class=o>+</span> <span class=mi>1</span><span class=p>]</span> <span class=o>^</span> <span class=n>ulDataList</span><span class=p>[</span><span class=n>i</span> <span class=o>+</span> <span class=mi>2</span><span class=p>]</span> <span class=o>^</span> <span class=n>ulDataList</span><span class=p>[</span><span class=n>i</span> <span class=o>+</span> <span class=mi>3</span><span class=p>]</span> <span class=o>^</span> <span class=n>ulKeyList</span><span class=p>[</span><span class=n>i</span> <span class=o>+</span> <span class=mi>4</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=cm>/*将加密后数据输出*/</span>
</span></span><span class=line><span class=cl>        <span class=nf>uLong2four_uCh</span><span class=p>(</span><span class=n>ulDataList</span><span class=p>[</span><span class=mi>35</span><span class=p>],</span> <span class=n>output</span> <span class=o>+</span> <span class=mi>16</span> <span class=o>*</span> <span class=n>j</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>uLong2four_uCh</span><span class=p>(</span><span class=n>ulDataList</span><span class=p>[</span><span class=mi>34</span><span class=p>],</span> <span class=n>output</span> <span class=o>+</span> <span class=mi>16</span> <span class=o>*</span> <span class=n>j</span> <span class=o>+</span> <span class=mi>4</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>uLong2four_uCh</span><span class=p>(</span><span class=n>ulDataList</span><span class=p>[</span><span class=mi>33</span><span class=p>],</span> <span class=n>output</span> <span class=o>+</span> <span class=mi>16</span> <span class=o>*</span> <span class=n>j</span> <span class=o>+</span> <span class=mi>8</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>uLong2four_uCh</span><span class=p>(</span><span class=n>ulDataList</span><span class=p>[</span><span class=mi>32</span><span class=p>],</span> <span class=n>output</span> <span class=o>+</span> <span class=mi>16</span> <span class=o>*</span> <span class=n>j</span> <span class=o>+</span> <span class=mi>12</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nf>free</span><span class=p>(</span><span class=n>p</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 解密函数, 与加密函数基本一致, 秘钥使用的顺序不同
</span></span></span><span class=line><span class=cl><span class=c1>// len:数据长度 key:密钥 input:密文 output:明文
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>void</span> <span class=nf>decode_fun</span><span class=p>(</span><span class=n>u8</span> <span class=n>len</span><span class=p>,</span> <span class=n>u8</span> <span class=o>*</span><span class=n>key</span><span class=p>,</span> <span class=n>u8</span> <span class=o>*</span><span class=n>input</span><span class=p>,</span> <span class=n>u8</span> <span class=o>*</span><span class=n>output</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>,</span> <span class=n>j</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>u32</span> <span class=n>ulKeyTmpList</span><span class=p>[</span><span class=mi>4</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span><span class=mi>0</span><span class=p>};</span> <span class=c1>// 存储密钥的u32数据
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>u32</span> <span class=n>ulKeyList</span><span class=p>[</span><span class=mi>36</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span><span class=mi>0</span><span class=p>};</span>   <span class=c1>// 用于密钥扩展算法与系统参数FK运算后的结果存储
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>u32</span> <span class=n>ulDataList</span><span class=p>[</span><span class=mi>36</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span><span class=mi>0</span><span class=p>};</span>  <span class=c1>// 用于存放加密数据
</span></span></span><span class=line><span class=cl><span class=c1></span>    
</span></span><span class=line><span class=cl>    <span class=cm>/*开始生成子秘钥*/</span>
</span></span><span class=line><span class=cl>    <span class=nf>four_uCh2uLong</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=o>&amp;</span><span class=p>(</span><span class=n>ulKeyTmpList</span><span class=p>[</span><span class=mi>0</span><span class=p>]));</span>
</span></span><span class=line><span class=cl>    <span class=nf>four_uCh2uLong</span><span class=p>(</span><span class=n>key</span> <span class=o>+</span> <span class=mi>4</span><span class=p>,</span> <span class=o>&amp;</span><span class=p>(</span><span class=n>ulKeyTmpList</span><span class=p>[</span><span class=mi>1</span><span class=p>]));</span>
</span></span><span class=line><span class=cl>    <span class=nf>four_uCh2uLong</span><span class=p>(</span><span class=n>key</span> <span class=o>+</span> <span class=mi>8</span><span class=p>,</span> <span class=o>&amp;</span><span class=p>(</span><span class=n>ulKeyTmpList</span><span class=p>[</span><span class=mi>2</span><span class=p>]));</span>
</span></span><span class=line><span class=cl>    <span class=nf>four_uCh2uLong</span><span class=p>(</span><span class=n>key</span> <span class=o>+</span> <span class=mi>12</span><span class=p>,</span> <span class=o>&amp;</span><span class=p>(</span><span class=n>ulKeyTmpList</span><span class=p>[</span><span class=mi>3</span><span class=p>]));</span>
</span></span><span class=line><span class=cl>    <span class=n>ulKeyList</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=n>ulKeyTmpList</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>^</span> <span class=n>TBL_SYS_PARAMS</span><span class=p>[</span><span class=mi>0</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=n>ulKeyList</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=n>ulKeyTmpList</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>^</span> <span class=n>TBL_SYS_PARAMS</span><span class=p>[</span><span class=mi>1</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=n>ulKeyList</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>=</span> <span class=n>ulKeyTmpList</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>^</span> <span class=n>TBL_SYS_PARAMS</span><span class=p>[</span><span class=mi>2</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=n>ulKeyList</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span> <span class=o>=</span> <span class=n>ulKeyTmpList</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span> <span class=o>^</span> <span class=n>TBL_SYS_PARAMS</span><span class=p>[</span><span class=mi>3</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=mi>32</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=c1>// 32次循环迭代运算, 5-36为32个子秘钥
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>ulKeyList</span><span class=p>[</span><span class=n>i</span> <span class=o>+</span> <span class=mi>4</span><span class=p>]</span> <span class=o>=</span> <span class=n>ulKeyList</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>^</span> <span class=nf>func_key</span><span class=p>(</span><span class=n>ulKeyList</span><span class=p>[</span><span class=n>i</span> <span class=o>+</span> <span class=mi>1</span><span class=p>]</span> <span class=o>^</span> <span class=n>ulKeyList</span><span class=p>[</span><span class=n>i</span> <span class=o>+</span> <span class=mi>2</span><span class=p>]</span> <span class=o>^</span> <span class=n>ulKeyList</span><span class=p>[</span><span class=n>i</span> <span class=o>+</span> <span class=mi>3</span><span class=p>]</span> <span class=o>^</span> <span class=n>TBL_FIX_PARAMS</span><span class=p>[</span><span class=n>i</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=cm>/*生成32轮32位长子秘钥结束*/</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>j</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>j</span> <span class=o>&lt;</span> <span class=n>len</span> <span class=o>/</span> <span class=mi>16</span><span class=p>;</span> <span class=n>j</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span> <span class=c1>// 进行循环加密,并将加密后数据保存
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=cm>/*开始处理解密数据*/</span>
</span></span><span class=line><span class=cl>        <span class=nf>four_uCh2uLong</span><span class=p>(</span><span class=n>input</span> <span class=o>+</span> <span class=mi>16</span> <span class=o>*</span> <span class=n>j</span><span class=p>,</span> <span class=o>&amp;</span><span class=p>(</span><span class=n>ulDataList</span><span class=p>[</span><span class=mi>0</span><span class=p>]));</span>
</span></span><span class=line><span class=cl>        <span class=nf>four_uCh2uLong</span><span class=p>(</span><span class=n>input</span> <span class=o>+</span> <span class=mi>16</span> <span class=o>*</span> <span class=n>j</span> <span class=o>+</span> <span class=mi>4</span><span class=p>,</span> <span class=o>&amp;</span><span class=p>(</span><span class=n>ulDataList</span><span class=p>[</span><span class=mi>1</span><span class=p>]));</span>
</span></span><span class=line><span class=cl>        <span class=nf>four_uCh2uLong</span><span class=p>(</span><span class=n>input</span> <span class=o>+</span> <span class=mi>16</span> <span class=o>*</span> <span class=n>j</span> <span class=o>+</span> <span class=mi>8</span><span class=p>,</span> <span class=o>&amp;</span><span class=p>(</span><span class=n>ulDataList</span><span class=p>[</span><span class=mi>2</span><span class=p>]));</span>
</span></span><span class=line><span class=cl>        <span class=nf>four_uCh2uLong</span><span class=p>(</span><span class=n>input</span> <span class=o>+</span> <span class=mi>16</span> <span class=o>*</span> <span class=n>j</span> <span class=o>+</span> <span class=mi>12</span><span class=p>,</span> <span class=o>&amp;</span><span class=p>(</span><span class=n>ulDataList</span><span class=p>[</span><span class=mi>3</span><span class=p>]));</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 解密
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>for</span> <span class=p>(</span><span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=mi>32</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>            <span class=n>ulDataList</span><span class=p>[</span><span class=n>i</span> <span class=o>+</span> <span class=mi>4</span><span class=p>]</span> <span class=o>=</span> <span class=n>ulDataList</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>^</span> <span class=nf>func_data</span><span class=p>(</span><span class=n>ulDataList</span><span class=p>[</span><span class=n>i</span> <span class=o>+</span> <span class=mi>1</span><span class=p>]</span> <span class=o>^</span> <span class=n>ulDataList</span><span class=p>[</span><span class=n>i</span> <span class=o>+</span> <span class=mi>2</span><span class=p>]</span> <span class=o>^</span> <span class=n>ulDataList</span><span class=p>[</span><span class=n>i</span> <span class=o>+</span> <span class=mi>3</span><span class=p>]</span> <span class=o>^</span> <span class=n>ulKeyList</span><span class=p>[</span><span class=mi>35</span> <span class=o>-</span> <span class=n>i</span><span class=p>]);</span> <span class=c1>// 与加密唯一不同: 轮密钥使用顺序
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=cm>/*将解密后数据输出*/</span>
</span></span><span class=line><span class=cl>        <span class=nf>uLong2four_uCh</span><span class=p>(</span><span class=n>ulDataList</span><span class=p>[</span><span class=mi>35</span><span class=p>],</span> <span class=n>output</span> <span class=o>+</span> <span class=mi>16</span> <span class=o>*</span> <span class=n>j</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>uLong2four_uCh</span><span class=p>(</span><span class=n>ulDataList</span><span class=p>[</span><span class=mi>34</span><span class=p>],</span> <span class=n>output</span> <span class=o>+</span> <span class=mi>16</span> <span class=o>*</span> <span class=n>j</span> <span class=o>+</span> <span class=mi>4</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>uLong2four_uCh</span><span class=p>(</span><span class=n>ulDataList</span><span class=p>[</span><span class=mi>33</span><span class=p>],</span> <span class=n>output</span> <span class=o>+</span> <span class=mi>16</span> <span class=o>*</span> <span class=n>j</span> <span class=o>+</span> <span class=mi>8</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>uLong2four_uCh</span><span class=p>(</span><span class=n>ulDataList</span><span class=p>[</span><span class=mi>32</span><span class=p>],</span> <span class=n>output</span> <span class=o>+</span> <span class=mi>16</span> <span class=o>*</span> <span class=n>j</span> <span class=o>+</span> <span class=mi>12</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// 无符号字符数组转16进制打印
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kt>void</span> <span class=nf>print_hex</span><span class=p>(</span><span class=n>u8</span> <span class=o>*</span><span class=n>data</span><span class=p>,</span> <span class=kt>int</span> <span class=n>len</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span> <span class=n>alTmp</span><span class=p>[</span><span class=mi>16</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span><span class=sc>&#39;0&#39;</span><span class=p>,</span> <span class=sc>&#39;1&#39;</span><span class=p>,</span> <span class=sc>&#39;2&#39;</span><span class=p>,</span> <span class=sc>&#39;3&#39;</span><span class=p>,</span> <span class=sc>&#39;4&#39;</span><span class=p>,</span> <span class=sc>&#39;5&#39;</span><span class=p>,</span> <span class=sc>&#39;6&#39;</span><span class=p>,</span> <span class=sc>&#39;7&#39;</span><span class=p>,</span> <span class=sc>&#39;8&#39;</span><span class=p>,</span> <span class=sc>&#39;9&#39;</span><span class=p>,</span> <span class=sc>&#39;a&#39;</span><span class=p>,</span> <span class=sc>&#39;b&#39;</span><span class=p>,</span> <span class=sc>&#39;c&#39;</span><span class=p>,</span> <span class=sc>&#39;d&#39;</span><span class=p>,</span> <span class=sc>&#39;e&#39;</span><span class=p>,</span> <span class=sc>&#39;f&#39;</span><span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>len</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;%c&#34;</span><span class=p>,</span> <span class=n>alTmp</span><span class=p>[</span><span class=n>data</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>/</span> <span class=mi>16</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;%c&#34;</span><span class=p>,</span> <span class=n>alTmp</span><span class=p>[</span><span class=n>data</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>%</span> <span class=mi>16</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>        <span class=nf>putchar</span><span class=p>(</span><span class=sc>&#39; &#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nf>putchar</span><span class=p>(</span><span class=sc>&#39;\n&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(</span><span class=kt>void</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=n>u8</span> <span class=n>i</span><span class=p>,</span> <span class=n>len</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>u8</span> <span class=n>encode_Result</span><span class=p>[</span><span class=mi>50</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span><span class=mi>0</span><span class=p>};</span> <span class=c1>// 加密输出缓存区
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>u8</span> <span class=n>decode_Result</span><span class=p>[</span><span class=mi>50</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span><span class=mi>0</span><span class=p>};</span> <span class=c1>// 解密输出缓存区
</span></span></span><span class=line><span class=cl><span class=c1></span>    
</span></span><span class=line><span class=cl>    <span class=c1>// 16字节的密钥
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>u8</span> <span class=n>key</span><span class=p>[</span><span class=mi>16</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span><span class=mh>0x01</span><span class=p>,</span> <span class=mh>0x23</span><span class=p>,</span> <span class=mh>0x45</span><span class=p>,</span> <span class=mh>0x67</span><span class=p>,</span> <span class=mh>0x89</span><span class=p>,</span> <span class=mh>0xab</span><span class=p>,</span> <span class=mh>0xcd</span><span class=p>,</span> <span class=mh>0xef</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                  <span class=mh>0xfe</span><span class=p>,</span> <span class=mh>0xdc</span><span class=p>,</span> <span class=mh>0xba</span><span class=p>,</span> <span class=mh>0x98</span><span class=p>,</span> <span class=mh>0x76</span><span class=p>,</span> <span class=mh>0x54</span><span class=p>,</span> <span class=mh>0x32</span><span class=p>,</span> <span class=mh>0x10</span><span class=p>};</span> 
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 18字节明文
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// u8 Data_plain[18] = {0x01,0x23,0x45,0x67,0x89,0xab,0xcd,0xef,0xfe,
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>//                      0xdc,0xba,0x98,0x76,0x54,0x32,0x10,0x01,0x23 };
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// 32字节明文
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// u8 Data_plain[32] = {0x01,0x23,0x45,0x67,0x89,0xab,0xcd,0xef,
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>//                      0xfe,0xdc,0xba,0x98,0x76,0x54,0x32,0x10,
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>//                      0x01,0x23,0x45,0x67,0x89,0xab,0xcd,0xef,
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>//                      0xfe,0xdc,0xba,0x98,0x76,0x54,0x32,0x10 };
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// 16字节明文
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>u8</span> <span class=n>Data_plain</span><span class=p>[</span><span class=mi>16</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span><span class=mh>0x01</span><span class=p>,</span> <span class=mh>0x23</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=n>len</span> <span class=o>=</span> <span class=mi>16</span> <span class=o>*</span> <span class=p>(</span><span class=k>sizeof</span><span class=p>(</span><span class=n>Data_plain</span><span class=p>)</span> <span class=o>/</span> <span class=mi>16</span><span class=p>)</span> <span class=o>+</span> <span class=mi>16</span> <span class=o>*</span> <span class=p>((</span><span class=k>sizeof</span><span class=p>(</span><span class=n>Data_plain</span><span class=p>)</span> <span class=o>%</span> <span class=mi>16</span><span class=p>)</span> <span class=o>?</span> <span class=mi>1</span> <span class=o>:</span> <span class=mi>0</span><span class=p>);</span> <span class=c1>// 扩充后的字节数
</span></span></span><span class=line><span class=cl><span class=c1></span>    
</span></span><span class=line><span class=cl>    <span class=c1>// 加密
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nf>encode_fun</span><span class=p>(</span><span class=k>sizeof</span><span class=p>(</span><span class=n>Data_plain</span><span class=p>),</span> <span class=n>key</span><span class=p>,</span> <span class=n>Data_plain</span><span class=p>,</span> <span class=n>encode_Result</span><span class=p>);</span> <span class=c1>// 数据加密
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>for</span> <span class=p>(</span><span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>len</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;%x &#34;</span><span class=p>,</span> <span class=o>*</span><span class=p>(</span><span class=n>encode_Result</span> <span class=o>+</span> <span class=n>i</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 解密，注：解密函数的输入数据长度应为扩展后的数据长度(必为16的倍数)
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nf>decode_fun</span><span class=p>(</span><span class=n>len</span><span class=p>,</span> <span class=n>key</span><span class=p>,</span> <span class=n>encode_Result</span><span class=p>,</span> <span class=n>decode_Result</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=n>len</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;%x &#34;</span><span class=p>,</span> <span class=o>*</span><span class=p>(</span><span class=n>decode_Result</span> <span class=o>+</span> <span class=n>i</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div><h3 id=rc4>RC4</h3><p>对称加密算法，包括<strong>初始化算法</strong>（KSA)和<strong>加密算法</strong></p><img src=/img/reverse_note.zh-cn.assets/172845181249328.png alt=图片无法加载><p><strong>初始化过程</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-C"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-C data-lang=C><span class=line><span class=cl><span class=cp>#include</span><span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=kt>void</span> <span class=nf>rc4_init</span><span class=p>(</span><span class=kt>unsigned</span> <span class=kt>char</span><span class=o>*</span><span class=n>S</span><span class=p>,</span> <span class=kt>unsigned</span> <span class=kt>char</span><span class=o>*</span><span class=n>key</span><span class=p>,</span> <span class=kt>unsigned</span> <span class=kt>long</span> <span class=n>Len</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kt>char</span> <span class=n>T</span><span class=p>[</span><span class=mi>256</span><span class=p>]</span> <span class=o>=</span> <span class=p>{</span> <span class=mi>0</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>        <span class=kt>unsigned</span> <span class=kt>char</span> <span class=n>tmp</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 初始化 S 和 T 
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>for</span> <span class=p>(</span><span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=mi>256</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>                <span class=n>S</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=n>T</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>key</span><span class=p>[</span><span class=n>i</span><span class=o>%</span><span class=n>Len</span><span class=p>];</span> <span class=c1>// Len 为 key 的长度
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1>// 初始排列 S
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kt>int</span> <span class=n>j</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=mi>256</span><span class=p>;</span> <span class=n>i</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>j</span> <span class=o>=</span> <span class=p>(</span><span class=n>j</span> <span class=o>+</span> <span class=n>S</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>+</span> <span class=n>T</span><span class=p>[</span><span class=n>i</span><span class=p>])</span> <span class=o>%</span> <span class=mi>256</span><span class=p>;</span> <span class=c1>// 开始混淆
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=n>tmp</span> <span class=o>=</span> <span class=n>S</span><span class=p>[</span><span class=n>i</span><span class=p>];</span> 
</span></span><span class=line><span class=cl>                <span class=n>S</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>S</span><span class=p>[</span><span class=n>j</span><span class=p>];</span> <span class=c1>// 交换s[i]和s[j]
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=n>S</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=o>=</span> <span class=n>tmp</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div><p><strong>加解密过程</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-C"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-C data-lang=C><span class=line><span class=cl><span class=kt>void</span> <span class=nf>rc4_crypt</span><span class=p>(</span><span class=kt>unsigned</span> <span class=kt>char</span><span class=o>*</span><span class=n>S</span><span class=p>,</span> <span class=kt>unsigned</span> <span class=kt>char</span><span class=o>*</span><span class=n>Data</span><span class=p>,</span> <span class=kt>unsigned</span> <span class=kt>long</span> <span class=n>Len_Data</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span> <span class=c1>// 加解密同一函数
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>,</span> <span class=n>j</span> <span class=o>=</span> <span class=mi>0</span><span class=p>,</span> <span class=n>t</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=kt>unsigned</span> <span class=kt>long</span> <span class=n>k</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=c1>// 明文索引
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=kt>unsigned</span> <span class=kt>char</span> <span class=n>tmp</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=n>k</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>k</span> <span class=o>&lt;</span> <span class=n>Len_Data</span><span class=p>;</span> <span class=n>k</span><span class=o>++</span><span class=p>)</span> <span class=c1>// Len 明文长度
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=c1>// 生成密钥流，利用密钥流和明文进行加密
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=n>i</span> <span class=o>=</span> <span class=p>(</span><span class=n>i</span> <span class=o>+</span> <span class=mi>1</span><span class=p>)</span> <span class=o>%</span> <span class=mi>256</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=n>j</span> <span class=o>=</span> <span class=p>(</span><span class=n>j</span> <span class=o>+</span> <span class=n>S</span><span class=p>[</span><span class=n>i</span><span class=p>])</span> <span class=o>%</span> <span class=mi>256</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=n>tmp</span> <span class=o>=</span> <span class=n>S</span><span class=p>[</span><span class=n>i</span><span class=p>];</span>
</span></span><span class=line><span class=cl>                <span class=n>S</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>S</span><span class=p>[</span><span class=n>j</span><span class=p>];</span> <span class=c1>// 交换 S[x] 和 S[y] 
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=n>S</span><span class=p>[</span><span class=n>j</span><span class=p>]</span> <span class=o>=</span> <span class=n>tmp</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=n>t</span> <span class=o>=</span> <span class=p>(</span><span class=n>S</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>+</span> <span class=n>S</span><span class=p>[</span><span class=n>j</span><span class=p>])</span> <span class=o>%</span> <span class=mi>256</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=n>Data</span><span class=p>[</span><span class=n>k</span><span class=p>]</span> <span class=o>^=</span> <span class=n>S</span><span class=p>[</span><span class=n>t</span><span class=p>];</span> <span class=c1>// S_box 和明文 xor 加密
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div><p><strong>调用</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-C"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-C data-lang=C><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>    <span class=c1>// system(&#34;chcp 65001&#34;); // 防止终端乱码
</span></span></span><span class=line><span class=cl><span class=c1></span>        
</span></span><span class=line><span class=cl>    <span class=kt>unsigned</span> <span class=kt>char</span> <span class=n>S</span><span class=p>[</span><span class=mi>256</span><span class=p>]</span><span class=o>=</span><span class=p>{</span><span class=mi>0</span><span class=p>};</span> <span class=c1>// S_box
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>unsigned</span> <span class=kt>char</span> <span class=n>key</span><span class=p>[]</span><span class=o>=</span> <span class=s>&#34;xxxxxx&#34;</span><span class=p>;</span> <span class=c1>// char key[256] = {0}
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// scanf(&#34;%s&#34;,key);
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// 赋值： unsigned __int8 data[] = {27, 155, 251, 25, 6, 106};
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>unsigned</span> <span class=kt>char</span> <span class=n>data</span><span class=p>[]</span> <span class=o>=</span> <span class=p>{</span><span class=mh>0xa7</span><span class=p>,</span> <span class=mh>0x11</span><span class=p>};</span>
</span></span><span class=line><span class=cl>    <span class=c1>// scanf(&#34;%s&#34;,data);
</span></span></span><span class=line><span class=cl><span class=c1></span>    
</span></span><span class=line><span class=cl>    <span class=c1>// unsigned long length = strlen(key);
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>unsigned</span> <span class=kt>long</span> <span class=n>length</span> <span class=o>=</span> <span class=k>sizeof</span><span class=p>(</span><span class=n>key</span><span class=p>)</span> <span class=o>-</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>unsigned</span> <span class=kt>long</span> <span class=n>data_size</span> <span class=o>=</span> <span class=k>sizeof</span><span class=p>(</span><span class=n>data</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>rc4_init</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>key</span><span class=p>,</span><span class=n>length</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nf>rc4_crypt</span><span class=p>(</span><span class=n>S</span><span class=p>,</span><span class=n>data</span><span class=p>,</span><span class=n>data_size</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;%s&#34;</span><span class=p>,</span><span class=n>data</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div><p><strong>CyberChef</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><pre tabindex=0><code>input: 0xA7, 0x1A, 0x11
# Find/Replace , {Global match, Case insensitive, Dot matches all}
# Find/Replace \n {Global match, Case insensitive, Dot matches all}
# From Hex Auto
# RC4 </code></pre></div><p><strong>python</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-python"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Cipher</span> <span class=kn>import</span> <span class=n>ARC4</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>rc4_decrypt</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>key</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;flag.fromserver&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>rc4</span> <span class=o>=</span> <span class=n>ARC4</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>decrypted_data</span> <span class=o>=</span> <span class=n>rc4</span><span class=o>.</span><span class=n>decrypt</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>decrypted_data</span></span></span></code></pre></div></div><h3 id=des>DES</h3><h3 id=base算法>Base算法</h3><p>密码+编码</p><h4 id=base64>base64</h4><p>基于64个可打印字符来表示二进制数据，6个bit为一个单元</p><h2 id=代码混淆>代码混淆</h2><h3 id=脏字节>脏字节</h3><p>在汇编中加入<code>db 232</code></p><img src=/img/reverse_note.zh-cn.assets/172845181249329.png alt=图片无法加载><h3 id=花指令>花指令</h3><img src=/img/reverse_note.zh-cn.assets/172845181249330.png alt=图片无法加载><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-Assembly"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><pre tabindex=0><code class=language-Assembly data-lang=Assembly>mov eax, $
add eax, 12
jmp eax    ;跳转到寄存器中的地址</code></pre></div><p>需要在汇编查看可疑跳转，IDA F5无法看出</p><h3 id=smc技术>SMC技术</h3><p><strong>Self Modifying Code</strong>：自解码代码，程序中的部分代码加密，并插入解密代码，当程序需要运行源代码时，调用解密函数解密该部分代码，再跳转执行，阻止静态分析</p><p><strong>Windows</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-C++"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-C++ data-lang=C++><span class=line><span class=cl><span class=c1>// API函数，允许应用程序改变内存页的保护属性
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>BOOL</span> <span class=n>VirtualProtect</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>LPCVOID</span> <span class=n>lpAddress</span><span class=p>,</span>    <span class=c1>// 内存页起始地址
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>SIZE_T</span> <span class=n>dwSize</span><span class=p>,</span>        <span class=c1>// 内存页大小
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>DWORD</span> <span class=n>flNewProtect</span><span class=p>,</span>   <span class=c1>// 新保护属性 PAGE_EXECUTE_READWRITE=0x40
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>PDWORD</span> <span class=n>lpfloldProtect</span> <span class=c1>// 存储旧的保护属性
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>};</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=n>VirtualProtect</span><span class=p>((</span><span class=kt>char</span> <span class=o>*</span><span class=p>)</span><span class=o>&amp;</span><span class=n>loc_401040</span><span class=p>,</span> <span class=mh>0xCCu</span><span class=p>,</span> <span class=mh>0x40u</span><span class=p>,</span> <span class=p>(</span><span class=n>PDWORD</span><span class=p>)(</span><span class=n>v</span><span class=p>));</span> <span class=c1>// 使得401040开始0xcc的内存可读可写可执行
</span></span></span></code></pre></div></div><p>修改会在IDA中发现：</p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-c"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kr>__asm</span> <span class=p>{</span> <span class=n>outsd</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nf>__indword</span><span class=p>(</span><span class=mh>0x98u</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>__asm</span> <span class=p>{</span> <span class=n>retf</span> <span class=p>}</span></span></span></code></pre></div></div><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-c"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=o>*</span><span class=p>(</span><span class=n>a</span> <span class=o>-</span> <span class=mi>40</span><span class=p>),</span> <span class=o>*</span><span class=p>(</span><span class=n>a</span> <span class=o>-</span> <span class=mi>36</span><span class=p>),</span> <span class=o>*</span><span class=p>(</span><span class=n>a</span> <span class=o>-</span> <span class=mi>32</span><span class=p>)</span> <span class=c1>// 一般为四个字节当一个整型计算
</span></span></span></code></pre></div></div><p><strong>IDAPython</strong></p><p>操作：<code>File > Script command > run</code></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-python"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>idc</span>
</span></span><span class=line><span class=cl><span class=n>addr</span> <span class=o>=</span> <span class=mh>0xabcdef</span>  <span class=c1># 是开始操作的起始地址</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>531</span><span class=p>):</span> <span class=c1># 直接末尾地址-起始地址</span>
</span></span><span class=line><span class=cl>    <span class=n>b</span> <span class=o>=</span> <span class=n>get_bytes</span><span class=p>(</span><span class=n>addr</span> <span class=o>+</span> <span class=n>i</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>idc</span><span class=o>.</span><span class=n>patch_byte</span><span class=p>(</span><span class=n>addr</span> <span class=o>+</span> <span class=n>i</span><span class=p>,</span> <span class=nb>ord</span><span class=p>(</span><span class=n>b</span><span class=p>)</span> <span class=o>^</span> <span class=mh>0x90</span><span class=p>)</span> <span class=c1># 具体变化操作</span></span></span></code></pre></div></div><p><strong>IDC</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-c"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=k>static</span> <span class=nf>xor</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=k>auto</span> <span class=n>addr</span> <span class=o>=</span> <span class=mh>0xabcdef</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>auto</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span><span class=p>(</span><span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span><span class=n>addr</span><span class=o>+</span><span class=n>i</span><span class=o>&lt;</span><span class=mh>0xfedcba</span><span class=p>;</span><span class=n>i</span><span class=o>++</span><span class=p>){</span>
</span></span><span class=line><span class=cl>		<span class=nf>PatchByte</span><span class=p>(</span><span class=n>addr</span><span class=o>+</span><span class=n>i</span><span class=p>,</span><span class=nf>Byte</span><span class=p>(</span><span class=n>addr</span><span class=o>+</span><span class=n>i</span><span class=p>)</span><span class=o>^</span><span class=mh>0x90</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div><p><strong>动调解决</strong></p><h3 id=反调试>反调试</h3><p>函数声明</p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-C"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-C data-lang=C><span class=line><span class=cl><span class=kt>long</span> <span class=nf>ptrace</span><span class=p>(</span><span class=k>enum</span> <span class=n>__ptrace_request</span> <span class=n>requête</span><span class=p>,</span> <span class=kt>pid_t</span> <span class=n>pid</span><span class=p>,</span> <span class=kt>void</span> <span class=o>*</span><span class=n>addr</span><span class=p>,</span> <span class=kt>void</span> <span class=o>*</span><span class=n>data</span><span class=p>);</span></span></span></code></pre></div></div><p><strong>PTRACE_TRACEME: 子进程标记</strong></p><p><strong>PTRACE_ATTACH: 父进程附加</strong></p><p><strong>PTRACE_CONT: 继续执行</strong></p><p>绕过：通过动态调试修改RIP直接跳到main函数 或 patch/nop反调试函数</p><h3 id=ollvm>OLLVM</h3><p><strong>Obfuscator-LLVM，原理：通过修改“LLVM-IR”完成，本质是一个LLVM-PASS——一套IR代码优化脚本</strong></p><img src=/img/reverse_note.zh-cn.assets/172845181249331.png alt=图片无法加载><p><strong>控制流平坦化</strong></p><p>将基本控制流并列，由<strong>主分发器</strong>来决定执行顺序</p><img src=/img/reverse_note.zh-cn.assets/172845181249332.png alt=图片无法加载><p><strong>指令替换</strong></p><p>基本运算公式复杂化</p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-Plain"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-Plain data-lang=Plain><span class=line><span class=cl>混淆前: a=b+c    &gt;&gt;     混淆后: a=b+r, a=a+c, a=a-r
</span></span><span class=line><span class=cl>混淆前: a=b|c    &gt;&gt;     混淆后: a=(b&amp;c)|(b^c)    //b, c均为整数时</span></span></code></pre></div></div><p><strong>虚假控制流</strong></p><p>将原本顺序执行转为条件执行，条件为“永真式”导致不会执行虚假块，但IDA会进行控制流分析</p><img src=/img/reverse_note.zh-cn.assets/172845181249333.png alt=图片无法加载><p>永真式：<code>(((x - 1) * x) & 1) == 0</code></p><h2 id=maze>maze</h2><p>迷宫问题</p><ul><li>内存中布置一张地图(#和*显示)</li><li>用户输入限制在少数几个字符范围内(方向w/s/a/d等)</li><li>一般只1个迷宫入口、1个迷宫出口(多走法时代价最小 &mdash;> 算法问题)</li></ul><p><strong>迷宫初始化</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-Python"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=n>rows</span><span class=p>,</span> <span class=n>cols</span> <span class=o>=</span> <span class=mi>10</span><span class=p>,</span> <span class=mi>10</span>
</span></span><span class=line><span class=cl><span class=n>array</span> <span class=o>=</span> <span class=p>[[</span><span class=s1>&#39;0&#39;</span> <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>cols</span><span class=p>)]</span> <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>rows</span><span class=p>)]</span></span></span></code></pre></div></div><p><strong>回溯算法</strong></p><ul><li>深度优先算法DFS：栈</li><li>广度优先算法BFS：队列</li></ul><h3 id=dfs>DFS</h3><div class="code-block code-line-numbers" style="counter-reset:code-block 0"><div class="code-header language-Python"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>sys</span> <span class=c1># 设置递归深度</span>
</span></span><span class=line><span class=cl><span class=n>sys</span><span class=o>.</span><span class=n>setrecursionlimit</span><span class=p>(</span><span class=mi>20000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># x行 y列</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>check</span><span class=p>(</span><span class=nb>map</span><span class=p>,</span> <span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>):</span> <span class=c1># 检查是否为0</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>x</span> <span class=o>&gt;=</span> <span class=mi>0</span><span class=p>)</span> <span class=ow>and</span> <span class=p>(</span><span class=n>x</span> <span class=o>&lt;=</span> <span class=n>max_x</span><span class=p>)</span> <span class=ow>and</span> <span class=p>(</span><span class=n>y</span> <span class=o>&gt;=</span> <span class=mi>0</span><span class=p>)</span> <span class=ow>and</span> <span class=p>(</span><span class=n>y</span> <span class=o>&lt;=</span> <span class=n>max_y</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nb>map</span><span class=p>[</span><span class=n>x</span><span class=p>][</span><span class=n>y</span><span class=p>]</span> <span class=o>==</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>gen_nex</span><span class=p>(</span><span class=nb>map</span><span class=p>,</span> <span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>):</span> <span class=c1># 当前位置四周的情况</span>
</span></span><span class=line><span class=cl>    <span class=n>all_dir</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>check</span><span class=p>(</span><span class=nb>map</span><span class=p>,</span> <span class=n>x</span> <span class=o>-</span> <span class=mi>1</span><span class=p>,</span> <span class=n>y</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>all_dir</span><span class=o>.</span><span class=n>append</span><span class=p>((</span><span class=n>x</span> <span class=o>-</span> <span class=mi>1</span><span class=p>,</span> <span class=n>y</span><span class=p>,</span> <span class=s1>&#39;w&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>check</span><span class=p>(</span><span class=nb>map</span><span class=p>,</span> <span class=n>x</span> <span class=o>+</span> <span class=mi>1</span><span class=p>,</span> <span class=n>y</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>all_dir</span><span class=o>.</span><span class=n>append</span><span class=p>((</span><span class=n>x</span> <span class=o>+</span> <span class=mi>1</span><span class=p>,</span> <span class=n>y</span><span class=p>,</span> <span class=s1>&#39;s&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>check</span><span class=p>(</span><span class=nb>map</span><span class=p>,</span> <span class=n>x</span><span class=p>,</span> <span class=n>y</span> <span class=o>-</span> <span class=mi>1</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>all_dir</span><span class=o>.</span><span class=n>append</span><span class=p>((</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span> <span class=o>-</span> <span class=mi>1</span><span class=p>,</span> <span class=s1>&#39;a&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>check</span><span class=p>(</span><span class=nb>map</span><span class=p>,</span> <span class=n>x</span><span class=p>,</span> <span class=n>y</span> <span class=o>+</span> <span class=mi>1</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>all_dir</span><span class=o>.</span><span class=n>append</span><span class=p>((</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span> <span class=o>+</span> <span class=mi>1</span><span class=p>,</span> <span class=s1>&#39;d&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>all_dir</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>check_success</span><span class=p>(</span><span class=nb>map</span><span class=p>,</span> <span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>x</span> <span class=o>==</span> <span class=mi>54</span> <span class=ow>and</span> <span class=n>y</span> <span class=o>==</span> <span class=mi>74</span><span class=p>:</span> <span class=c1># 判断出口</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>print_info</span><span class=p>(</span><span class=nb>map</span><span class=p>,</span> <span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>,</span> <span class=n>path</span><span class=p>,</span> <span class=n>file_path</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>file_path</span><span class=p>,</span> <span class=s1>&#39;a&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=c1># 地图</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>row</span> <span class=ow>in</span> <span class=nb>map</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=s1>&#39;&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>cell</span><span class=p>)</span> <span class=k>for</span> <span class=n>cell</span> <span class=ow>in</span> <span class=n>row</span><span class=p>)</span> <span class=o>+</span> <span class=s1>&#39;</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=s1>&#39;</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>  <span class=c1># 用于分隔每次递归的地图</span>
</span></span><span class=line><span class=cl>    <span class=c1># 坐标</span>
</span></span><span class=line><span class=cl>        <span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>x</span><span class=p>)</span> <span class=o>+</span> <span class=s2>&#34; &#34;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>y</span><span class=p>)</span><span class=o>+</span><span class=s1>&#39;</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1># 路径</span>
</span></span><span class=line><span class=cl>        <span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>path</span><span class=o>+</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>dfs</span><span class=p>(</span><span class=n>maze</span><span class=p>,</span> <span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>,</span> <span class=n>path</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nb>map</span> <span class=o>=</span> <span class=n>maze</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>    <span class=c1># 这里用将maze复制给map，避免修改掉原地图。</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>x</span><span class=o>!=</span><span class=mi>54</span> <span class=ow>or</span> <span class=n>y</span><span class=o>!=</span><span class=mi>74</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>map</span><span class=p>[</span><span class=n>x</span><span class=p>][</span><span class=n>y</span><span class=p>]</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>check_success</span><span class=p>(</span><span class=nb>map</span><span class=p>,</span> <span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># print_path(path, &#39;b.txt&#39;)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>next_point</span> <span class=o>=</span> <span class=n>gen_nex</span><span class=p>(</span><span class=nb>map</span><span class=p>,</span> <span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>n</span> <span class=ow>in</span> <span class=n>next_point</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>pathn</span> <span class=o>=</span> <span class=n>path</span> <span class=o>+</span> <span class=n>n</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span>       <span class=c1># 将all_dir列表中的元组的第三个值，即方向传给pathn</span>
</span></span><span class=line><span class=cl>        <span class=n>print_info</span><span class=p>(</span><span class=nb>map</span><span class=p>,</span> <span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>,</span> <span class=n>pathn</span><span class=p>,</span> <span class=s1>&#39;a.txt&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>dfs</span><span class=p>(</span><span class=nb>map</span><span class=p>,</span> <span class=n>n</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>n</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=n>pathn</span><span class=p>):</span>        <span class=c1># 这里开始递归 用all_dir的元组第一二个值和pathn作为参数，进行当前位置的又一次深度优先遍历</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>dfs</span><span class=p>(</span><span class=n>maze</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=s2>&#34;begin:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 使用之后仍需要判断是否正确, 比如: dwds &gt; dd, dwwdss &gt; dd</span></span></span></code></pre></div></div><h2 id=壳>壳</h2><img src=/img/reverse_note.zh-cn.assets/172845181249334.png alt=图片无法加载><h3 id=压缩壳>压缩壳</h3><h4 id=upx>UPX</h4><p>开源、压缩壳，原文件需要40kb以上才能加壳，可通过strings查看UPX字符串</p><p>脱壳原理为<strong>ESP定律</strong>（即堆栈平衡定律），可以在linux中使用：</p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-Bash"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-Bash data-lang=Bash><span class=line><span class=cl>upx -d file <span class=c1>#进行脱壳</span></span></span></code></pre></div></div><p>或在Windows下使用<strong>UPX shell</strong>直接解压缩，UPX shell解压缩可能导致文件无法运行</p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-Python"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=c1># 在upx目录下 脱壳</span>
</span></span><span class=line><span class=cl><span class=o>./</span><span class=n>upx</span><span class=o>.</span><span class=n>exe</span> <span class=o>-</span><span class=n>d</span> <span class=n>file</span></span></span></code></pre></div></div><p><strong>x96dbg</strong>：F8 > 寄存器窗口 > ESP > 在内存窗口中转到</p><p><strong>Ollydbg</strong>：只能调试32位</p><p><strong>使用OD进行UPX手动脱壳</strong></p><p>第一条指令一般为pushad，将寄存器值存入栈中，保存上下文</p><img src=/img/reverse_note.zh-cn.assets/172845181249435.png alt=图片无法加载><p>F8单步执行，此时寄存器ESP值发生改变</p><img src=/img/reverse_note.zh-cn.assets/172845181249436.png alt=图片无法加载><p>寄存器窗口 > ESP > HW break[ESP] 或 [数据窗口中跟随] 转到内存视图 > 此处ESP地址设置断点-硬件访问</p><img src=/img/reverse_note.zh-cn.assets/172845181249437.png alt=图片无法加载><p>F9运行到断点处，上图<code>003B750F</code>的上一行为<code>popad</code>，当执行到popad时，将会恢复ESP，此时将会触发硬件断点，中断</p><p>发现一个大跳转<code>jmp UPX</code>，于是F4到jmp代码处 > F8步入</p><img src=/img/reverse_note.zh-cn.assets/172845181249438.png alt=图片无法加载>
<img src=/img/reverse_note.zh-cn.assets/172845181249439.png alt=图片无法加载><p>出现了正常的函数开头和结尾，即找到OEP</p><p><strong>进行dump完成脱壳</strong>：</p><ol><li><strong>插件 > OllyDump > 脱壳在当前调试的进程 > 获取EIP作为OEP > 脱壳【由于不是windows XP会失败】</strong></li><li><strong>右键 > 用OllyDump脱壳调试进程 > 脱壳</strong></li></ol><p><strong>x64dbg+手动脱壳</strong></p><p>打开文件先查看系统断点，<code>F9</code>运行进入断点处，有多个<code>push</code>操作</p><h3 id=加密壳>加密壳</h3><h4 id=vmp>VMP</h4><p>dll中加入了VMP壳：<code>VMProtect</code></p><p><strong>爆破脚本</strong>：爆破exe文件</p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-C++"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-C++ data-lang=C++><span class=line><span class=cl><span class=cp>#include&lt;iostream&gt;
</span></span></span><span class=line><span class=cl><span class=cp>#include&lt;Windows.h&gt;
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>BF</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>	<span class=n>HMODULE</span> <span class=n>h</span> <span class=o>=</span> <span class=nb>NULL</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>h</span> <span class=o>=</span> <span class=n>LoadLibraryA</span><span class=p>(</span><span class=s>&#34;xx.dll&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>typedef</span> <span class=kt>int</span><span class=p>(</span><span class=o>*</span><span class=n>func_in_dll</span><span class=p>)(</span><span class=kt>char</span><span class=o>*</span><span class=p>,</span> <span class=n>size_t</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kt>char</span><span class=o>*</span> <span class=n>flag</span> <span class=o>=</span> <span class=p>(</span><span class=kt>char</span><span class=o>*</span><span class=p>)</span><span class=n>malloc</span><span class=p>(</span><span class=mi>16</span><span class=p>);</span> <span class=c1>// 15内容+&#39;\0&#39;
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// 初始化
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>flag</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=sc>&#39;x&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>flag</span><span class=p>[</span><span class=mi>15</span><span class=p>]</span> <span class=o>=</span> <span class=sc>&#39;\0&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>func_in_dll</span> <span class=n>func</span> <span class=o>=</span> <span class=p>(</span><span class=n>func_in_dll</span><span class=p>)</span><span class=n>GetProcAddress</span><span class=p>(</span><span class=n>h</span><span class=p>,</span> <span class=s>&#34;func_in_dll&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=c1>// 爆破
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>...</span> <span class=k>if</span><span class=p>(</span><span class=n>func</span><span class=p>(</span><span class=n>flag</span><span class=p>,</span> <span class=mi>15</span><span class=p>)){</span>
</span></span><span class=line><span class=cl>        <span class=n>printf</span><span class=p>(</span><span class=s>&#34;%s</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>flag</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>CloseHandle</span><span class=p>(</span><span class=n>h</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div><h2 id=脱壳>脱壳</h2><p>单步跟踪寻找OEP（original entry point，原始入口点），寻找大型跳转</p><h3 id=api定位>API定位</h3><p><strong>Microsoft Visual C/C++ 6</strong></p><ul><li><code>VC6</code>写的代码，直接定位到<code>GetVersion</code>下断点</li><li>x64dbg中：<code>视图</code> > <code>模块</code>，<code>GetVersion</code>在<code>Kernel32.dll</code>中，运行，在栈中找调用函数</li><li>OEP在GetVersion上文</li></ul><h3 id=esp定律>ESP定律</h3><p>od载入程序有pushad指令可用其脱壳</p><h2 id=windows-api>Windows API</h2><p><strong>堆API</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-C++"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-C++ data-lang=C++><span class=line><span class=cl><span class=n>HeapCreate</span><span class=p>(</span><span class=n>flOptions</span><span class=p>,</span> <span class=n>dwInitialSize</span><span class=p>,</span> <span class=n>dwMaximumSize</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1>// 堆分配选项, 堆的初始大小, 堆的最大大小
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=n>HeapAlloc</span><span class=p>(</span><span class=n>hHeap</span><span class=p>,</span> <span class=n>dwFlags</span><span class=p>,</span> <span class=n>dwBytes</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1>// 指向堆的句柄, 堆分配选项, 分配字节数
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=n>HeapFree</span><span class=p>(</span><span class=n>hHeap</span><span class=p>,</span> <span class=n>dwFlags</span><span class=p>,</span> <span class=n>lpMem</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1>// 释放的堆的句柄, 堆释放选项, 指向要释放内存块的指针
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=n>HeapDestroy</span><span class=p>(</span><span class=n>hHeap</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1>// 销毁的堆的句柄
</span></span></span></code></pre></div></div><p><strong>用户API</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-C++"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-C++ data-lang=C++><span class=line><span class=cl><span class=n>MessageBoxA</span><span class=p>(</span><span class=n>hWnd</span><span class=p>,</span> <span class=n>lpText</span><span class=p>,</span> <span class=n>lpCaption</span><span class=p>,</span> <span class=n>uType</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1>// 消息框所有者窗口的句柄, 显示信息, 对话框标题, 对话框内容和行为(中止,重试,忽略,确认,取消) 
</span></span></span></code></pre></div></div><p><strong>调试API</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-C++"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-C++ data-lang=C++><span class=line><span class=cl><span class=n>IsDebuggerPresent</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=c1>// 当前进程在调试器上下文中运行，返回非0; 否则为0
</span></span></span></code></pre></div></div><p><strong>调用库API</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-c"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>libr</span> <span class=o>=</span> <span class=nf>LoadLibraryA</span><span class=p>(</span><span class=s>&#34;xxx.dll&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=c1>// 将指定模块加载到调用进程地址空间
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=n>addr</span> <span class=o>=</span> <span class=nf>GetProcAddress</span><span class=p>(</span><span class=n>libr</span><span class=p>,</span> <span class=s>&#34;fun_or_vari&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=c1>// 从指定动态链接库dll导入函数或变量地址
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=nf>CloseHandle</span><span class=p>(</span><span class=n>libr</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=c1>// 关闭对象的有效句柄
</span></span></span></code></pre></div></div><h2 id=安卓>安卓</h2><p>jadx打开文件后，<code>AndroidManifest.xml</code>文件中包括<strong>配置信息</strong>等</p><p><code>APK</code>文件若PC模拟器无法打开，则直接尝试手机安装打开，版本问题</p><h2 id=python-1>python</h2><p><strong>Cython</strong></p><p><code>whl</code>文件格式<code>xxx-1.14-cp312-cp312-win_amd64</code>中cp312表示python的版本：python-3.12，需要使用对应的python版本进行安装</p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-python"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>pythonx</span> <span class=o>-</span><span class=n>m</span> <span class=n>pip</span> <span class=n>install</span> <span class=n>xxx</span><span class=o>.</span><span class=n>whl</span> <span class=c1># 使用python指定的对应pip安装</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>xxx</span> <span class=c1># 安装后直接导入</span>
</span></span><span class=line><span class=cl><span class=n>help</span><span class=p>(</span><span class=n>xxx</span><span class=p>)</span> <span class=c1># 可以查看信息</span></span></span></code></pre></div></div><h2 id=vm>VM</h2><p>维护opcode操作码表模拟虚拟机操作，<code>switch</code>对于不同的码进行相应操作，一般来说都是对<strong>单字符</strong>进行处理，先使用IDA动态调试跟踪操作</p><p><strong>Frida插桩测试</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-javascript"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>var</span> <span class=nx>number</span>  <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>main</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>     <span class=kd>var</span> <span class=nx>base</span>  <span class=o>=</span>  <span class=nx>Module</span><span class=p>.</span><span class=nx>findBaseAddress</span><span class=p>(</span> <span class=s2>&#34;test.exe&#34;</span> <span class=p>)</span> <span class=c1>// 获取目标进程的基地址 
</span></span></span><span class=line><span class=cl><span class=c1></span>     <span class=c1>// console.log( &#34;base:&#34; ,base)
</span></span></span><span class=line><span class=cl><span class=c1></span>     <span class=k>if</span> <span class=p>(</span><span class=nx>base</span><span class=p>){</span>
</span></span><span class=line><span class=cl>         <span class=nx>Interceptor</span><span class=p>.</span><span class=nx>attach</span><span class=p>(</span><span class=nx>base</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span> <span class=mh>0x1044</span> <span class=p>),</span> <span class=p>{</span> <span class=c1>// 该地址为opcode idx+1
</span></span></span><span class=line><span class=cl><span class=c1></span>                 <span class=nx>onEnter</span><span class=o>:</span> <span class=kd>function</span><span class=p>(</span><span class=nx>args</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                     <span class=nx>number</span> <span class=o>+=</span> <span class=mi>1</span> <span class=c1>// 进行插桩 每当程序运行到该地址 number + = 1
</span></span></span><span class=line><span class=cl><span class=c1></span>                 <span class=p>}</span>
</span></span><span class=line><span class=cl>         <span class=p>});</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>         <span class=nx>Interceptor</span><span class=p>.</span><span class=nx>attach</span><span class=p>(</span><span class=nx>base</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span> <span class=mh>0x113f</span> <span class=p>),</span> <span class=p>{</span> <span class=c1>// 结束
</span></span></span><span class=line><span class=cl><span class=c1></span>             <span class=nx>onEnter</span><span class=o>:</span> <span class=kd>function</span><span class=p>(</span><span class=nx>args</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                 <span class=c1>// send(number) // 配合python自动化脚本
</span></span></span><span class=line><span class=cl><span class=c1></span>                 <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span> <span class=s2>&#34;end!&#34;</span> <span class=p>,</span><span class=nx>number</span><span class=p>)</span>
</span></span><span class=line><span class=cl>             <span class=p>}</span>
</span></span><span class=line><span class=cl>         <span class=p>});</span>
</span></span><span class=line><span class=cl>     <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nx>setImmediate</span><span class=p>(</span><span class=nx>main</span><span class=p>);</span> <span class=c1>// 异步调用
</span></span></span></code></pre></div></div><p>此时在输入不同值时会出现不同number，且输入正确number会增加，可利用此进行侧信道爆破</p><p><strong>侧信道爆破</strong></p><div class="code-block code-line-numbers" style="counter-reset:code-block 0"><div class="code-header language-python"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># -*- coding: UTF-8 -*-</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>subprocess</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>frida</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>is_right</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>global</span> <span class=n>new_number</span><span class=p>,</span><span class=n>number</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>new_number</span> <span class=o>&gt;</span> <span class=n>number</span><span class=p>:</span> <span class=c1># number增加则猜测正确，更新</span>
</span></span><span class=line><span class=cl>        <span class=n>number</span> <span class=o>=</span> <span class=n>new_number</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>on_message</span><span class=p>(</span><span class=n>message</span><span class=p>,</span> <span class=n>data</span><span class=p>):</span> <span class=c1># 处理从注入的 JavaScript 脚本中发送回来的消息</span>
</span></span><span class=line><span class=cl>    <span class=k>global</span> <span class=n>new_number</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>message</span><span class=p>[</span><span class=s1>&#39;type&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=s1>&#39;send&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[*] </span><span class=si>{0}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>message</span><span class=p>[</span><span class=s1>&#39;payload&#39;</span><span class=p>]))</span>
</span></span><span class=line><span class=cl>        <span class=n>new_number</span> <span class=o>=</span> <span class=n>message</span><span class=p>[</span><span class=s1>&#39;payload&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=n>message</span><span class=p>[</span><span class=s1>&#39;type&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=s2>&#34;error&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=n>message</span><span class=p>[</span><span class=s2>&#34;description&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=n>message</span><span class=p>[</span><span class=s2>&#34;stack&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=n>message</span><span class=p>[</span><span class=s2>&#34;fileName&#34;</span><span class=p>],</span><span class=s2>&#34;line:&#34;</span><span class=p>,</span><span class=n>message</span><span class=p>[</span><span class=s2>&#34;lineNumber&#34;</span><span class=p>],</span><span class=s2>&#34;colum:&#34;</span><span class=p>,</span><span class=n>message</span><span class=p>[</span><span class=s2>&#34;columnNumber&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>pass</span>        
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>printable</span> <span class=o>=</span> <span class=s2>&#34;`!</span><span class=se>\&#34;</span><span class=s2>#$%&amp;&#39;()*+,-./:;&lt;=&gt;?@[]^_{|}~0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#34;</span>
</span></span><span class=line><span class=cl><span class=n>number</span> <span class=o>=</span> <span class=mi>709</span> <span class=c1># 测试脚本输出的number值</span>
</span></span><span class=line><span class=cl><span class=n>new_number</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=n>flag</span> <span class=o>=</span> <span class=s2>&#34;xxxctf{&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>jscode</span> <span class=o>=</span> <span class=nb>open</span><span class=p>(</span><span class=s2>&#34;h00k.js&#34;</span><span class=p>,</span><span class=s2>&#34;rb&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>read</span><span class=p>()</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>index</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>flag</span><span class=p>),</span><span class=mi>54</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>printable</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>process</span> <span class=o>=</span> <span class=n>subprocess</span><span class=o>.</span><span class=n>Popen</span><span class=p>(</span><span class=s2>&#34;test.exe&#34;</span><span class=p>,</span> <span class=c1># 启动程序</span>
</span></span><span class=line><span class=cl>            <span class=n>stdin</span><span class=o>=</span><span class=n>subprocess</span><span class=o>.</span><span class=n>PIPE</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>stdout</span><span class=o>=</span><span class=n>subprocess</span><span class=o>.</span><span class=n>PIPE</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>stderr</span><span class=o>=</span><span class=n>subprocess</span><span class=o>.</span><span class=n>PIPE</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>universal_newlines</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>tmp_flag</span> <span class=o>=</span> <span class=p>(</span><span class=n>flag</span><span class=o>+</span><span class=n>i</span><span class=p>)</span><span class=o>.</span><span class=n>ljust</span><span class=p>(</span><span class=mi>53</span><span class=p>,</span><span class=s2>&#34;A&#34;</span><span class=p>)</span><span class=o>+</span><span class=s2>&#34;}&#34;</span> <span class=c1># 54 - 1</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=n>tmp_flag</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;try index:&#34;</span><span class=p>,</span><span class=n>index</span> <span class=p>,</span><span class=s2>&#34;chr :&#34;</span><span class=p>,</span><span class=n>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=c1># 附加frida脚本到目标进程</span>
</span></span><span class=line><span class=cl>        <span class=n>session</span> <span class=o>=</span> <span class=n>frida</span><span class=o>.</span><span class=n>attach</span><span class=p>(</span><span class=s2>&#34;test.exe&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>script</span> <span class=o>=</span> <span class=n>session</span><span class=o>.</span><span class=n>create_script</span><span class=p>(</span><span class=n>jscode</span><span class=p>)</span> <span class=c1># 在目标进程里创建脚本</span>
</span></span><span class=line><span class=cl>        <span class=n>script</span><span class=o>.</span><span class=n>on</span><span class=p>(</span><span class=s1>&#39;message&#39;</span><span class=p>,</span> <span class=n>on_message</span><span class=p>)</span> <span class=c1># 注册消息回调</span>
</span></span><span class=line><span class=cl>        <span class=n>script</span><span class=o>.</span><span class=n>load</span><span class=p>()</span> <span class=c1># 加载创建好的javascript脚本</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>process</span><span class=o>.</span><span class=n>stdin</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>tmp_flag</span><span class=p>)</span> <span class=c1># 写入</span>
</span></span><span class=line><span class=cl>        <span class=n>output</span><span class=p>,</span> <span class=n>error</span> <span class=o>=</span> <span class=n>process</span><span class=o>.</span><span class=n>communicate</span><span class=p>()</span> <span class=c1># 获取输出</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=n>i</span> <span class=o>==</span> <span class=s1>&#39;`&#39;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>number</span> <span class=o>=</span> <span class=n>new_number</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span><span class=p>(</span><span class=n>is_right</span><span class=p>()</span> <span class=o>==</span> <span class=kc>True</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>flag</span> <span class=o>+=</span><span class=n>i</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=n>flag</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span>
</span></span><span class=line><span class=cl>        <span class=n>process</span><span class=o>.</span><span class=n>terminate</span><span class=p>()</span></span></span></code></pre></div></div><p>最后一个字符还需要再次爆破</p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-python"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>subprocess</span>
</span></span><span class=line><span class=cl><span class=n>flag</span> <span class=o>=</span> <span class=s1>&#39;flag{xxxx }&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>32</span><span class=p>,</span><span class=mi>128</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>process</span> <span class=o>=</span> <span class=n>subprocess</span><span class=o>.</span><span class=n>Popen</span><span class=p>(</span><span class=s2>&#34;test.exe&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>stdin</span><span class=o>=</span><span class=n>subprocess</span><span class=o>.</span><span class=n>PIPE</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>stdout</span><span class=o>=</span><span class=n>subprocess</span><span class=o>.</span><span class=n>PIPE</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>stderr</span><span class=o>=</span><span class=n>subprocess</span><span class=o>.</span><span class=n>PIPE</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>universal_newlines</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>input_data</span> <span class=o>=</span> <span class=n>flag</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&#34; &#34;</span><span class=p>,</span><span class=nb>chr</span><span class=p>(</span><span class=n>i</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>process</span><span class=o>.</span><span class=n>stdin</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>input_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>input_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>output</span><span class=p>,</span> <span class=n>error</span> <span class=o>=</span> <span class=n>process</span><span class=o>.</span><span class=n>communicate</span><span class=p>()</span> <span class=c1># 读取进程的输出</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=s2>&#34;Invalid&#34;</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>output</span><span class=o>.</span><span class=n>strip</span><span class=p>()):</span>
</span></span><span class=line><span class=cl>    	<span class=nb>print</span><span class=p>(</span><span class=s1>&#39;Output:&#39;</span><span class=p>,</span> <span class=n>output</span><span class=o>.</span><span class=n>strip</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>error</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;Error:&#39;</span><span class=p>,</span> <span class=n>error</span><span class=o>.</span><span class=n>strip</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=n>process</span><span class=o>.</span><span class=n>terminate</span><span class=p>()</span></span></span></code></pre></div></div><h2 id=易语言>易语言</h2><ul><li>运行exe文件寻找逻辑：找<strong>点击</strong>类似的函数，分析输入经过的过程</li><li>易语言加密算法可选DES和RC4，RC4与标准算法结果相同，直接RC4解即可，<strong>DES算法和其他标准算法产生结果不同</strong></li></ul><p><strong>DES算法解密</strong></p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-python"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title=复制到剪贴板><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># 易语言特定解法，加密过程Key值每一个Byte都被按位倒转</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Cipher</span> <span class=kn>import</span> <span class=n>DES</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>reverse_bytes</span><span class=p>(</span><span class=n>b</span><span class=p>):</span> <span class=c1># 翻转字节串</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=nb>type</span><span class=p>(</span><span class=n>b</span><span class=p>)</span> <span class=o>==</span> <span class=nb>bytes</span>
</span></span><span class=line><span class=cl>    <span class=n>ba</span> <span class=o>=</span> <span class=nb>bytearray</span><span class=p>(</span><span class=n>b</span><span class=p>)</span> <span class=c1># 字节串转换为可变字节数组</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>b</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>        <span class=n>ba</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=nb>format</span><span class=p>(</span><span class=n>b</span><span class=p>[</span><span class=n>i</span><span class=p>],</span> <span class=s1>&#39;0&gt;8b&#39;</span><span class=p>)[::</span><span class=o>-</span><span class=mi>1</span><span class=p>],</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=c1># format(b[i], &#39;0&gt;8b&#39;) 将第i字节变为8位二进制01串</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>bytes</span><span class=p>(</span><span class=n>ba</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_new_key</span><span class=p>(</span><span class=n>key</span><span class=p>):</span> <span class=c1># 新密钥生成函数</span>
</span></span><span class=line><span class=cl>    <span class=n>ba</span> <span class=o>=</span> <span class=nb>bytearray</span><span class=p>(</span><span class=mi>8</span><span class=p>)</span> <span class=c1># 长度为8字节数组</span>
</span></span><span class=line><span class=cl>    <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>b</span> <span class=ow>in</span> <span class=n>key</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>ba</span><span class=p>[</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>b</span> <span class=o>^</span> <span class=n>ba</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>i</span> <span class=o>=</span> <span class=n>i</span> <span class=o>+</span> <span class=mi>1</span> <span class=k>if</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=mi>7</span> <span class=k>else</span> <span class=mi>0</span> <span class=c1># 0-7</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>bytes</span><span class=p>(</span><span class=n>ba</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>remove_len</span><span class=p>(</span><span class=n>d</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=nb>type</span><span class=p>(</span><span class=n>d</span><span class=p>)</span> <span class=o>==</span> <span class=nb>bytes</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>d</span><span class=p>[</span><span class=mi>4</span><span class=p>:]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>e_des_decrypt</span><span class=p>(</span><span class=n>raw</span><span class=p>,</span> <span class=n>key</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>des</span> <span class=o>=</span> <span class=n>DES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>reverse_bytes</span><span class=p>(</span><span class=n>get_new_key</span><span class=p>(</span><span class=n>key</span><span class=p>)),</span> <span class=n>DES</span><span class=o>.</span><span class=n>MODE_ECB</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>t</span> <span class=o>=</span> <span class=n>des</span><span class=o>.</span><span class=n>decrypt</span><span class=p>(</span><span class=n>raw</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>remove_len</span><span class=p>(</span><span class=n>t</span><span class=p>)</span></span></span></code></pre></div></div></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>更新于 2025-05-27&nbsp;<a class=git-hash href=https://github.com/dillonzq/LoveIt/commit/a29b62cd9c947d7e823e7d8016530241dfb361ac target=_blank title="commit by J-shiro(541737231@qq.com) a29b62cd9c947d7e823e7d8016530241dfb361ac: update rl tags and delete null content in reverse note">
<i class="fas fa-hashtag fa-fw" aria-hidden=true></i>a29b62c</a></span></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-markdown href=/reverse_note/index.md target=_blank>阅读原始文档</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="分享到 Facebook" data-sharer=facebook data-url=https://j-shiro.github.io/reverse_note/ data-hashtag=reverse><i class="fab fa-facebook-square fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 Line" data-sharer=line data-url=https://j-shiro.github.io/reverse_note/ data-title=REVERSE><i data-svg-src=https://cdn.jsdelivr.net/npm/simple-icons@14.9.0/icons/line.svg aria-hidden=true></i></a><a href=javascript:void(0); title="分享到 微博" data-sharer=weibo data-url=https://j-shiro.github.io/reverse_note/ data-title=REVERSE><i class="fab fa-weibo fa-fw" aria-hidden=true></i></a><a href="https://t.me/share/url?url=https%3a%2f%2fj-shiro.github.io%2freverse_note%2f&amp;text=REVERSE" target=_blank title="分享到 Telegram"><i class="fab fa-telegram fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/reverse/>Reverse</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/web_note/ class=prev rel=prev title=WEB><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>WEB</a>
<a href=/pwn_note/ class=next rel=next title=PWN>PWN<i class="fas fa-angle-right fa-fw" aria-hidden=true></i></a></div></div><div id=comments><div id=valine class=comment></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://valine.js.org/>Valine</a>.</noscript></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>由 <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.143.1">Hugo</a> 强力驱动 | 主题 - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.3.1-DEV"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden=true></i> LoveIt</a></div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2019 - 2025</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank>jshiro</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title=回到顶部><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i></a></div><div id=fixed-buttons-hidden><a href=# id=view-comments class=fixed-button title=查看评论><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><link rel=stylesheet href=/lib/valine/valine.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/katex.min.css><script src=https://cdn.jsdelivr.net/npm/valine@1.5.3/dist/Valine.min.js></script><script src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js></script><script src=https://cdn.jsdelivr.net/npm/algoliasearch@5.20.2/dist/lite/builds/browser.umd.min.js></script><script src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.2/sharer.min.js></script><script src=https://cdn.jsdelivr.net/npm/typeit@8.6.0/dist/index.umd.js></script><script src=https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/katex.min.js></script><script src=https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/contrib/auto-render.min.js></script><script src=https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/contrib/copy-tex.min.js></script><script src=https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/contrib/mhchem.min.js></script><script>window.config={comment:{valine:{appId:"wAgpK3Sa13Vfm247ncxiGVDA-MdYXbMMI",appKey:"p6X9gNaJTGB1sqgG9ZnrEwy4",avatar:"mp",el:"#valine",emojiCDN:"https://cdn.jsdelivr.net/npm/emoji-datasource-google@15.1.2/img/google/64/",emojiMaps:{100:"1f4af.png",alien:"1f47d.png",anger:"1f4a2.png",angry:"1f620.png",anguished:"1f627.png",astonished:"1f632.png",black_heart:"1f5a4.png",blue_heart:"1f499.png",blush:"1f60a.png",bomb:"1f4a3.png",boom:"1f4a5.png",broken_heart:"1f494.png",brown_heart:"1f90e.png",clown_face:"1f921.png",cold_face:"1f976.png",cold_sweat:"1f630.png",confounded:"1f616.png",confused:"1f615.png",cry:"1f622.png",crying_cat_face:"1f63f.png",cupid:"1f498.png",dash:"1f4a8.png",disappointed:"1f61e.png",disappointed_relieved:"1f625.png",dizzy:"1f4ab.png",dizzy_face:"1f635.png",drooling_face:"1f924.png",exploding_head:"1f92f.png",expressionless:"1f611.png",face_vomiting:"1f92e.png",face_with_cowboy_hat:"1f920.png",face_with_hand_over_mouth:"1f92d.png",face_with_head_bandage:"1f915.png",face_with_monocle:"1f9d0.png",face_with_raised_eyebrow:"1f928.png",face_with_rolling_eyes:"1f644.png",face_with_symbols_on_mouth:"1f92c.png",face_with_thermometer:"1f912.png",fearful:"1f628.png",flushed:"1f633.png",frowning:"1f626.png",ghost:"1f47b.png",gift_heart:"1f49d.png",green_heart:"1f49a.png",grimacing:"1f62c.png",grin:"1f601.png",grinning:"1f600.png",hankey:"1f4a9.png",hear_no_evil:"1f649.png",heart:"2764-fe0f.png",heart_decoration:"1f49f.png",heart_eyes:"1f60d.png",heart_eyes_cat:"1f63b.png",heartbeat:"1f493.png",heartpulse:"1f497.png",heavy_heart_exclamation_mark_ornament:"2763-fe0f.png",hole:"1f573-fe0f.png",hot_face:"1f975.png",hugging_face:"1f917.png",hushed:"1f62f.png",imp:"1f47f.png",innocent:"1f607.png",japanese_goblin:"1f47a.png",japanese_ogre:"1f479.png",joy:"1f602.png",joy_cat:"1f639.png",kiss:"1f48b.png",kissing:"1f617.png",kissing_cat:"1f63d.png",kissing_closed_eyes:"1f61a.png",kissing_heart:"1f618.png",kissing_smiling_eyes:"1f619.png",laughing:"1f606.png",left_speech_bubble:"1f5e8-fe0f.png",love_letter:"1f48c.png",lying_face:"1f925.png",mask:"1f637.png",money_mouth_face:"1f911.png",nauseated_face:"1f922.png",nerd_face:"1f913.png",neutral_face:"1f610.png",no_mouth:"1f636.png",open_mouth:"1f62e.png",orange_heart:"1f9e1.png",partying_face:"1f973.png",pensive:"1f614.png",persevere:"1f623.png",pleading_face:"1f97a.png",pouting_cat:"1f63e.png",purple_heart:"1f49c.png",rage:"1f621.png",relaxed:"263a-fe0f.png",relieved:"1f60c.png",revolving_hearts:"1f49e.png",right_anger_bubble:"1f5ef-fe0f.png",robot_face:"1f916.png",rolling_on_the_floor_laughing:"1f923.png",scream:"1f631.png",scream_cat:"1f640.png",see_no_evil:"1f648.png",shushing_face:"1f92b.png",skull:"1f480.png",skull_and_crossbones:"2620-fe0f.png",sleeping:"1f634.png",sleepy:"1f62a.png",slightly_frowning_face:"1f641.png",slightly_smiling_face:"1f642.png",smile:"1f604.png",smile_cat:"1f638.png",smiley:"1f603.png",smiley_cat:"1f63a.png",smiling_face_with_3_hearts:"1f970.png",smiling_imp:"1f608.png",smirk:"1f60f.png",smirk_cat:"1f63c.png",sneezing_face:"1f927.png",sob:"1f62d.png",space_invader:"1f47e.png",sparkling_heart:"1f496.png",speak_no_evil:"1f64a.png",speech_balloon:"1f4ac.png","star-struck":"1f929.png",stuck_out_tongue:"1f61b.png",stuck_out_tongue_closed_eyes:"1f61d.png",stuck_out_tongue_winking_eye:"1f61c.png",sunglasses:"1f60e.png",sweat:"1f613.png",sweat_drops:"1f4a6.png",sweat_smile:"1f605.png",thinking_face:"1f914.png",thought_balloon:"1f4ad.png",tired_face:"1f62b.png",triumph:"1f624.png",two_hearts:"1f495.png",unamused:"1f612.png",upside_down_face:"1f643.png",weary:"1f629.png",white_frowning_face:"2639-fe0f.png",white_heart:"1f90d.png",wink:"1f609.png",woozy_face:"1f974.png",worried:"1f61f.png",yawning_face:"1f971.png",yellow_heart:"1f49b.png",yum:"1f60b.png",zany_face:"1f92a.png",zipper_mouth_face:"1f910.png",zzz:"1f4a4.png"},enableQQ:!1,highlight:!0,lang:"zh-CN",pageSize:10,placeholder:"你的评论 ...",recordIP:!0,serverURLs:"https://wagpk3sa.api.lncldglobal.com",visitor:!0}},data:{"id-1":"J-shiro's Blog","id-2":"J-shiro's Blog"},math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!0,left:"\\begin{equation}",right:"\\end{equation}"},{display:!0,left:"\\begin{equation*}",right:"\\end{equation*}"},{display:!0,left:"\\begin{align}",right:"\\end{align}"},{display:!0,left:"\\begin{align*}",right:"\\end{align*}"},{display:!0,left:"\\begin{alignat}",right:"\\end{alignat}"},{display:!0,left:"\\begin{alignat*}",right:"\\end{alignat*}"},{display:!0,left:"\\begin{gather}",right:"\\end{gather}"},{display:!0,left:"\\begin{CD}",right:"\\end{CD}"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{algoliaAppID:"GZT24PWKNT",algoliaIndex:"index",algoliaSearchKey:"634ab679e825b815de2663de38908f9d",highlightTag:"em",maxResultLength:10,noResultsFound:"没有找到结果",snippetLength:50,type:"algolia"},typeit:{cursorChar:"|",cursorSpeed:1e3,data:{"id-1":["id-1"],"id-2":["id-2"]},duration:-1,speed:100}}</script><script src=/js/theme.min.js></script></body></html>